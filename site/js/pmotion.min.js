!function(e){"use strict";e.fn.pmotion=function(t){var i,a,o,n,s,r,l,d,c,f,p,g,u,h,v,m=e(this),$=e.extend({baseURL:"./",PexelsApiKey:"",PexelsPagination:20,PexelsLanguage:"en-US",PexelsImgSize:"large2x",PixabayApiKey:"",PixabayPagination:20,PixabayLanguage:"en",PixabaySafeSearch:"false",PixabayEditorsChice:"false",apiCaching:!0,maxUploadLimit:10,canvasWidth:1080,canvasHeight:1080,fontFamily:"Roboto",borderColor:"#000000",borderScaleFactor:2,borderOpacityWhenMoving:.5,cornerColor:"#FFFFFF",cornerSize:12,cornerStyle:"circle",cornerStrokeColor:"#000000",borderDashArray:[4,4],editingBorderColor:"rgba(0,0,0,0.5)",backgroundColor:"#888888",imageLayerColor:"#1B9AAA",videoLayerColor:"#DAA89B",textLayerColor:"#84A9C0",shapeLayerColor:"#87D68D",animatedTextLayerColor:"#87D68D",audioLayerColor:"#E2EB98",watermark:!1,watermarkText:"Made with Pmotion",watermarkFontFamily:"Roboto",watermarkFontStyle:"normal",watermarkFontColor:"#000",watermarkFontSize:40,watermarkFontWeight:"bold",watermarkBackgroundColor:"#FFF",watermarkLocation:"bottom-right",presets:[["1:1",1080,1080],["1:1",720,720],["1:1",600,600],["4:5",1080,1350],["16:9",1280,720],["16:9",640,360],["9:16",720,1280],["9:16",360,640],["4:3",640,480],["4:3",480,360]],colorpickerSwatches:["rgba(244, 67, 54, 1)","rgba(233, 30, 99, 1)","rgba(156, 39, 176, 1)","rgba(103, 58, 183, 1)","rgba(63, 81, 181, 1)","rgba(33, 150, 243, 1)","rgba(3, 169, 244, 1)","rgba(0, 188, 212, 1)","rgba(0, 150, 136, 1)","rgba(76, 175, 80, 1)","rgba(139, 195, 74, 1)","rgba(205, 220, 57, 1)","rgba(255, 235, 59, 1)","rgba(255, 193, 7, 1)"],customFunctions:function(){}},t),b=new AudioContext,y=!1,w=!1,_=1,k=!1;let x=new Localbase("db");var j=!1,C=!0,A=0,O=5,I=4e3,S=[],R=[],X=["left","top","scaleX","scaleY","width","height","angle","opacity","fill","strokeWidth","stroke","shadow.color","shadow.offsetX","shadow.offsetY","shadow.blur","charSpacing"],F=[],Y=[],T="fill",q=[],E=[],B=[],P=[],L=[],H=[],W=!1,D=!1,z=[],U=[],G=!1,V=!1,N=!1,K=0,M=0,Z=!1,J=!1,Q=!1,ee=1,et=!1,ei=0,ea=0,eo=!1,en=[],es=[],er=[],el=[],ed=!1,ec=!1,ef=!1,ep=!1,eg=[],eu=0,eh=[],ev=[],em=fabric.Image.filters,e$=1,eb=!0,ey=["volume","audioSrc","defaultLeft","defaultTop","defaultScaleX","defaultScaleY","notnew","starttime","top","left","width","height","scaleX","scaleY","flipX","flipY","originX","originY","transformMatrix","stroke","strokeWidth","strokeDashArray","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","angle","opacity","fill","globalCompositeOperation","shadow","clipTo","visible","backgroundColor","skewX","skewY","fillRule","paintFirst","strokeUniform","rx","ry","selectable","hasControls","subTargetCheck","id","hoverCursor","defaultCursor","filesrc","isEditing","source","assetType","duration","inGroup","filters","ogWidth","ogHeight"];toastr.options.closeButton=!0,toastr.options.positionClass="toast-top-right",toastr.options.progressBar=!0,toastr.options.newestOnTop=!1,toastr.options.showEasing="swing",toastr.options.hideEasing="linear",toastr.options.closeEasing="linear";var ew='<div id="canvas-properties" class="panel-section">  <p class="property-title">'+pmotionParams.t1+'</p><div class="control-wrap"> <label class="control-label">'+pmotionParams.t2+'</label> <div class="control"> <input id="canvas-w" class="form-field" autocomplete="off" min="1" type="number" value="" /> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t3+'</label> <div class="control"> <input id="canvas-h" class="form-field" autocomplete="off" type="number" value="" min="1" /> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t141+'</label> <div class="control"> <div class="colorpicker-box"></div> <input id="canvas-color" class="form-field colorpicker" autocomplete="off" value="'+$.backgroundColor+'" readonly /> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t5+'</label> <div class="control"> <input id="canvas-duration" class="form-field" autocomplete="off" type="number" value="4" /></div></div> <hr> <p class="property-title">'+pmotionParams.t6+'</p> <div id="canvas-presets">'+function t(){let i=$.presets;var a="";return e.each(i,function(e,t){a+='<div data-width="'+t[1]+'" data-height="'+t[2]+'">'+t[1]+"x"+t[2]+"px <span>"+t[0]+"</span></div>"}),a}()+"</div> </div>",e_='<button id="back-to-canvas-settings" type="button" class="btn"> <span class="material-icons">keyboard_double_arrow_left</span>'+pmotionParams.t1+'</button><hr> <p class="property-title">'+pmotionParams.t140+'</p><div id="align" class="btn-group"> <span id="align-top" class="material-icons align" title="Align to the top">vertical_align_top</span> <span id="align-center-v" class="material-icons align" title="Align to the center">vertical_align_center</span> <span id="align-bottom" class="material-icons align" title="Align to the bottom">vertical_align_bottom</span> <span id="align-left" class="material-icons align" title="Align to the left">align_horizontal_left</span> <span id="align-center-h" class="material-icons align" title="Align to the center">align_horizontal_center</span> <span id="align-right" class="material-icons align" title="Align to the right">align_horizontal_right</span> </div><hr>',ek='<hr><div id="layout-properties" class="panel-section"> <p class="property-title">'+pmotionParams.t7+'</p> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t8+'</label> <div class="control"> <div id="object-x"><input type="number" class="form-field" autocomplete="off" value=1000></div> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t9+'</label> <div class="control"> <div id="object-y"><input type="number" class="form-field" autocomplete="off" value=1000></div> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t2+'</label> <div class="control"> <div id="object-w"><input type="number" class="form-field" autocomplete="off" value=1000 min=1></div> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t3+'</label> <div class="control"> <div id="object-h"><input type="number" class="form-field" autocomplete="off" value=1000 min=1></div> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t10+'</label> <div class="control"> <div id="object-r"><input type="number" class="form-field" autocomplete="off" value=1000 min=-360 max=360></div> </div> </div> </div>',ex='<div id="layout-properties" class="panel-section video-fields"><div class="control-wrap"> <label class="control-label">'+pmotionParams.t8+'</label> <div class="control"> <div id="object-x"><input type="text" class="form-field video-field" autocomplete="off" value=1000 readonly></div> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t9+'</label> <div class="control"> <div id="object-y"><input type="text" class="form-field video-field" autocomplete="off" value=1000 readonly></div> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t2+'</label> <div class="control"> <div id="object-w"><input type="text" class="form-field video-field" autocomplete="off" value=1000 readonly></div> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t3+'</label> <div class="control"> <div id="object-h"><input type="text" class="form-field video-field" autocomplete="off" value=1000 readonly></div> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t10+'</label> <div class="control"> <div id="object-r"><input type="text" class="form-field video-field" autocomplete="off" value=1000 readonly> </div> </div> </div> </div>',ej='<div id="back-properties" class="panel-section"> <p class="property-title">'+pmotionParams.t11+'</p> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t12+'</label> <div class="control"> <input id="object-o" type="range" min="0" max="1" value="0" step="0.1" class="rangeslider" autocomplete="off"> </div> </div> </div>',eC='<div id="back-properties" class="panel-section"> <p class="property-title">'+pmotionParams.t13+'</p> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t4+'</label> <div class="control"> <div class="colorpicker-box"></div> <input id="object-color-fill" class="form-field colorpicker" autocomplete="off" value="#FFFFFF" readonly> </div> </div> </div> <hr>',e0='<div id="back-properties" class="panel-section"> <p class="property-title">'+pmotionParams.t36+'</p> <div class="control-wrap label-block"> <div class="control"> <textarea id="textarea-input" class="textarea-field" rows="3" autocomplete="off"></textarea> </div> </div> <div class="control-wrap label-block"> <div class="control"> <div class="btn-group"> <div class="format-text" id="format-bold"><span class="material-icons">format_bold</span></div> <div class="format-text" id="format-italic"><span class="material-icons">format_italic</span></div> <div class="format-text" id="format-underline"><span class="material-icons">format_underlined</span> </div> <div class="format-text" id="format-strike"><span class="material-icons">strikethrough_s</span> </div> <div class="align-text" id="align-text-left"><span class="material-icons">format_align_left</span> </div> <div class="align-text" id="align-text-center"><span class="material-icons">format_align_center</span> </div> <div class="align-text" id="align-text-right"><span class="material-icons">format_align_right</span> </div> </div> </div> </div> <div class="control-wrap label-block"> <div class="control"> <select id="font-picker" class="custom-select custom-select2" autocomplete="off"></select> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t4+'</label> <div class="control"> <div class="colorpicker-box"></div> <input id="object-color-fill" class="form-field colorpicker" autocomplete="off" value="rgba(255,255,255,1)" readonly> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t123+'</label> <div class="control"> <input id="text-h" type="range" min="-10" max="110" value="1" step="1" class="rangeslider" autocomplete="off"> </div> </div> </div> <hr>',eA='<hr> <div id="back-properties" class="panel-section"> <p class="property-title">'+pmotionParams.t124+'</p> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t4+'</label> <div class="control"> <div class="colorpicker-box"></div> <input id="object-color-stroke" class="form-field colorpicker" autocomplete="off" value="#FFFFFF" readonly> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t2+'</label> <div class="control"> <div id="object-stroke"><input class="form-field" autocomplete="off" type="number" value="0" min="0"> </div> </div> </div> </div>',eO='<hr> <div id="back-properties" class="panel-section"> <p class="property-title">'+pmotionParams.t125+'</p> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t4+'</label> <div class="control"> <div class="colorpicker-box"></div> <input id="object-color-shadow" class="form-field colorpicker" autocomplete="off" value="#FFFFFF" readonly> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t14+'</label> <div class="control"> <div id="object-shadow-x"><input class="form-field" autocomplete="off" type="number" value="0"> </div> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t15+'</label> <div class="control"> <div id="object-shadow-y"><input class="form-field" autocomplete="off" type="number" value="0"> </div> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t16+'</label> <div class="control"> <div id="object-blur"><input class="form-field" autocomplete="off" type="number" value="0"></div> </div> </div> </div>',eI='<div id="back-properties" class="panel-section img-filters"> <p class="property-title">'+pmotionParams.t17+'</p> <div class="control-wrap label-block"> <div class="control"> <select class="custom-select" id="filters-list"> <option value="none">'+pmotionParams.t18+'</option> <option value="Grayscale">'+pmotionParams.t19+'</option> <option value="Sepia">'+pmotionParams.t20+'</option> <option value="BlackWhite">'+pmotionParams.t21+'</option> <option value="Brownie">'+pmotionParams.t22+'</option> <option value="Vintage">'+pmotionParams.t23+'</option> <option value="Technicolor">'+pmotionParams.t24+'</option> <option value="Kodachrome">'+pmotionParams.t25+'</option> <option value="Polaroid">'+pmotionParams.t26+'</option> <option value="Invert">'+pmotionParams.t27+'</option> </select> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t28+'</label> <div class="control"> <input id="filter-brightness" type="range" min="-100" max="100" value="0" step="1" class="rangeslider" autocomplete="off"> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t29+'</label> <div class="control"> <input id="filter-contrast" type="range" min="-100" max="100" value="0" step="1" class="rangeslider" autocomplete="off"> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t30+'</label> <div class="control"> <input id="filter-saturation" type="range" min="-100" max="100" value="0" step="1" class="rangeslider" autocomplete="off"> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t31+'</label> <div class="control"> <input id="filter-vibrance" type="range" min="-100" max="100" value="0" step="1" class="rangeslider" autocomplete="off"> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t32+'</label> <div class="control"> <input id="filter-hue" type="range" min="-100" max="100" value="0" step="1" class="rangeslider" autocomplete="off"> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t33+'</label> <div class="control"> <input id="filter-noise" type="range" min="0" max="1000" value="0" step="1" class="rangeslider" autocomplete="off"> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t16+'</label> <div class="control"> <input id="filter-blur" type="range" min="0" max="100" value="0" step="1" class="rangeslider" autocomplete="off"> </div> </div> <div class="image-btns"> <button id="crop-image" type="button" class="btn">'+pmotionParams.t34+'</button> <button id="reset-filters" type="button" class="btn">'+pmotionParams.t35+"</button> </div> </div> <hr>",eS='<div id="back-properties" class="panel-section"> <p class="property-title">'+pmotionParams.t36+'</p> <div class="control-wrap label-block"> <div class="control"> <div id="animated-text"> <input id="animatedinput" class="form-field" type="text" value="text" autocomplete="off"> <button type="button" id="animatedset" class="btn primary"><span class="material-icons">done</span></button> </div> </div> </div> <div class="control-wrap label-block"> <div class="control"> <select id="font-picker" class="custom-select custom-select2" autocomplete="off"></select> </div> </div> <div class="control-wrap"> <div class="control-label">'+pmotionParams.t132+'</div> <div class="control"> <select id="anim-weight" class="custom-select" autocomplete="off"> <option value="normal">'+pmotionParams.t133+'</option> <option value="bold">'+pmotionParams.t134+'</option> </select> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t4+'</label> <div class="control"> <div class="colorpicker-box"></div> <input id="text-color" class="form-field colorpicker" autocomplete="off" value="#FFFFFF" readonly> </div> </div> </div> <hr>',eR='<hr> <div id="back-properties" class="panel-section"> <p class="property-title">'+pmotionParams.t126+'</p> <div class="control-wrap label-block"> <div class="control"> <div class="order-toggle"> <div id="order-backward" class="order-toggle-item">'+pmotionParams.t37+'</div> <div id="order-forward" class="order-toggle-item order-toggle-item-active">'+pmotionParams.t38+'</div> </div> </div> </div> <div class="control-wrap label-block"> <div class="control"> <div class="order-toggle"> <div id="type-letters" class="order-toggle-item-2">'+pmotionParams.t39+'</div> <div id="type-words" class="order-toggle-item-2 order-toggle-item-active-2">'+pmotionParams.t40+'</div> </div> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t41+'</label> <div class="control"> <select id="preset-picker" class="custom-select"> <option value="fade in">'+pmotionParams.t42+'</option> <option value="typewriter">'+pmotionParams.t43+'</option> <option value="slide top">'+pmotionParams.t44+'</option> <option value="slide bottom">'+pmotionParams.t45+'</option> <option value="slide left">'+pmotionParams.t46+'</option> <option value="slide right">'+pmotionParams.t47+'</option> <option value="scale">'+pmotionParams.t48+'</option> <option value="shrink">'+pmotionParams.t49+'</option> </select> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t50+'</label> <div class="control"> <select id="easing-picker" class="custom-select"> <option value="linear">'+pmotionParams.t51+'</option> <option value="easeInQuad">'+pmotionParams.t52+'</option> <option value="easeOutQuad">'+pmotionParams.t53+'</option> <option value="easeInOutQuad">'+pmotionParams.t54+'</option> <option value="easeOutInQuad">'+pmotionParams.t55+'</option> <option value="easeInQuart">'+pmotionParams.t56+'</option> <option value="easeOutQuart">'+pmotionParams.t57+'</option> <option value="easeInOutQuart">'+pmotionParams.t58+'</option> <option value="easeOutInQuart">'+pmotionParams.t59+'</option> <option value="easeInQuint">'+pmotionParams.t60+'</option> <option value="easeOutQuint">'+pmotionParams.t61+'</option> <option value="easeInOutQuint">'+pmotionParams.t62+'</option> <option value="easeOutInQuint">'+pmotionParams.t63+'</option> <option value="easeInBounce">'+pmotionParams.t64+'</option> <option value="easeOutBounce">'+pmotionParams.t65+'</option> <option value="easeInOutBounce">'+pmotionParams.t66+'</option> <option value="easeOutInBounce">'+pmotionParams.t67+'</option> <option value="easeInSine">'+pmotionParams.t68+'</option> <option value="easeOutSine">'+pmotionParams.t69+'</option> <option value="easeInOutSine">'+pmotionParams.t70+'</option> <option value="easeOutInSine">'+pmotionParams.t71+'</option> <option value="easeInCubic">'+pmotionParams.t72+'</option> <option value="easeOutCubic">'+pmotionParams.t73+'</option> <option value="easeInOutCubic">'+pmotionParams.t74+'</option> <option value="easeOutInCubic">'+pmotionParams.t75+'</option> <option value="easeInCirc">'+pmotionParams.t76+'</option> <option value="easeOutCirc">'+pmotionParams.t77+'</option> <option value="easeInOutCirc">'+pmotionParams.t78+'</option> <option value="easeOutInCirc">'+pmotionParams.t79+'</option> <option value="easeInExpo">'+pmotionParams.t80+'</option> <option value="easeOutExpo">'+pmotionParams.t81+'</option> <option value="easeInOutExpo">'+pmotionParams.t82+'</option> <option value="easeOutInExpo">'+pmotionParams.t83+'</option> <option value="easeInBack">'+pmotionParams.t84+'</option> <option value="easeOutBack">'+pmotionParams.t85+'</option> <option value="easeInOutBack">'+pmotionParams.t86+'</option> <option value="easeOutInBack">'+pmotionParams.t87+'</option> </select> </div> </div> <div class="control-wrap"> <label class="control-label">'+pmotionParams.t88+'</label> <div class="control"> <div id="animated-text-duration"> <input id="durationinput" class="form-field" autocomplete="off" type="number" value="0"> </div> </div> </div> </div>',eX='<div id="layout-properties" class="panel-section"><button type="button" class="btn btn-full danger delete-audio"><span class="material-icons">delete_forever</span>'+pmotionParams.t91+"</button>";try{v=new fabric.WebglFilterBackend}catch(eF){console.log(eF)}e.getJSON($.baseURL+"json/google-fonts.json",function(e){for(var t=0;t<e.items.length;t++)U.push(e.items[t].family);U.sort()}),fabric.filterBackend=fabric.initFilterBackend(),fabric.filterBackend=v;var eY=new fabric.Canvas("canvas",{preserveObjectStacking:!0,backgroundColor:$.backgroundColor,stateful:!0});eY.selection=!1,eY.controlsAboveOverlay=!0,fabric.Object.prototype.set({fontFamily:$.fontFamily,transparentCorners:!1,borderColor:$.borderColor,borderScaleFactor:$.borderScaleFactor,borderOpacityWhenMoving:$.borderOpacityWhenMoving,cornerColor:$.cornerColor,cornerSize:$.cornerSize,cornerStyle:$.cornerStyle,cornerStrokeColor:$.cornerStrokeColor,borderDashArray:$.borderDashArray,editingBorderColor:$.editingBorderColor});var eT=document.createElement("img");function e3(e,t){var i=t.target;if(eY.getActiveObject()&&!eY.getActiveObject().isEditing){let a=eY.getActiveObject();"activeSelection"==a.type?(eY.discardActiveObject(),a._objects.forEach(function(e){tU(e,eY)})):tU(i,eY)}eY.requestRenderAll()}function eq(e,t,i,a,o){e.save(),e.translate(t,i),e.rotate(fabric.util.degreesToRadians(o.angle)),e.drawImage(eT,-12,-12,24,24),e.restore()}eT.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='tm_delete_btn' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='512px' height='512px' viewBox='0 0 512 512' style='enable-background:new 0 0 512 512;' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='256' cy='256' r='256'/%3E%3Cg%3E%3Crect x='120.001' y='239.987' transform='matrix(-0.7071 -0.7071 0.7071 -0.7071 256.0091 618.0168)' style='fill:%23FFFFFF;' width='271.997' height='32'/%3E%3Crect x='240' y='119.989' transform='matrix(-0.7071 -0.7071 0.7071 -0.7071 256.0091 618.0168)' style='fill:%23FFFFFF;' width='32' height='271.997'/%3E%3C/g%3E%3C/svg%3E";var eE=document.createElement("img");function eB(e,t){var i=t.target;"activeSelection"===i.type?toastr.warning(pmotionParams.t129,pmotionParams.t130):"animatedText"===i.assetType?toastr.warning(pmotionParams.t131,pmotionParams.t130):eY.getActiveObject()&&(r=eY.getActiveObject())&&("activeSelection"==r.type?r._objects.forEach(function(e){e.clone(function(e){e.set({id:"Cloned"+ee}),eY.add(e),eY.requestRenderAll(),t3(e),eY.setActiveObject(e)})}):r.clone(function(e){e.set({id:"Cloned"+ee}),eY.add(e),eY.requestRenderAll(),t3(e),eY.setActiveObject(e)}),t_())}function e1(e,t,i,a,o){e.save(),e.translate(t,i),e.rotate(fabric.util.degreesToRadians(o.angle)),e.drawImage(eE,-12,-12,24,24),e.restore()}eE.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='tm_add_btn' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='512px' height='512px' viewBox='0 0 512 512' style='enable-background:new 0 0 512 512;' xml:space='preserve'%3E%3Ccircle style='fill:%23009688;' cx='256' cy='256' r='256'/%3E%3Cg%3E%3Crect x='240' y='120' style='fill:%23FFFFFF;' width='32' height='272'/%3E%3Crect x='120' y='240' style='fill:%23FFFFFF;' width='272' height='32'/%3E%3C/g%3E%3C/svg%3E",fabric.Canvas.prototype.getItemById=function(e){for(var t=null,i=this.getObjects(),a=0,o=this.size();a<o;a++)if("group"==i[a].get("type")){if(i[a].get("id")&&i[a].get("id")===e){t=i[a];break}for(var n=a,s=0;s<i[a]._objects.length;s++)if(i[n]._objects[s].id&&i[n]._objects[s].id===e){t=i[n]._objects[s];break}}else if(i[a].id&&i[a].id===e){t=i[a];break}return t};var e8=new fabric.Rect({left:eY.get("width")/2-$.canvasWidth/2,top:eY.get("height")/2-$.canvasHeight/2,width:$.canvasWidth,height:$.canvasHeight,absolutePositioned:!0,rx:0,ry:0,fill:"#FFF",hasControls:!0,transparentCorners:!1,borderColor:"#0E98FC",cornerColor:"#0E98FC",cursorWidth:1,cursorDuration:1,cursorDelay:250,id:"overlay"});eY.requestRenderAll(),eY.clipPath=e8,eY.requestRenderAll();var e4=Pickr.create({el:".colorpicker",theme:"nano",inline:!1,autoReposition:!1,defaultRepresentation:"RGBA",default:"#FFFFFF",swatches:$.colorpickerSwatches,components:{preview:!0,opacity:!0,hue:!0,interaction:{hex:!0,rgba:!0,hsla:!1,hsva:!1,cmyk:!1,input:!0,clear:!1,save:!1}}});m.find("#browser").on("scroll",function(){e4.hide(),m.find("#font-picker").length&&m.find("#font-picker").select2("close")}),e4.on("change",e=>{if(eY.getActiveObject()){let t=eY.getActiveObject();if("fill"==T)m.find("#object-color-fill").val(e4.getColor().toHEXA().toString().substring(0,7)),m.find("#object-color-fill").parent().find(".colorpicker-box").css("background",e4.getColor().toHEXA().toString().substring(0,7)),t.set("fill",e4.getColor().toRGBA().toString()),G||V||tX("fill",t,A,t.get("fill"),!0);else if("stroke"==T)m.find("#object-color-stroke").val(e4.getColor().toHEXA().toString().substring(0,7)),m.find("#object-color-stroke").parent().find(".colorpicker-box").css("background",e4.getColor().toHEXA().toString().substring(0,7)),t.set("stroke",e4.getColor().toRGBA().toString()),G||V||(tX("stroke",t,A,t.get("stroke"),!0),tX("strokeWidth",t,A,t.get("strokeWidth"),!0));else if("shadow"==T)m.find("#object-color-shadow").val(e4.getColor().toHEXA().toString().substring(0,7)),m.find("#object-color-shadow").parent().find(".colorpicker-box").css("background",e4.getColor().toHEXA().toString().substring(0,7)),t.set("shadow",new fabric.Shadow({color:e4.getColor().toRGBA().toString(),offsetX:t.shadow.offsetX,offsetY:t.shadow.offsetY,blur:t.shadow.blur,opacity:1})),G||V||(tX("shadow.color",t,A,t.shadow.color,!0),tX("shadow.offsetX",t,A,t.shadow.offsetX,!0),tX("shadow.offsetY",t,A,t.shadow.offsetY,!0),tX("shadow.blur",t,A,t.shadow.blur,!0));else if("text"==T){var i=eY.getActiveObject();m.find("#text-color").val(e4.getColor().toHEXA().toString().substring(0,7)),m.find("#text-color").parent().find(".colorpicker-box").css("background",e4.getColor().toHEXA().toString().substring(0,7)),eh.find(e=>e.id==i.id).setProps({fill:e4.getColor().toRGBA().toString()},eY)}eY.requestRenderAll()}else"back"==T&&(m.find("#canvas-color").val(e4.getColor().toHEXA().toString().substring(0,7)),m.find("#canvas-color").parent().find(".colorpicker-box").css("background",e4.getColor().toHEXA().toString().substring(0,7)),eY.setBackgroundColor(e4.getColor().toRGBA().toString()),eY.requestRenderAll())}).on("show",(e,t)=>{var i=m.find(".colorpicker:focus")[0].getBoundingClientRect(),a=i.top+i.height+5;let o=t.getRoot().app.style;o.left=i.left+"px",o.top=a+"px"}).on("hide",e=>{t_()}),s=new fabric.Canvas("canvasrecord",{preserveObjectStacking:!0,backgroundColor:$.backgroundColor,width:e8.width,height:e8.height});let eP=new SelectionArea({class:"selection-area",selectables:[".keyframe"],container:"#timeline",startareas:["html"],boundaries:["#timeline"],startThreshold:10,allowTouch:!0,intersect:"touch",overlap:"invert",singleTap:{allow:!1,intersect:"native"},scrolling:{speedDivider:10,manualSpeed:750}});function e5(e,t){"align-top"==t?e.set("top",e8.get("top")+e.get("height")*e.get("scaleY")/2):"align-center-v"==t?e.set("top",e8.get("top")+e8.get("height")/2):"align-bottom"==t?e.set("top",e8.get("top")+e8.get("height")-e.get("height")*e.get("scaleY")/2):"align-left"==t?e.set("left",e8.get("left")+e.get("width")*e.get("scaleX")/2):"align-center-h"==t?e.set("left",e8.get("left")+e8.get("width")/2):e.set("left",e8.get("left")+e8.get("width")-e.get("width")*e.get("scaleX")/2)}function eL(e){if(!Q){d.opacity=0,c.opacity=0,eY.requestRenderAll();let t=e.target.left,i=e.target.top,a=e.target.get("width")*e.target.get("scaleX"),o=e.target.get("height")*e.target.get("scaleY");eY.forEachObject(function(n,s,r){function l(e,t,i,a,o){if(e>t-i&&e<t+i){d.opacity=1,d.bringToFront();var n=t;1==o?n=t:2==o?n=t-a.target.get("width")*a.target.get("scaleX")/2:3==o&&(n=t+a.target.get("width")*a.target.get("scaleX")/2),a.target.set({left:n}).setCoords(),d.set({x1:t,y1:e8.get("top"),x2:t,y2:e8.get("height")+e8.get("top")}).setCoords(),eY.requestRenderAll()}}function f(e,t,i,a,o){if(e>t-i&&e<t+i){c.opacity=1,c.bringToFront();var n=t;1==o?n=t:2==o?n=t-a.target.get("height")*a.target.get("scaleY")/2:3==o&&(n=t+a.target.get("height")*a.target.get("scaleY")/2),a.target.set({top:n}).setCoords(),c.set({y1:t,x1:e8.get("left"),y2:t,x2:e8.get("width")+e8.get("left")}).setCoords(),eY.requestRenderAll()}}if(n!=e.target&&n!=d&&n!=c){var p="",g="";if("center_h"==n.get("id")||"center_v"==n.get("id")){p=[[t,n.get("left"),1]],g=[[i,n.get("top"),1]];for(var u=0;u<p.length;u++)l(p[u][0],p[u][1],5,e,p[u][2]),f(g[u][0],g[u][1],5,e,g[u][2])}else{p=[[t,n.get("left"),1],[t,n.get("left")+n.get("width")*n.get("scaleX")/2,1],[t,n.get("left")-n.get("width")*n.get("scaleX")/2,1],[t+a/2,n.get("left"),2],[t+a/2,n.get("left")+n.get("width")*n.get("scaleX")/2,2],[t+a/2,n.get("left")-n.get("width")*n.get("scaleX")/2,2],[t-a/2,n.get("left"),3],[t-a/2,n.get("left")+n.get("width")*n.get("scaleX")/2,3],[t-a/2,n.get("left")-n.get("width")*n.get("scaleX")/2,3],],g=[[i,n.get("top"),1],[i,n.get("top")+n.get("height")*n.get("scaleY")/2,1],[i,n.get("top")-n.get("height")*n.get("scaleY")/2,1],[i+o/2,n.get("top"),2],[i+o/2,n.get("top")+n.get("height")*n.get("scaleY")/2,2],[i+o/2,n.get("top")-n.get("height")*n.get("scaleY")/2,2],[i-o/2,n.get("top"),3],[i-o/2,n.get("top")+n.get("height")*n.get("scaleY")/2,3],[i-o/2,n.get("top")-n.get("height")*n.get("scaleY")/2,3],];for(var h=0;h<p.length;h++)l(p[h][0],p[h][1],5,e,p[h][2]),f(g[h][0],g[h][1],5,e,g[h][2])}}})}}function e7(t){var i=t.element;return e(i).data("font")?e('<div class="select2-item" style="font-family:'+e(i).data("font")+'">'+t.text+"</div>"):e('<div class="select2-item">'+t.text+"</div>")}eP.on("beforestart",t=>{if(e(t.event.target).hasClass("keyframe")||"seekbar"==e(t.event.target).attr("id")||e(t.event.target).parent().hasClass("main-row")||e(t.event.target).hasClass("main-row")||e(t.event.target).hasClass("trim-row")||3===t.event.which)return!1}).on("start",e=>{}).on("move",e=>{}).on("stop",t=>{m.find(".keyframe-selected").removeClass("keyframe-selected"),en=[],0==t.store.selected.length?m.find(".keyframe-selected").removeClass("keyframe-selected"):(eY.discardActiveObject(),eY.requestRenderAll(),t.store.selected.forEach(function(t){en.push({keyframe:t,offset:e(t).offset().left}),e(t).addClass("keyframe-selected")}))}),m.on("click",".align",function(){let t=e(this).attr("id"),i=eY.getActiveObject();if("activeSelection"==eY.getActiveObject().type){let a=eY.getActiveObject();eY.discardActiveObject(),a._objects.forEach(function(e){e5(e,t),eY.requestRenderAll(),tX("left",e,A,e.get("left"),!0),tX("top",e,A,e.get("top"),!0)}),tb(a)}else e5(i,t),eY.requestRenderAll(),tX("left",i,A,i.get("left"),!0),tX("top",i,A,i.get("top"),!0);t_()});var e2=new LazyLoad({container:document.querySelector(".scrollingPanel"),callback_error(e){e.setAttribute("src",$.baseURL+"assets/placeholder.png"),m.find(e).parent().css("min-height","auto"),m.find(e).parent().find(".img-loader").remove()},callback_loaded(e){m.find(e).parent().css("min-height","auto"),m.find(e).parent().find(".img-loader").remove()}});function eH(){var t=m.find("#font-picker").select2({theme:"dark",width:"100%",templateSelection:e7,templateResult:e7,allowHtml:!0}),i=0;t.on("select2:open",function(){m.find("#select2-font-picker-results").scroll(function(){e(this).find("li").each(function(){var t=e(this);t.is(":in-viewport( 0, #select2-font-picker-results)")&&!ev.includes(t.attr("id"))&&(WebFont.load({google:{families:[t.find(".select2-item").html()+":italic,regular,bold"]},inactive:function(){WebFont.load({custom:{families:[t.find(".select2-item").html()+":italic,regular,bold"],urls:["https://fonts.googleapis.com/css?family="+t.find(".select2-item").html()+"&text=abc",]},active:function(){console.log("active")}})}}),ev.push(t.attr("id")))})}),m.on("keypress",".select2-search .select2-search__field",function(e){window.clearTimeout(i),i=setTimeout(function(){m.find("#select2-font-picker-results").trigger("scroll")},500)})})}function eW(t){t&&(m.find("#object-specific").html(""),!m.find("#object-settings-select").hasClass("tool-active")&&document.body.clientWidth>=700&&m.find("#object-settings-select").trigger("click")),t?t&&"activeSelection"==eY.getActiveObject().get("type")?(m.find("#object-specific").append(ex),ez()):t&&1==eY.getActiveObjects().length&&"audio"==eY.getActiveObject().get("assetType")?m.find("#object-specific").html(eX):t&&1==eY.getActiveObjects().length&&"group"!=eY.getActiveObject().get("type")?("image"!=eY.getActiveObject().get("type")||eY.getActiveObject().get("assetType")?"video"!=eY.getActiveObject().get("assetType")&&m.find("#object-specific").append(ej):(m.find("#object-specific").prepend(eI),m.find("#object-specific").append(ej),Q||ti()),"video"!=eY.getActiveObject().get("assetType")?(m.find("#object-specific").append(eA),m.find("#object-specific").append(eO),m.find("#object-specific").append(ek)):m.find("#object-specific").append(ex),"path"==eY.getActiveObject().get("type")||"circle"==eY.getActiveObject().get("type")||"rect"==eY.getActiveObject().get("type")||"polygon"==eY.getActiveObject().get("type")?m.find("#object-specific").prepend(eC):("i-text"==eY.getActiveObject().get("type")||"textbox"==eY.getActiveObject().get("type"))&&(m.find("#object-specific").prepend(e0),function t(){let i=eY.getActiveObject();U.forEach(function(t){m.find("#font-picker").append(e("<option></option>").attr("value",t).text(t).attr("data-font",t).text(t))}),m.find("#font-picker").val(i.get("fontFamily")),eH(),m.find("#text-h").val(parseFloat((i.get("charSpacing")/10).toFixed(2))),"left"==i.get("textAlign")?m.find("#align-text-left").addClass("align-text-active"):"center"==i.get("textAlign")?m.find("#align-text-center").addClass("align-text-active"):"right"==i.get("textAlign")&&m.find("#align-text-right").addClass("align-text-right-active"),("bold"==i.get("fontWeight")||700==i.get("fontWeight"))&&m.find("#format-bold").addClass("format-text-active"),"italic"==i.get("fontStyle")&&m.find("#format-italic").addClass("format-text-active"),!0==i.get("underline")&&m.find("#format-underline").addClass("format-text-active"),!0==i.get("linethrough")&&m.find("#format-strike").addClass("format-text-active")}()),ez()):(eY.getActiveObjects().length>1||"group"==eY.getActiveObject().get("type"))&&("group"==eY.getActiveObject().get("type")?"animatedText"==eY.getActiveObject().get("assetType")?(m.find("#object-specific").prepend(eS),m.find("#object-specific").append(ej),m.find("#object-specific").append(eR),m.find("#object-specific").append(ek),U.forEach(function(t){m.find("#font-picker").append(e("<option></option>").attr("value",t).text(t).attr("data-font",t).text(t))}),m.find("#font-picker").val(eh.find(e=>e.id==eY.getActiveObject().id).props.fontFamily),m.find("#anim-weight").val(eh.find(e=>e.id==eY.getActiveObject().id).props.fontWeight),eH(),m.find("#text-color").val(eD(eh.find(e=>e.id==eY.getActiveObject().id).props.fill)),m.find("#text-color").parent().find(".colorpicker-box").css("background",eD(eh.find(e=>e.id==eY.getActiveObject().id).props.fill)),m.find("#preset-picker").val(eh.find(e=>e.id==eY.getActiveObject().id).props.preset),m.find(".order-toggle-item-active").removeClass("order-toggle-item-active"),m.find(".order-toggle-item-active-2").removeClass("order-toggle-item-active-2"),"backward"==eh.find(e=>e.id==eY.getActiveObject().id).props.order?m.find("#order-backward").addClass("order-toggle-item-active"):m.find("#order-forward").addClass("order-toggle-item-active"),"letter"==eh.find(e=>e.id==eY.getActiveObject().id).props.typeAnim?m.find("#type-letters").addClass("order-toggle-item-active-2"):m.find("#type-words").addClass("order-toggle-item-active-2"),m.find("#easing-picker").val(eh.find(e=>e.id==eY.getActiveObject().id).props.easing),m.find("#durationinput").val(parseInt(eh.find(e=>e.id==eY.getActiveObject().id).props.duration)/1e3)):("svg"==eY.getActiveObject().get("assetType")&&(m.find("#object-specific").append('<div id="back-properties" class="panel-section"> <p class="property-title">Fill Colors</p><div id="custom-svg-colors"></div> <hr>'),function t(){var i=eY.getActiveObject();if(i._objects){var a=[];e.each(i._objects,function(e,t){-1===a.indexOf(t.get("fill"))&&a.push(t.get("fill"))}),e.each(a,function(e,t){var i=e+1;("string"==typeof t||t instanceof String)&&(m.find("#custom-svg-colors").append('<div class="control-wrap"><label class="control-label">Color '+i+'</label><div class="control"><div class="colorpicker-box"></div><input id="customsvg-color-'+i+'" data-color="'+t+'" class="form-field svg-picker" autocomplete="off" value="'+t+'" readonly /></div></div>'),Pickr.create({el:"#customsvg-color-"+i,theme:"nano",inline:!1,autoReposition:!1,defaultRepresentation:"RGBA",useAsButton:!0,default:t,swatches:$.colorpickerSwatches,components:{preview:!0,opacity:!0,hue:!0,interaction:{hex:!0,rgba:!0,hsla:!1,hsva:!1,cmyk:!1,input:!0,clear:!1,save:!1}}}).on("change",(e,t,a)=>{var o=m.find("#customsvg-color-"+i).attr("data-color"),n=eY.getActiveObject();if(n._objects){for(var s=0;s<n._objects.length;s++)n._objects[s].fill==o&&n._objects[s].set({fill:e.toHEXA().toString()});m.find("#customsvg-color-"+i).val(e.toHEXA().toString()),m.find("#customsvg-color-"+i).attr("data-color",e.toHEXA().toString()),m.find("#customsvg-color-"+i).parent().find(".colorpicker-box").css("background",e.toHEXA().toString())}eY.requestRenderAll(),t_()}).on("show",(e,t)=>{var i=m.find(".svg-picker:focus")[0].getBoundingClientRect(),a=i.top+i.height+5;let o=t.getRoot().app.style;o.left=i.left+"px",o.top=a+"px"}),m.find("#customsvg-color-"+i).parent().find(".colorpicker-box").css("background",t))})}}()),m.find("#object-specific").append(ej),m.find("#object-specific").append(ek)):(m.find("#object-specific").append(ej),"animatedText"!=eY.getActiveObject().get("assetType")&&m.find("#object-specific").append(ek)),ez()):(m.find("#object-specific").html(ew),m.find("#canvas-duration").val(I/1e3),ez(),T="back",e4.setColor(eY.backgroundColor)),t&&m.find("#object-specific").prepend(e_)}function eD(e){var t=document.createElement("canvas").getContext("2d");return t.fillStyle=e,t.fillStyle.toUpperCase()}function ez(){if(eY.getActiveObject()){V=!0;var e=!1,t=eY.getActiveObject();(eY.getActiveObjects.length>1||"activeSelection"==t.get("type"))&&((t=t.toGroup()).set({shadow:{blur:0,color:"black",offsetX:0,offsetY:0,opacity:0}}),e=!0),("i-text"==t.get("type")||"textbox"==t.get("type"))&&m.find("#textarea-input").val(t.get("text")),"animatedText"==t.get("assetType")&&m.find("#animated-text input").val(eh.find(e=>e.id==t.id).text),m.find("#object-x input").val(parseFloat((t.get("left")-e8.get("left")-t.get("width")*t.get("scaleX")/2).toFixed(2))),m.find("#object-y input").val(parseFloat((t.get("top")-e8.get("top")-t.get("height")*t.get("scaleY")/2).toFixed(2))),m.find("#object-o").val(parseFloat(t.get("opacity"))),m.find("#object-w input").val(parseFloat((t.get("width")*t.get("scaleX")).toFixed(2))),m.find("#object-h input").val(parseFloat((t.get("height")*t.get("scaleY")).toFixed(2))),m.find("#object-r input").val(parseFloat(t.get("angle").toFixed(2))),m.find("#object-stroke input").val(parseFloat(t.get("strokeWidth").toFixed(2))),"group"!=t.get("type")&&(m.find("#object-shadow-x input").val(parseFloat(t.shadow.offsetX.toFixed(2))),m.find("#object-shadow-y input").val(parseFloat(t.shadow.offsetY.toFixed(2))),m.find("#object-blur input").val(parseFloat(t.shadow.blur.toFixed(2))),T="stroke",e4.setColor(t.get("stroke")),T="shadow",e4.setColor(t.shadow.color)),("path"==t.get("type")||"i-text"==t.get("type")||"textbox"==t.get("type")||"rect"==t.get("type")||"circle"==t.get("type")||"polygon"==t.get("type"))&&(T="fill",e4.setColor(t.get("fill"))),e&&(t.toActiveSelection(),eY.requestRenderAll()),V=!1}else m.find("#canvas-w").val(e8.get("width")),m.find("#canvas-h").val(e8.get("height"))}function eU(e){let t=eY.getActiveObject();if(e4.isOpen())e4.hide();else{var i=!0;"object-color-fill"==e.attr("id")?(T="fill",e4.setColor(t.get("fill"))):"object-color-stroke"==e.attr("id")?(T="stroke",e4.setColor(t.get("stroke"))):"canvas-color"==e.attr("id")?(T="back",e4.setColor(eY.backgroundColor)):"text-color"==e.attr("id")?(T="text",e4.setColor(eh.find(e=>e.id==t.id).props.fill)):(T="shadow",e4.setColor(t.shadow.color)),i=!1,e4.show()}}function e6(e){var t=!1;"images-tab"==e?(t=!1,m.find("#uploaded-images-grid").html(""),es.slice().reverse().forEach(function(e){!e.hidden&&(t=!0,"image/svg+xml"==e.src.substring(e.src.indexOf(":")+1,e.src.indexOf(";"))?m.find("#uploaded-images-grid").append("<div class='image-grid-item local-file img-wrap'><div class='download-media svg' title='download'><span class='material-icons'>download_for_offline</span></div><div class='delete-media' title='delete'><span class='material-icons'>remove</span></div><div class='img-loader'></div><img class='lazy object-svg' draggable=false data-src='"+e.thumb+"' data-file='"+e.src+"' data-type='"+e.type+"' data-key='"+e.key+"' /></div>"):m.find("#uploaded-images-grid").append("<div class='image-grid-item local-file img-wrap'><div class='download-media img' title='download'><span class='material-icons'>download_for_offline</span></div><div class='delete-media' title='delete'><span class='material-icons'>remove</span></div><div class='img-loader'></div><img class='lazy image-grid-img' draggable=false data-src='"+e.thumb+"' data-file='"+e.src+"' data-type='"+e.type+"' data-key='"+e.key+"' /></div>"))}),e2.update(),m.find("#images-landing").remove(),t||m.find("#uploaded-images-grid").before('<div id="images-landing"><div id="landing-text" class="notice">'+pmotionParams.t127+"</div></div>")):"videos-tab"!=e||(t=!1,m.find("#uploaded-videos-grid").html(""),er.slice().reverse().forEach(function(e){e.hidden||(t=!0,m.find("#uploaded-videos-grid").append("<div class='video-grid-item local-file img-wrap'><div class='download-media video' title='download'><span class='material-icons'>download_for_offline</span></div><div class='delete-media' title='delete'><span class='material-icons'>remove</span></div><div class='img-loader'></div><img class='lazy video-grid-img' draggable=false data-src='"+e.thumb+"' data-file='"+e.src+"' data-type='"+e.type+"' data-key='"+e.key+"' /></div>"))}),e2.update(),m.find("#videos-landing").remove(),t||m.find("#uploaded-videos-grid").before('<div id="videos-landing"><div id="landing-text" class="notice">'+pmotionParams.t128+"</div></div>"))}m.find(".dropdown-wrap").on("click",function(){e(this).hasClass("opened")?(e(this).removeClass("opened"),e(this).find(".dropdown").hide()):(e(this).addClass("opened"),e(this).find(".dropdown").show())}),m.on("input paste keyup keydown",'input[type="number"]',function(e){let t=parseInt(e.target.value);/^-?\d+(\.\d+)?$/.test(t)?e.target.max&&t>e.target.max?e.target.value=e.target.max:e.target.min&&t<e.target.min&&(e.target.value=e.target.min):e.target.value=0}),m.on("input paste","#textarea-input",function(){e(this).focus(),eo=!0,eY.getActiveObject().set("text",e(this).val()),eY.requestRenderAll()}),m.find("#theme-switcher").on("click",function(){m.addClass("no-transition");var t="dark";e(this).hasClass("light")?(e(this).removeClass("light"),e(this).addClass("dark"),e(this).html('<span class="material-icons">wb_sunny</span>')):e(this).hasClass("dark")&&(t="light",e(this).removeClass("dark"),e(this).addClass("light"),e(this).html('<span class="material-icons">nightlight</span>'));var i=$.baseURL+"css/"+t+".css";e("#theme-css").attr("href",i),setTimeout(function(){m.removeClass("no-transition")},500)}),m.on("click",".order-toggle-item:not(.order-toggle-item-active)",function(){var t=eY.getActiveObject();m.find(".order-toggle-item-active").removeClass("order-toggle-item-active"),"order-backward"==e(this).attr("id")?eh.find(e=>e.id==t.id).setProp({order:"backward"},eY):"order-forward"==e(this).attr("id")&&eh.find(e=>e.id==t.id).setProp({order:"forward"},eY),e(this).addClass("order-toggle-item-active"),tS(!1,A),t_()}),m.on("click",".order-toggle-item-2:not(.order-toggle-item-active-2)",function(){var t=eY.getActiveObject();m.find(".order-toggle-item-active-2").removeClass("order-toggle-item-active-2"),"type-words"==e(this).attr("id")?eh.find(e=>e.id==t.id).setProp({typeAnim:"word"},eY):"type-letters"==e(this).attr("id")&&eh.find(e=>e.id==t.id).setProp({typeAnim:"letter"},eY),e(this).addClass("order-toggle-item-active-2"),tS(!1,A),t_()}),m.on("change",".rangeslider",function(){var t=e(this).attr("id"),i=eY.getActiveObject();"object-o"==t?tX("opacity",i,A,parseFloat(e(this).val()),!0):"text-h"==t&&tX("charSpacing",i,A,10*parseFloat(e(this).val()),!0),"timeline-zoom"!=t&&"qrcode"!=t.substring(0,6)&&t_()}),m.on("input",".rangeslider",function(){if("timeline-zoom"==e(this).attr("id")&&tG(-1*(parseInt(e(this).val())-51)),eY.getActiveObjects().length>0&&e(this).val()){var t=eY.getActiveObject();if(t.get("assetType")&&"video"==t.get("assetType"))return!1;"object-o"==e(this).attr("id")?(eY.getActiveObject().set("opacity",parseFloat(e(this).val())),eY.requestRenderAll()):"text-h"==e(this).attr("id")?(eY.getActiveObject().set("charSpacing",10*parseFloat(e(this).val())),eY.requestRenderAll()):"filter-brightness"==e(this).attr("id")?(t.filters.find(e=>"Brightness"==e.type)?t.filters.find(e=>"Brightness"==e.type).brightness=parseInt(e(this).val())/100:t.filters.push(new em.Brightness({brightness:parseInt(e(this).val())/100})),t.applyFilters(),eY.requestRenderAll()):"filter-contrast"==e(this).attr("id")?(t.filters.find(e=>"Contrast"==e.type)?t.filters.find(e=>"Contrast"==e.type).contrast=parseInt(e(this).val())/100:t.filters.push(new em.Contrast({contrast:parseInt(e(this).val())/100})),t.applyFilters(),eY.requestRenderAll()):"filter-saturation"==e(this).attr("id")?(t.filters.find(e=>"Saturation"==e.type)?t.filters.find(e=>"Saturation"==e.type).saturation=parseInt(e(this).val())/100:t.filters.push(new em.Saturation({saturation:parseInt(e(this).val())/100})),t.applyFilters(),eY.requestRenderAll()):"filter-vibrance"==e(this).attr("id")?(t.filters.find(e=>"Vibrance"==e.type)?t.filters.find(e=>"Vibrance"==e.type).vibrance=parseInt(e(this).val())/100:t.filters.push(new em.Vibrance({vibrance:parseInt(e(this).val())/100})),t.applyFilters(),eY.requestRenderAll()):"filter-hue"==e(this).attr("id")?(t.filters.find(e=>"HueRotation"==e.type)?t.filters.find(e=>"HueRotation"==e.type).rotation=parseInt(e(this).val())/100:t.filters.push(new em.HueRotation({rotation:parseInt(e(this).val())/100})),t.applyFilters(),eY.requestRenderAll()):"filter-noise"==e(this).attr("id")?(t.filters.find(e=>"Noise"==e.type)?t.filters.find(e=>"Noise"==e.type).noise=parseInt(e(this).val()):t.filters.push(new em.Noise({noise:parseInt(e(this).val())})),t.applyFilters(),eY.requestRenderAll()):"filter-blur"==e(this).attr("id")&&(t.filters.find(e=>"Blur"==e.type)?t.filters.find(e=>"Blur"==e.type).blur=parseInt(e(this).val()):t.filters.push(new em.Blur({blur:parseInt(e(this).val())})),t.applyFilters(),eY.requestRenderAll())}}),m.on("change",".form-field",function(){if(eY.getActiveObjects().length>0){if(e(this).val()){var t,i,a=eY.getActiveObject();if("animated-text"==e(this).parent().attr("id")||"anim-weight"==e(this).attr("id")||a.get("assetType")&&"video"==a.get("assetType"))return!1;if("animated-text-duration"==e(this).parent().attr("id")){var o=R.find(e=>e.id==a.id),n=o.end-o.start;return 1e3*parseInt(m.find("#durationinput").val())>n&&m.find("#durationinput").val(n/1e3),eh.find(e=>e.id==a.id).setProp({duration:1e3*parseInt(m.find("#durationinput").val())},eY),t_(),!1}var s=e(this).parent().attr("id"),r=0;if(m.find("#object-stroke").length&&(r=parseFloat(m.find("#object-stroke input").val())),a.set({left:parseFloat(m.find("#object-x input").val())+e8.get("left")+a.get("width")*a.get("scaleX")/2,top:parseFloat(m.find("#object-y input").val())+e8.get("top")+a.get("height")*a.get("scaleY")/2,scaleX:parseFloat(m.find("#object-w input").val()/a.get("width")),scaleY:parseFloat(m.find("#object-h input").val()/a.get("height")),angle:parseFloat(m.find("#object-r input").val()),opacity:parseFloat(m.find("#object-o").val()),strokeWidth:r}),"group"!=a.get("type")&&a.set({shadow:{color:a.shadow.color,offsetX:parseFloat(m.find("#object-shadow-x input").val()),offsetY:parseFloat(m.find("#object-shadow-y input").val()),opacity:1,blur:parseFloat(m.find("#object-blur input").val())}}),eY.requestRenderAll(),e(this)[0].hasAttribute("id")&&"qrcode"==e(this).attr("id").substring(0,6)||e(this)[0].hasAttribute("id")&&"gif-fps"==e(this).attr("id"))return;e(this).val().length>0&&ez(),t=a,"object-x"==(i=s)||"object-y"==i?(tX("left",t,A,t.get("left"),!0),tX("top",t,A,t.get("top"),!0)):"object-w"==i||"object-h"==i?(tX("scaleX",t,A,t.get("scaleX"),!0),tX("scaleY",t,A,t.get("scaleY"),!0),tX("width",t,A,t.get("width"),!0),tX("height",t,A,t.get("height"),!0)):"object-r"==i?tX("angle",t,A,t.get("angle"),!0):"object-stroke"==i?(tX("stroke",t,A,t.get("stroke"),!0),tX("strokeWidth",t,A,t.get("strokeWidth"),!0)):("object-shadow-x"==i||"object-shadow-y"==i||"object-blur"==i)&&(tX("shadow.color",t,A,t.shadow.color,!0),tX("shadow.offsetX",t,A,t.shadow.offsetX,!0),tX("shadow.offsetY",t,A,t.shadow.offsetY,!0),tX("shadow.blur",t,A,t.shadow.blur,!0)),t_()}}else{if("canvas-w"==e(this).attr("id")||"canvas-h"==e(this).attr("id")){e8.set({width:parseFloat(m.find("#canvas-w").val()),height:parseFloat(m.find("#canvas-h").val())}),eY.requestRenderAll(),tv();return}if("canvas-duration"!=e(this).attr("id")||isNaN(parseFloat(e(this).val()))||t6(1e3*parseFloat(e(this).val())),e(this).attr("id")&&"qrcode"==e(this).attr("id").substring(0,6))return;if(e(this)[0].hasAttribute("id")&&"gif-fps"==e(this).attr("id"))return;t_()}}),m.on("click","#animatedset",function(){var t=eY.getActiveObject();eh.find(e=>e.id==t.id).reset(e(this).parent().find("input").val(),eh.find(e=>e.id==t.id).props,eY,t)}),m.on("click","#canvas-color",function(){eU(e(this))}),m.on("click","#object-color-fill",function(){eU(e(this))}),m.on("click","#object-color-stroke",function(){eU(e(this))}),m.on("click","#object-color-shadow",function(){eU(e(this))}),m.on("click","#text-color",function(){eU(e(this))}),m.on("click","#canvas-presets > div",function(){m.find("#canvas-w").val(e(this).attr("data-width")),m.find("#canvas-h").val(e(this).attr("data-height")),m.find("#canvas-w").trigger("change"),tv()}),m.on("click",".animated-text-item",function(){var t=new tu(pmotionParams.t92,{left:e8.get("left")+e8.get("width")/2,top:e8.get("top")+e8.get("height")/2,preset:e(this).attr("data-id"),typeAnim:"letter",order:"forward",fontFamily:$.fontFamily,fontWeight:"normal",duration:1e3,easing:"linear",fill:"#000"});eh.push(t),t.render(eY)});var eG=!1,eV=!1;function eN(e,t){if(3==e.which)return!1;var i=t.clone();0===i.width()&&i.width(340),i.css({background:"transparent",boxShadow:"none",color:"#4affff",border:"none",position:"absolute",zIndex:9999999,left:t.offset().left,top:t.offset().top,width:eY.getZoom()*i.width(),pointerEvents:"none",opacity:0,transition:"none"}),i.appendTo("body");var a=e.pageX,o=e.pageY,n=i.offset(),s=i.offset().left+i.width()/2-e.pageX,r=i.offset().top+i.height()/2-e.pageY;J=!0;var l=!1;function d(e){m.addClass("cursor-grabbing"),m.find("#bottom-area").addClass("noselect"),m.find("#toolbar").addClass("noselect"),m.find("#browser").addClass("noselect"),m.find("#properties").addClass("noselect"),m.find("#controls").addClass("noselect"),l=!0;var t=n.left+(e.pageX-a),s=n.top+(e.pageY-o);i.offset({left:t,top:s}),Z?i.css({opacity:1}):i.css({opacity:.5})}function c(e){m.removeClass("cursor-grabbing"),m.find("#bottom-area").removeClass("noselect"),m.find("#toolbar").removeClass("noselect"),m.find("#browser").removeClass("noselect"),m.find("#properties").removeClass("noselect"),m.find("#controls").removeClass("noselect"),J=!1,m.off("mousemove",d).off("mouseup",c),K=eY.getPointer(e).x,M=eY.getPointer(e).y;var t=K+s-e8.get("left"),a=M+r-e8.get("top");if(!Z&&l)return i.remove(),!1;l?i.hasClass("object-svg")?tq(i.attr("data-file"),t,a,300,!1):i.hasClass("stock-img")?(m.find("#load-image").addClass("loading-active"),tl(i.attr("data-file"),t,a,i.width())):i.hasClass("stock-video")?tc(i.attr("data-file"),i.attr("data-src"),t,a):i.hasClass("image-grid-img")?(m.find("#load-image").addClass("loading-active"),t5(i.attr("data-file"),t,a,i.width(),!1)):i.hasClass("object-img")?(m.find("#load-image").addClass("loading-active"),t5(i.attr("data-file"),t,a,i.width(),!1)):i.hasClass("add-text")?"heading-text"==i.attr("id")?tz(80,700,pmotionParams.t93,K-e8.get("left"),M-e8.get("top"),i.width(),!1,i.attr("data-font")):"subheading-text"==i.attr("id")?tz(60,500,pmotionParams.t94,K-e8.get("left"),M-e8.get("top"),i.width(),!1,i.attr("data-font")):"body-text"==i.attr("id")?tz(50,400,pmotionParams.t95,K-e8.get("left"),M-e8.get("top"),i.width(),!1,i.attr("data-font")):tz(60,400,pmotionParams.t96,K-e8.get("left"),M-e8.get("top"),i.width(),!1,i.attr("data-font")):i.hasClass("video-grid-img")&&(m.find("#load-video").addClass("loading-active"),tE(i.attr("data-file"),K,M)):i.hasClass("object-svg")?tq(i.attr("data-file"),e8.get("left")+e8.get("width")/2,e8.get("top")+e8.get("height")/2,300,!0):i.hasClass("stock-img")?tl(i.attr("data-file"),e8.get("left")+e8.get("width")/2,e8.get("top")+e8.get("height")/2,150):i.hasClass("stock-video")?tc(i.attr("data-file"),i.attr("data-src"),e8.get("left")+e8.get("width")/2,e8.get("top")+e8.get("height")/2):i.hasClass("image-grid-img")?(m.find("#load-image").addClass("loading-active"),t5(i.attr("data-file"),e8.get("left")+e8.get("width")/2,e8.get("top")+e8.get("height")/2,150,!0)):i.hasClass("object-img")?(m.find("#load-image").addClass("loading-active"),t5(i.attr("data-file"),e8.get("left")+e8.get("width")/2,e8.get("top")+e8.get("height")/2,50,!0)):i.hasClass("add-text")?"heading-text"==i.attr("id")?tz(70,700,pmotionParams.t93,e8.get("left")+e8.get("width")/2,e8.get("top")+e8.get("height")/2,i.width(),!0,i.attr("data-font")):"subheading-text"==i.attr("id")?tz(60,500,pmotionParams.t94,e8.get("left")+e8.get("width")/2,e8.get("top")+e8.get("height")/2,i.width(),!0,i.attr("data-font")):"body-text"==i.attr("id")?tz(50,400,pmotionParams.t95,e8.get("left")+e8.get("width")/2,e8.get("top")+e8.get("height")/2,i.width(),!0,i.attr("data-font")):tz(50,400,pmotionParams.t96,e8.get("left")+e8.get("width")/2,e8.get("top")+e8.get("height")/2,i.width(),!0,i.attr("data-font")):i.hasClass("video-grid-item")&&(m.find("#load-video").addClass("loading-active"),tE(i.attr("data-file"),e8.get("left")+e8.get("width")/2,e8.get("top")+e8.get("height")/2,!0)),i.remove(),t_()}eY.discardActiveObject(),eY.requestRenderAll(),m.on("mouseup",c).on("mousemove",d)}function eK(){m.find(".modal-open").removeClass("modal-open")}function eM(e){""==e.val().toLowerCase()?e.next().removeClass("show-delete"):e.next().addClass("show-delete")}function eZ(e){let t=`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`;return t}function eJ(e){if(!e.ok)throw Error(e.status);return e}function eQ(t,i){var a=$.PexelsLanguage,o=$.PexelsPagination,n=m.find("#pexels-orientation").val(),s=m.find("#pexels-color").val(),r=m.find("#pexels-img-search").val(),l="",d="";""==n&&""==s&&""==r?l="https://api.pexels.com/v1/curated?locale="+a+"&page="+i+"&per_page="+o:(l="https://api.pexels.com/v1/search?locale="+a+"&",""!=r?l+="query="+(r=encodeURIComponent(r))+"&":l+="query=&",""!=n&&(l+="orientation="+n+"&"),""!=s&&(l+="color="+s+"&"),l+="page="+i+"&per_page="+o);var c='<div id="pexels-img-grid" class="css-grid">',f="</div>",p='<button id="pexels-loadmore" type="button" class="btn btn-full primary" autocomplete="off" data-page="'+parseInt(i)+'">'+pmotionParams.t98+"</button>";$.apiCaching&&sessionStorage.getItem(l)?("search"==t?m.find("#pexels-img-output").html(c+sessionStorage.getItem(l)+f+p):(m.find("#pexels-img-grid").append(sessionStorage.getItem(l)),m.find("#pexels-loadmore").remove(),m.find("#pexels-img-grid").after(p)),m.find("#image-tool").css("pointer-events","auto"),m.find("#image-tool").css("opacity",1),e2.update()):fetch(l,{method:"GET",headers:{Authorization:$.PexelsApiKey},redirect:"follow"}).then(eJ).then(e=>e.json()).then(i=>{var a=i.photos;""==a?(d='<div class="notice notice-warning">'+pmotionParams.t97+"</div>","search"==t?(m.find("#pexels-img-output").html(d),m.find("#pexels-loadmore").prop("disabled",!1)):m.find("#pexels-loadmore").prop("disabled",!0)):(e.each(a,function(e,t){var i=t.url,a=t.src,o=a.tiny,n=a[$.PexelsImgSize],s=t.alt;d+='<div class="image-grid-item">',d+='<a href="'+i+'" class="stock-url" target="_blank"><span class="material-icons">info</span></a>',d+='<div class="img-wrap">',d+='<div class="img-loader"></div>',d+='<img class="lazy stock-img" draggable=false data-src="'+o+'" data-file="'+n+'" title="'+s+'" />',d+="</div>",d+="</div>"}),"search"==t?m.find("#pexels-img-output").html(c+d+f+p):(m.find("#pexels-img-grid").append(d),m.find("#pexels-loadmore").remove(),m.find("#pexels-img-grid").after(p)),$.apiCaching&&sessionStorage.setItem(l,d),e2.update(),m.find("#image-tool").css("pointer-events","auto"),m.find("#image-tool").css("opacity",1))}).catch(e=>{toastr.error(e,pmotionParams.t105),m.find("#image-tool").css("pointer-events","auto"),m.find("#image-tool").css("opacity",1)})}function e9(t,i){var a=$.PexelsLanguage,o=$.PexelsPagination,n=m.find("#pexels-video-orientation").val(),s=m.find("#pexels-video-search").val(),r="",l="";""!=i?r=i:""==n&&""==s?r="https://api.pexels.com/videos/popular?locale="+a+"&size=medium&per_page="+o:(r="https://api.pexels.com/videos/search?locale="+a+"&size=medium&",""!=s?r+="query="+(s=encodeURIComponent(s))+"&":r+="query=&",""!=n&&(r+="orientation="+n+"&"),r+="per_page="+o);var d='<div id="pexels-video-grid" class="css-grid">',c="</div>";$.apiCaching&&sessionStorage.getItem(r)?("search"==t?m.find("#pexels-video-output").html(d+sessionStorage.getItem(r)+c):m.find("#pexels-video-grid").append(sessionStorage.getItem(r)),m.find("#video-tool").css("pointer-events","auto"),m.find("#video-tool").css("opacity",1),e2.update()):fetch(r,{method:"GET",headers:{Authorization:$.PexelsApiKey},redirect:"follow"}).then(eJ).then(e=>e.json()).then(i=>{var a=i.videos,o='<button id="pexels-video-loadmore" type="button" class="btn btn-full primary" autocomplete="off" data-next="">'+pmotionParams.t98+"</button>";void 0!==i.next_page&&(o='<button id="pexels-video-loadmore" type="button" class="btn btn-full primary" autocomplete="off" data-next="'+i.next_page+'">'+pmotionParams.t98+"</button>"),""==a?(l='<div class="notice notice-warning">'+pmotionParams.t97+"</div>","search"==t?(m.find("#pexels-video-output").html(l),m.find("#pexels-video-loadmore").prop("disabled",!1)):m.find("#pexels-video-loadmore").prop("disabled",!0)):(e.each(a,function(t,i){var a=!1,o=i.video_files[0].link;e.each(i.video_files,function(e,t){a||1280!=t.width||(o=t.link,a=!0)});var n=i.url,s=i.duration,r=i.video_pictures[0].picture;l+='<div class="image-grid-item">',l+='<a href="'+n+'" class="stock-url" target="_blank"><span class="material-icons">info</span></a>',l+='<div class="img-wrap">',l+='<div class="img-loader"></div>',l+='<img class="lazy stock-video" draggable=false data-src="'+r+'" data-file="'+o+'" />',l+='<div class="video-duration">'+eZ(s)+"</div>",l+="</div>",l+="</div>"}),"search"==t?m.find("#pexels-video-output").html(d+l+c):m.find("#pexels-video-grid").append(l),$.apiCaching&&sessionStorage.setItem(r,l),e2.update(),m.find("#pexels-video-loadmore").remove(),m.find("#pexels-video-output").append(o),m.find("#video-tool").css("pointer-events","auto"),m.find("#video-tool").css("opacity",1))}).catch(e=>{toastr.error(e,pmotionParams.t105),m.find("#video-tool").css("pointer-events","auto"),m.find("#video-tool").css("opacity",1)})}function te(t,i){var a=m.find("#pixabay-orientation").find(":selected").val(),o=m.find("#pixabay-color").find(":selected").val(),n=m.find("#pixabay-img-search").val(),s=m.find("#pixabay-category").find(":selected").val(),r=$.PixabayLanguage,l=$.PixabaySafeSearch,d=$.PixabayEditorsChice,c=$.PixabayPagination,f="",p="";""==a&&""==o&&""==n&&""==s?f="https://pixabay.com/api/?key="+$.PixabayApiKey+"&editors_choice=true&order=latest&image_type=photo&lang="+r+"&safesearch="+l+"&page="+i+"&per_page="+c:(f="https://pixabay.com/api/?key="+$.PixabayApiKey+"&image_type=photo&order=latest&lang="+r+"&safesearch="+l+"&editors_choice="+d+"&",""!=n&&(f+="q="+(n=encodeURIComponent(n))+"&"),""!=a&&(f+="orientation="+a+"&"),""!=o&&(f+="color="+o+"&"),""!=s&&(f+="category="+s+"&"),f+="page="+i+"&per_page="+c);var g='<div id="pixabay-img-grid" class="css-grid">',u="</div>",h='<button id="pixabay-loadmore" type="button" class="btn btn-full primary" autocomplete="off" data-page="'+parseInt(i)+'">'+pmotionParams.t98+"</button>";$.apiCaching&&sessionStorage.getItem(f)?("search"==t?m.find("#pixabay-img-output").html(g+sessionStorage.getItem(f)+u+h):(m.find("#pixabay-img-grid").append(sessionStorage.getItem(f)),m.find("#pixabay-loadmore").remove(),m.find("#pixabay-img-grid").after(h)),m.find("#image-tool").css("pointer-events","auto"),m.find("#image-tool").css("opacity",1),e2.update()):e.ajax({url:f,type:"POST",timeout:0,crossDomain:!0,processData:!1,contentType:!1,success:function(i){if(i){if(parseInt(i.totalHits)>0){var a=i.hits;e.each(a,function(e,t){var i=t.pageURL,a=t.webformatURL,o=t.largeImageURL;void 0!==t.fullHDURL&&(o=t.fullHDURL);var n=t.tags;p+='<div class="image-grid-item">',p+='<a href="'+i+'" class="stock-url" target="_blank"><span class="material-icons">info</span></a>',p+='<div class="img-wrap">',p+='<div class="img-loader"></div>',p+='<img class="lazy stock-img" draggable=false data-src="'+a+'" data-file="'+o+'" title="'+n+'" />',p+="</div>",p+="</div>"}),"search"==t?m.find("#pixabay-img-output").html(g+p+u+h):(m.find("#pixabay-img-grid").append(p),m.find("#pixabay-loadmore").remove(),m.find("#pixabay-img-grid").after(h)),$.apiCaching&&sessionStorage.setItem(f,p),e2.update()}else p='<div class="notice notice-warning">'+pmotionParams.t97+"</div>","search"==t?(m.find("#pixabay-img-output").html(p),m.find("#pixabay-loadmore").prop("disabled",!1)):m.find("#pixabay-loadmore").prop("disabled",!0);m.find("#image-tool").css("pointer-events","auto"),m.find("#image-tool").css("opacity",1)}},error:function(e,t,i){e.status&&400==e.status?toastr.error(e.responseText,pmotionParams.t105):toastr.error(pmotionParams.t99,pmotionParams.t105),m.find("#image-tool").css("pointer-events","auto"),m.find("#image-tool").css("opacity",1),m.find("#pixabay-loadmore").prop("disabled",!1)}})}function tt(t,i){var a=m.find("#pixabay-orientation-video").find(":selected").val(),o=m.find("#pixabay-color-video").find(":selected").val(),n=m.find("#pixabay-video-search").val(),s=m.find("#pixabay-category-video").find(":selected").val(),r=$.PixabayLanguage,l=$.PixabaySafeSearch,d=$.PixabayEditorsChice,c=$.PixabayPagination,f="",p="";""==a&&""==o&&""==n&&""==s?f="https://pixabay.com/api/videos/?key="+$.PixabayApiKey+"&editors_choice=true&order=latest&video_type=all&lang="+r+"&safesearch="+l+"&page="+i+"&per_page="+c:(f="https://pixabay.com/api/videos/?key="+$.PixabayApiKey+"&video_type=all&order=latest&lang="+r+"&safesearch="+l+"&editors_choice="+d+"&",""!=n&&(f+="q="+(n=encodeURIComponent(n))+"&"),""!=a&&(f+="orientation="+a+"&"),""!=o&&(f+="color="+o+"&"),""!=s&&(f+="category="+s+"&"),f+="page="+i+"&per_page="+c);var g='<div id="pixabay-video-grid" class="css-grid">',u="</div>",h='<button id="pixabay-video-loadmore" type="button" class="btn btn-full primary" autocomplete="off" data-page="'+parseInt(i)+'">'+pmotionParams.t98+"</button>";$.apiCaching&&sessionStorage.getItem(f)?("search"==t?m.find("#pixabay-video-output").html(g+sessionStorage.getItem(f)+u+h):(m.find("#pixabay-video-grid").append(sessionStorage.getItem(f)),m.find("#pixabay-video-loadmore").remove(),m.find("#pixabay-video-grid").after(h)),m.find("#video-tool").css("pointer-events","auto"),m.find("#video-tool").css("opacity",1),e2.update()):e.ajax({url:f,type:"POST",timeout:0,crossDomain:!0,processData:!1,contentType:!1,success:function(i){if(i){if(parseInt(i.totalHits)>0){var a=i.hits;e.each(a,function(e,t){var i=t.pageURL,a=t.duration,o=t.videos.tiny.thumbnail,n=t.videos.small.url;""!=t.videos.medium.url&&(n=t.videos.medium.url);var s=t.tags;p+='<div class="image-grid-item">',p+='<a href="'+i+'" class="stock-url" target="_blank"><span class="material-icons">info</span></a>',p+='<div class="img-wrap">',p+='<div class="img-loader"></div>',p+='<img class="lazy stock-video" draggable=false data-src="'+o+'" data-file="'+n+'" title="'+s+'" />',p+='<div class="video-duration">'+eZ(a)+"</div>",p+="</div>",p+="</div>"}),"search"==t?m.find("#pixabay-video-output").html(g+p+u+h):(m.find("#pixabay-video-grid").append(p),m.find("#pixabay-video-loadmore").remove(),m.find("#pixabay-video-grid").after(h)),$.apiCaching&&sessionStorage.setItem(f,p),e2.update()}else p='<div class="notice notice-warning">'+pmotionParams.t97+"</div>","search"==t?(m.find("#pixabay-video-output").html(p),m.find("#pixabay-video-loadmore").prop("disabled",!1)):m.find("#pixabay-video-loadmore").prop("disabled",!0);m.find("#video-tool").css("pointer-events","auto"),m.find("#video-tool").css("opacity",1)}},error:function(e,t,i){e.status&&400==e.status?toastr.error(e.responseText,pmotionParams.t105):toastr.error(pmotionParams.t99,pmotionParams.t105),m.find("#video-tool").css("pointer-events","auto"),m.find("#video-tool").css("opacity",1),m.find("#pixabay-video-loadmore").prop("disabled",!1)}})}function ti(){if(function t(){if(eY.getActiveObject()){var i=eY.getActiveObject();i.filters&&i.filters.length>0?eg.forEach(function(e){var t="";"filter-hue"==e.name?t="HueRotation":"filter-brightness"==e.name?t="Brightness":"filter-vibrance"==e.name?t="Vibrance":"filter-contrast"==e.name?t="Contrast":"filter-saturation"==e.name?t="Saturation":"filter-noise"==e.name?t="Noise":"filter-blur"==e.name&&(t="Blur"),i.filters.find(e=>e.type==t)||e.slider.setValue(0)}):m.find(".img-filters .rangeslider").each(function(){e(this).val(0)})}}(),eY.getActiveObject()){var t=eY.getActiveObject();if(1==eY.getActiveObjects().length&&("image"==t.type||"video"==t.type)){var i="none";t.filters.length>0?t.filters.forEach(function(e){"BlackWhite"==e.type||"Invert"==e.type||"Sepia"==e.type||"Kodachrome"==e.type||"Polaroid"==e.type||"Technicolor"==e.type||"Brownie"==e.type||"Grayscale"==e.type||"Vintage"==e.type?i=e.type:"Brightness"==e.type?m.find("#filter-brightness").val(100*e.brightness):"Contrast"==e.type?m.find("#filter-contrast").val(100*e.contrast):"Vibrance"==e.type?m.find("#filter-vibrance").val(100*e.vibrance):"Saturation"==e.type?m.find("#filter-saturation").val(100*e.saturation):"HueRotation"==e.type?m.find("#filter-hue").val(100*e.rotation):"Blur"==e.type?m.find("#filter-blur").val(100*e.blur):"Noise"==e.type&&m.find("#filter-noise").val(e.noise),m.find("#filters-list").val(i)}):m.find("#filters-list").val(i),eY.requestRenderAll()}}}function ta(e){e.stopPropagation(),e.preventDefault(),m.find("#speed-settings").toggleClass("show-speed"),m.find("#speed-arrow").toggleClass("arrow-on"),m.find("#speed-arrow").hasClass("arrow-on")?m.find("#speed-arrow").html("expand_less"):m.find("#speed-arrow").html("expand_more")}m.on("click",".upload-tab:not(.upload-tab-active)",function(){m.find(".upload-tab-active").removeClass("upload-tab-active"),e(this).addClass("upload-tab-active"),"images-tab"==e(this).attr("id")?(m.find("#uploaded-videos").addClass("d-none"),m.find("#uploaded-images").removeClass("d-none"),eG||(e6("images-tab"),eG=!0)):(m.find("#uploaded-images").addClass("d-none"),m.find("#uploaded-videos").removeClass("d-none"),eV||(e6("videos-tab"),eV=!0))}),m.on("click",".nav-tab:not(.nav-tab-active)",function(){var t=e(this).parent().parent(),i=e(this).attr("data-target");t.find(".nav-tab-active").removeClass("nav-tab-active"),e(this).addClass("nav-tab-active"),t.find(".nav-tab-content").addClass("d-none"),t.find("#"+i).removeClass("d-none")}),m.on("click",".tool:not(.tool-active)",function(){var t;m.find("#browser").hasClass("collapsed")&&(m.find("#browser").removeClass("collapsed"),m.find("#canvas-area").removeClass("canvas-full"),tv()),m.find(".tool").removeClass("tool-active"),e(this).addClass("tool-active"),t=e(this).attr("data-id"),m.find("#browser-container > div").addClass("d-none"),m.find("#"+t).removeClass("d-none"),"upload-tool"!=t||(m.find("#images-tab").trigger("click"),eG||(e6("images-tab"),eG=!0))}),m.on("click","#back-to-canvas-settings",function(){eY.discardActiveObject(),eY.requestRenderAll()}),m.on("mousedown",".stock-img",function(t){eN(t,e(this))}),m.on("mousedown",".stock-video",function(t){eN(t,e(this))}),m.on("mousedown",".image-grid-img",function(t){eN(t,e(this))}),m.on("mousedown",".video-grid-img",function(t){eN(t,e(this))}),m.on("mousedown",".object-img",function(t){eN(t,e(this))}),m.on("mousedown",".object-svg",function(t){eN(t,e(this))}),m.on("mousedown",".add-text",function(t){eN(t,e(this))}),m.on("click",".tool-active",function(){m.find("#browser").addClass("collapsed"),m.find("#canvas-area").addClass("canvas-full"),m.find(".tool-active").removeClass("tool-active"),tv()}),m.on("click",".collapse",function(){m.find("#browser").addClass("collapsed"),m.find("#canvas-area").addClass("canvas-full"),m.find(".tool-active").removeClass("tool-active"),tv()}),m.on("change","#preset-picker",function(){var t=eY.getActiveObject();eh.find(e=>e.id==t.id).setProp({preset:e(this).val()},eY),t_()}),m.on("change","#easing-picker",function(){var t=eY.getActiveObject();eh.find(e=>e.id==t.id).setProp({easing:e(this).val()},eY),t_()}),m.on("click",".download-media",function(t){var i,a,o,n,s,r,l;i=t,a=e(this),i.preventDefault(),i.stopPropagation(),o=new Date().getTime(),n=a.parent().find("img").attr("data-file"),s=document.createElement("a"),r=function e(t){for(var i=t.split(","),a=i[0].match(/:(.*?);/)[1],o=atob(i[1]),n=o.length,s=new Uint8Array(n);n--;)s[n]=o.charCodeAt(n);return new Blob([s],{type:a})}(n),l=URL.createObjectURL(r),a.hasClass("svg")?s.download=o+".svg":a.hasClass("img")?s.download=o+".png":a.hasClass("video")&&(s.download=o+".mp4"),s.href=l,s.click()}),m.on("click",".delete-media",function(t){var i,a;i=t,a=e(this),i.preventDefault(),i.stopPropagation(),tf(a.parent().find("img").attr("data-key"))}),m.on("click",".audio-asset-delete",function(t){t.preventDefault(),t.stopPropagation(),tf(e(this).attr("data-id")),e(this).parent().parent().remove()}),m.on("focusout",".layer-custom-name",function e(){m.find(".name-active").length&&(m.find(".name-active").prop("readonly",!0),""==m.find(".name-active").val()&&m.find(".name-active").val(pmotionParams.t139),F.find(e=>e.id==m.find(".name-active").parent().parent().attr("data-object")).label=m.find(".name-active").val(),t_(),m.find(".name-active").removeClass("name-active"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),eo=!1)}),m.on("click",".zoom-item",function(){var t;t="in"==e(this).attr("data-zoom")?parseFloat(eY.getZoom())+.05:"out"==e(this).attr("data-zoom")?parseFloat(eY.getZoom())-.05:parseInt(e(this).attr("data-zoom"))/100,eY.setZoom(1),eY.requestRenderAll();let i=eY.width/t,a=eY.height/t,o=e8.left+e8.width/2-i/2,n=e8.top+e8.height/2-a/2;eY.absolutePan({x:o,y:n}),eY.setZoom(t),eY.requestRenderAll(),m.find("#zoom-level .zoom-span").html((100*eY.getZoom()).toFixed(0)+"%")}),m.find("#background-overlay").on("click",eK),m.find("#download").on("click",function e(){W||(eK(),m.find("#download-modal").addClass("modal-open"),m.find("#background-overlay").addClass("modal-open"))}),m.on("click","#pexels-video-search",function(){eM(e(this))}),m.on("click","#pexels-img-search",function(){eM(e(this))}),m.on("click","#pixabay-img-search",function(){eM(e(this))}),m.on("click","#pixabay-video-search",function(){eM(e(this))}),m.on("click",".delete-search",function(){e(this).parent().find("input").val(""),e(this).parent().find("input").trigger("input"),e(this).removeClass("show-delete")}),""!=$.PexelsApiKey&&(eQ("search","1"),m.find("#pexels-img-search-btn").on("click",function(){m.find("#image-tool").css("pointer-events","none"),m.find("#image-tool").css("opacity",.7),eQ("search","1")}),m.find("#pexels-img-output").on("click","#pexels-loadmore",function(){e(this).prop("disabled",!0),m.find("#image-tool").css("pointer-events","none"),m.find("#image-tool").css("opacity",.7),eQ("loadmore",parseInt(e(this).data("page"))+1)}),m.find("#pexels-img-search").on("keyup input",function(){""==e(this).val()?(m.find("#pexels-orientation").val(""),m.find("#pexels-color").val(""),m.find("#pexels-orientation").prop("disabled",!0),m.find("#pexels-color").prop("disabled",!0)):(m.find("#pexels-orientation").prop("disabled",!1),m.find("#pexels-color").prop("disabled",!1))}),e9("search",""),m.find("#pexels-video-search-btn").on("click",function(){m.find("#video-tool").css("pointer-events","none"),m.find("#video-tool").css("opacity",.7),e9("search","")}),m.find("#pexels-video-output").on("click","#pexels-video-loadmore",function(){var t=e(this).attr("data-next");""!=t?(e(this).prop("disabled",!0),m.find("#video-tool").css("pointer-events","none"),m.find("#video-tool").css("opacity",.7),e9("loadmore",t)):e(this).prop("disabled",!0)}),m.find("#pexels-video-search").on("keyup input",function(){""==e(this).val()?(m.find("#pexels-video-orientation").val(""),m.find("#pexels-video-orientation").prop("disabled",!0)):m.find("#pexels-video-orientation").prop("disabled",!1)}),m.on("click","#pexels-videos-toggle",function(){e(this).hasClass("active")?(e(this).html(pmotionParams.t100+' <span class="material-icons">expand_more</span>'),m.find("#pexels-video-options").addClass("d-none"),e(this).removeClass("active")):(e(this).html(pmotionParams.t101+' <span class="material-icons">expand_less</span>'),m.find("#pexels-video-options").removeClass("d-none"),e(this).addClass("active"))}),m.on("click","#pexels-settings-toggle",function(){e(this).hasClass("active")?(e(this).html(pmotionParams.t100+' <span class="material-icons">expand_more</span>'),m.find("#pexels-search-options").addClass("d-none"),e(this).removeClass("active")):(e(this).html(pmotionParams.t101+' <span class="material-icons">expand_less</span>'),m.find("#pexels-search-options").removeClass("d-none"),e(this).addClass("active"))})),""!=$.PixabayApiKey&&(te("search","1"),m.find("#pixabay-img-search-btn").on("click",function(){m.find("#image-tool").css("pointer-events","none"),m.find("#image-tool").css("opacity",.7),te("search","1")}),m.find("#pixabay-img-output").on("click","#pixabay-loadmore",function(){e(this).prop("disabled",!0),m.find("#image-tool").css("pointer-events","none"),m.find("#image-tool").css("opacity",.7),te("loadmore",parseInt(e(this).data("page"))+1)}),tt("search","1"),m.find("#pixabay-video-search-btn").on("click",function(){m.find("#video-tool").css("pointer-events","none"),m.find("#video-tool").css("opacity",.7),tt("search","1")}),m.find("#pixabay-video-output").on("click","#pixabay-video-loadmore",function(){e(this).prop("disabled",!0),m.find("#video-tool").css("pointer-events","none"),m.find("#video-tool").css("opacity",.7),tt("loadmore",parseInt(e(this).data("page"))+1)}),m.on("click","#pixabay-videos-toggle",function(){e(this).hasClass("active")?(e(this).html(pmotionParams.t100+' <span class="material-icons">expand_more</span>'),m.find("#pixabay-video-options").addClass("d-none"),e(this).removeClass("active")):(e(this).html(pmotionParams.t101+' <span class="material-icons">expand_less</span>'),m.find("#pixabay-video-options").removeClass("d-none"),e(this).addClass("active"))}),m.on("click","#pixabay-settings-toggle",function(){e(this).hasClass("active")?(e(this).html(pmotionParams.t100+' <span class="material-icons">expand_more</span>'),m.find("#pixabay-search-options").addClass("d-none"),e(this).removeClass("active")):(e(this).html(pmotionParams.t101+' <span class="material-icons">expand_less</span>'),m.find("#pixabay-search-options").removeClass("d-none"),e(this).addClass("active"))})),m.on("click",".audio-item",function(){var t=eY.getObjects();if(t&&t.length>0&&t.forEach(function(e){e.get("assetType")&&"audio"==e.get("assetType")&&tU(e,eY)}),e(this).hasClass("audio-item-active"))e(this).removeClass("audio-item-active");else{m.find(".audio-item-active").removeClass("audio-item-active");var i=e(this).attr("data-file");tD(i,e(this)),(ec=new Audio(i)).crossOrigin="anonymous",ep=i,e(this).addClass("audio-item-active")}}),m.on("click",".delete-audio",function(){tU(eY.getActiveObject(),eY),t_()}),m.on("click",".audio-preview",function(t){var i,a,o;i=t,a=e(this),i.preventDefault(),i.stopPropagation(),o=a.parent().attr("data-file"),"play_arrow"==a.find("span").html()?((ef=new Audio(o)).crossOrigin="anonymous",ef.currentTime=0,ef.play(),a.find("span").html("pause")):(!1!=ef&&ef.pause(),a.find("span").html("play_arrow"))}),m.on("change","#filters-list",function(){var t=e(this).find(":selected").val();eY.getActiveObject()&&(!function t(){if(eY.getActiveObject()){var i=eY.getActiveObject();i.filters=e.grep(i.filters,function(e){return"BlackWhite"!=e.type&&"Invert"!=e.type&&"Sepia"!=e.type&&"Kodachrome"!=e.type&&"Polaroid"!=e.type&&"Technicolor"!=e.type&&"Brownie"!=e.type&&"Grayscale"!=e.type&&"Vintage"!=e.type}),eY.requestRenderAll()}}(),"none"==t?(eY.getActiveObject().applyFilters(),eY.requestRenderAll()):function e(t){if(eY.getActiveObject()){var i=eY.getActiveObject();"Grayscale"==t?i.filters.push(new em.Grayscale):"Sepia"==t?i.filters.push(new em.Sepia):"BlackWhite"==t?i.filters.push(new em.BlackWhite):"Brownie"==t?i.filters.push(new em.Brownie):"Vintage"==t?i.filters.push(new em.Vintage):"Kodachrome"==t?i.filters.push(new em.Kodachrome):"Technicolor"==t?i.filters.push(new em.Technicolor):"Polaroid"==t?i.filters.push(new em.Polaroid):"Invert"==t&&i.filters.push(new em.Invert),i.applyFilters(),t_()}}(t))}),m.on("click","#reset-filters",function(){m.find("#filters-list").val("none"),m.find("#filters-list").trigger("change"),m.find(".img-filters .rangeslider").each(function(){e(this).val(0),e(this).trigger("input")}),t_()}),m.on("click","#speed",ta),m.on("click",".speed",function(t){t.stopPropagation(),t.preventDefault(),_=parseFloat(e(this).attr("data-speed")),m.find("#speed-text").html(e(this).html()),ta(t),t_()}),x.config.debug=!1;var to=function(t,i){return 0===e(t).not(i).length&&0===e(i).not(t).length};function tn(t){m.find("#load-template").addClass("loading-active"),x.collection("projects").doc({id:t}).get().then(t=>{var i=t;S=JSON.parse(i.keyframes),R=JSON.parse(i.p_keyframes),F=JSON.parse(i.objects),T=i.colormode,I=i.duration,ee=i.layercount,_=i.speed,eh=JSON.parse(i.animatedtext),ec=!1,(ep=i.audiosrc)&&((ec=new Audio(ep)).crossOrigin="anonymous",m.find("#audio-list .audio-item").each(function(){if(e(this).attr("data-file")===ep)return m.find(".audio-item-active").removeClass("audio-item-active"),e(this).addClass("audio-item-active"),!1})),el.slice().reverse().forEach(function(e){m.find("#audio-list").prepend('<div class="audio-item" data-file="'+e.src+'"><div class="audio-preview"> <span class="material-icons">play_arrow</span> </div><div class="audio-info nomargin"> <div class="audio-info-title">'+pmotionParams.t137+" "+e.key+'</div><button type="button" class="audio-asset-delete btn danger" data-id="'+e.key+'"><span class="material-icons">remove</span></button></div> </div>')}),eh.length>0&&eh.forEach(function(e,t){var i=new tu(e.text,e.props);i.assignTo(e.id),eh[t]=i}),m.find("#speed-text").html(_.toFixed(1)+"x"),P=JSON.parse(i.groups),A=0,eY.clipPath=null,eY.clear(),fabric.filterBackend=v;var a,o=JSON.parse(i.canvas);a=o,n=a,H={keyframes:JSON.parse(JSON.stringify(S)),p_keyframes:JSON.parse(JSON.stringify(R)),objects:JSON.parse(JSON.stringify(F)),colormode:T,speed:_,audiosrc:ep,duration:I,currenttime:A,layercount:ee,width:e8.width,height:e8.height,animatedtext:JSON.stringify(eh),groups:JSON.stringify(P)},q=[],E=[],B=[],L=[],m.find("#undo").removeClass("history-active"),m.find("#redo").removeClass("history-active");for(var s=[],r=0;r<o.objects.length;r++)("i-text"==o.objects[r].type||"textbox"==o.objects[r].type)&&-1===s.indexOf(o.objects[r].fontFamily)&&s.push(o.objects[r].fontFamily),"animatedText"==o.objects[r].assetType&&-1===s.indexOf(o.objects[r].objects[0].fontFamily)&&s.push(o.objects[r].objects[0].fontFamily);var l=s.length,d=0;0!==l?(ev=ev.concat(s),e.each(s,function(e,t){WebFont.load({google:{families:[t+":regular,bold",t+":italic,regular,bold"]}});var a=new FontFaceObserver(t,{weight:"normal",style:"normal"}),n=new FontFaceObserver(t,{weight:"bold",style:"normal"}),s=new FontFaceObserver(t,{weight:"normal",style:"italic"}),r=new FontFaceObserver(t,{weight:"bold",style:"italic"});Promise.all([a.load(null,5e3),n.load(null,5e3),s.load(null,5e3),r.load(null,5e3)]).then(function(){++d===l&&eY.loadFromJSON(o,function(){eY.clipPath=e8,eY.getItemById("line_h")&&(eY.getItemById("line_h").set({opacity:0}),eY.getItemById("line_v").set({opacity:0})),eY.requestRenderAll(),m.find(".object-props").remove(),m.find(".layer").remove(),F.forEach(function(e){var t=!1;e.animate.length>5&&to(e.animate,X)&&(t=!0),tY(eY.getItemById(e.id),t),eY.getItemById(e.id).get("assetType")&&"audio"==eY.getItemById(e.id).get("assetType")?tT("volume",eY.getItemById(e.id)):(X.forEach(function(t){"top"!=t&&"scaleY"!=t&&"width"!=t&&"height"!=t&&"shadow.offsetX"!=t&&"shadow.offsetY"!=t&&"shadow.blur"!=t&&tT(t,eY.getItemById(e.id))}),tk(eY.getItemById(e.id),eY))}),S.forEach(function(e){"top"!=e.name&&"scaleY"!=e.name&&"width"!=e.name&&"height"!=e.name&&"shadow.offsetX"!=e.name&&"shadow.offsetY"!=e.name&&"shadow.blur"!=e.name&&tR(eY.getItemById(e.id),e.name,e.t)}),e8.set({width:i.width,height:i.height}),eY.requestRenderAll(),tv(),eW(),eh.length>0&&(eh.forEach(function(e,t){var i=eY.getItemById(e.id);e.reset(e.text,e.props,eY,i)}),q=[],E=[],B=[],L=[],m.find("#undo").removeClass("history-active"),m.find("#redo").removeClass("history-active")),t6(I),tG(5),k=!0,eY.requestRenderAll(),tS(!1,0),m.find("#load-template").removeClass("loading-active")})}).catch(function(e){console.log(e)})})):eY.loadFromJSON(o,function(){eY.clipPath=e8,eY.getItemById("line_h")&&(eY.getItemById("line_h").set({opacity:0}),eY.getItemById("line_v").set({opacity:0})),eY.requestRenderAll(),m.find(".object-props").remove(),m.find(".layer").remove(),F.forEach(function(e){var t=!1;e.animate.length>5&&to(e.animate,X)&&(t=!0),tY(eY.getItemById(e.id),t),eY.getItemById(e.id).get("assetType")&&"audio"==eY.getItemById(e.id).get("assetType")?tT("volume",eY.getItemById(e.id)):(X.forEach(function(t){"top"!=t&&"scaleY"!=t&&"width"!=t&&"height"!=t&&"shadow.offsetX"!=t&&"shadow.offsetY"!=t&&"shadow.blur"!=t&&tT(t,eY.getItemById(e.id))}),tk(eY.getItemById(e.id),eY))}),S.forEach(function(e){"top"!=e.name&&"scaleY"!=e.name&&"width"!=e.name&&"height"!=e.name&&"shadow.offsetX"!=e.name&&"shadow.offsetY"!=e.name&&"shadow.blur"!=e.name&&tR(eY.getItemById(e.id),e.name,e.t)}),e8.set({width:i.width,height:i.height}),eY.requestRenderAll(),tv(),eW(),eh.length>0&&eh.forEach(function(e,t){var i=eY.getItemById(e.id);e.reset(e.text,e.props,eY,i)}),t6(I),tG(5),k=!0,eY.requestRenderAll(),tS(!1,0),m.find("#load-template").removeClass("loading-active")})})}function ts(e){return new Promise((t,i)=>{let a=new FileReader;a.onloadend=()=>t(a.result),a.readAsDataURL(e)})}async function tr(e,t,i,a,o,n){t=await ts(t),e=await ts(e),ed=!1;var s=Math.random().toString(36).substr(2,9);x.collection("assets").add({key:s,src:t,thumb:e,name:a,type:i,hidden:n}),"image"===i?(es.push({src:t,thumb:e,key:s,type:"image",hidden:!1}),e6("images-tab")):"video"===i&&(er.push({src:t,thumb:e,key:s,type:"video",hidden:!1}),e6("videos-tab")),m.find("#upload-button").html('<span class="material-icons">file_upload</span>'+pmotionParams.t120),m.find("#upload-button").removeClass("uploading"),o&&t5(t,e8.get("left")+e8.get("width")/2,e8.get("top")+e8.get("height")/2,200),t_()}async function tl(e,t,i,a){m.find("#load-image").addClass("loading-active"),fetch(e).then(e=>e.blob()).then(o=>{e=o;var n=new FileReader;n.readAsDataURL(o),n.onloadend=function(){t5(e=n.result,t,i,a,!1)}})}async function td(e){m.find(".audio-item-active").removeClass("audio-item-active");var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){var e=eY.getObjects();e&&e.length>0&&e.forEach(function(e){e.get("assetType")&&"audio"==e.get("assetType")&&tU(e,eY)});var i=Math.random().toString(36).substr(2,9);x.collection("assets").add({key:i,src:t.result,name:i,type:"audio",hidden:!0}),tD(t.result),m.find("#audio-upload-button").html('<span class="material-icons">file_upload</span>'+pmotionParams.t102),m.find("#audio-upload-button").removeClass("uploading"),m.find("#audio-list").prepend('<div class="audio-item audio-item-active" data-file="'+t.result+'"><div class="audio-preview"> <span class="material-icons">play_arrow</span> </div><div class="audio-info nomargin"> <div class="audio-info-title">'+pmotionParams.t137+" "+i+'</div> <button type="button" class="audio-asset-delete btn danger" data-id="'+i+'"><span class="material-icons">remove</span></button></div> </div>'),(ec=new Audio(t.result)).crossOrigin="anonymous",ep=t.result}}async function tc(e,t,i,a){m.find("#load-video").addClass("loading-active"),fetch(e).then(e=>e.blob()).then(o=>{var n=new FileReader,s=new FileReader;n.readAsDataURL(o),n.onloadend=function(){fetch(t).then(e=>e.blob()).then(t=>{s.readAsDataURL(t),s.onloadend=function(){m.find("#load-video").removeClass("loading-active"),tE(e=n.result,i,a,!1)}})}})}function tf(e){x.collection("assets").doc({key:e}).get().then(t=>{x.collection("assets").doc({key:e}).delete(),"image"==t.type?(es=es.filter(function(t){return t.key!==e}),e6("images-tab")):(er=er.filter(function(t){return t.key!==e}),e6("videos-tab"))})}function tp(t,i,a,o,n,s){var r=0;i-=R.find(e=>e.id==s).start;for(var l=t._objects.length,d=0;d<l;d++){var c=d;"backward"==o.order&&(c=l-d-1);let f=t.item(c).defaultLeft,p=t.item(c).defaultTop,g=t.item(c).defaultScaleX,u=t.item(c).defaultScaleY;var h=d*v,v=o.duration/l,m={opacity:0,top:p,left:f,scaleX:g,scaleY:u};if("letter"==o.typeAnim)h=d*v-100;else if("word"==o.typeAnim){var $=0;e.each(t._objects,function(e,t){" "==t.text&&$++})," "==t.item(c).text&&(r+=o.duration/$-100),h=r}"typewriter"==o.preset?(h=d*v,v=20):"fade in"==o.preset?m.opacity=0:"slide top"==o.preset?m.top+=20:"slide bottom"==o.preset?m.top-=20:"slide left"==o.preset?m.left+=20:"slide right"==o.preset?m.left-=20:"scale"==o.preset?(m.scaleX=0,m.scaleY=0):"shrink"==o.preset&&(m.scaleX=1.5,m.scaleY=1.5),h<0&&(h=0),v<20&&(v=20);var b=!1;anime({targets:m,delay:h,opacity:1,left:f,top:p,scaleX:g,scaleY:u,duration:v,easing:o.easing,autoplay:a,update:function(){b&&a&&(t.item(c).set({opacity:m.opacity,left:m.left,top:m.top,scaleX:m.scaleX,scaleY:m.scaleY}),n.requestRenderAll())},changeBegin:function(){b=!0}}).seek(i),a||t.item(c).set({opacity:m.opacity,left:m.left,top:m.top,scaleX:m.scaleX,scaleY:m.scaleY})}n.requestRenderAll()}function tg(e,t,i,a,o,n,s){var r=0,l=1,d=1,c=0,f=e8.left+e8.width/2,p=e8.top+e8.height/2;s&&(l=s.scaleX,d=s.scaleY,c=s.angle,f=s.left-e8.left,p=s.top-e8.top);var g=[];function u(e){var i=new fabric.Text(e,{left:r,top:0,fill:t.fill,fontFamily:t.fontFamily,fontWeight:t.fontWeight,opacity:1});return i.set({defaultLeft:i.left,defaultTop:i.top,defaultScaleX:1,defaultScaleY:1}),r+=i.get("width"),i}for(var h=0;h<e.length;h++)g.push(u(e.charAt(h)));var v=new fabric.Group(g,{cursorWidth:1,stroke:"#000",strokeUniform:!0,paintFirst:"stroke",strokeWidth:0,originX:"center",originY:"center",left:f,top:p,cursorDuration:1,cursorDelay:250,assetType:"animatedText",id:a,strokeDashArray:!1,inGroup:!1,scaleX:l,scaleY:d,angle:c});return o&&v.set({notnew:!0,starttime:n}),v.objectCaching=!1,i.add(v),i.requestRenderAll(),t3(v),v._objects.forEach(function(e,t){v.item(t).set({defaultLeft:v.item(t).defaultLeft-v.width/2,defaultTop:v.item(t).defaultTop-v.height/2})}),i.setActiveObject(v),i.bringToFront(v),v.id}m.find("#template-library").on("click",".image-grid-item",function(){var t=$.baseURL+e(this).attr("data-template");fetch(t).then(e=>e.json()).then(e=>{if(void 0===e.project){toastr.error(pmotionParams.t122,pmotionParams.t105);return}e.project.canvas.length>0?(delete e.project.id,x.collection("projects").doc({id:1}).update(e.project).then(e=>{tn(1)})):toastr.error(pmotionParams.t103,pmotionParams.t105)}).catch(e=>{toastr.error(e,pmotionParams.t105),m.find("#load-template").removeClass("loading-active")})}),m.on("change","#import",function(e){m.find("#import-project").prop("disabled",!0);var t=new FileReader;t.onload=function(e){var i=JSON.parse(t.result);if(void 0===i.project){toastr.error(pmotionParams.t122,pmotionParams.t105);return}i.project.canvas.length>0?(delete i.project.id,x.collection("projects").doc({id:1}).update(i.project).then(e=>{m.find("#import-project").prop("disabled",!1),eK(),tn(1)})):toastr.error(pmotionParams.t103,pmotionParams.t105)},t.readAsText(e.target.files[0])}),m.on("click","#import-project",function(){m.find("#import").click()}),m.on("click","#export-project",function(){e(this).prop("disabled",!0),x.collection("projects").get().then(t=>{t.length>0?e.each(t,function(e,t){if(1===t.id){var i=JSON.stringify({project:t}),a=document.createElement("a"),o=new Blob([i],{type:"text/plain"});a.href=URL.createObjectURL(o),a.download="template.json",a.click(),m.find("#export-project").prop("disabled",!1);return}}):toastr.error(pmotionParams.t104,pmotionParams.t105)})}),x.collection("projects").get().then(t=>{var i="";t.reverse(),e.each(t,function(e,t){1!==t.id&&(i+='<div class="project-item" data-id="'+t.id+'"><div class="project-title"><input type="text" class="project-title-input" value="'+t.title+'" /></div><div class="project-btns"><button type="button" class="btn danger project-delete"><span class="material-icons">clear</span></button><button type="button" class="btn primary project-select"><span class="material-icons">done</span></button></div></div>')}),""==i?m.find("#projects-output").after('<div id="no-projects" class="notice notice-warning">'+pmotionParams.t106+"</div>"):m.find("#no-projects").remove(),m.find("#projects-output").html(i)}),m.on("click","#save-project",function(){m.find("#save-project").prop("disabled",!0);let e=new Date().getTime(),t=eY.toDatalessJSON(ey);eY.clipPath=null,eY.clipPath=e8,x.collection("projects").add({id:e,title:e,canvas:JSON.stringify(t),keyframes:JSON.stringify(S.slice()),p_keyframes:JSON.stringify(R.slice()),objects:JSON.stringify(F.slice()),colormode:T,speed:_,duration:I,currenttime:A,layercount:ee,width:e8.width,height:e8.height,audiosrc:ep,animatedtext:JSON.stringify(eh),groups:JSON.stringify(P)}),m.find("#no-projects").remove(),m.find("#projects-output").prepend('<div class="project-item" data-id="'+e+'"><div class="project-title"><input type="text" class="project-title-input" value="'+e+'" /></div><div class="project-btns"><button type="button" class="btn danger project-delete"><span class="material-icons">clear</span></button><button type="button" class="btn primary project-select"><span class="material-icons">done</span></button></div></div>'),m.find("#save-project").prop("disabled",!1),t_()}),m.on("click",".project-select",function(){let t=parseInt(e(this).parent().parent().attr("data-id"));tn(t)}),m.on("click",".project-delete",function(){e(this).prop("disabled",!0);let t=parseInt(e(this).parent().parent().attr("data-id"));e(this).parent().parent().remove(),x.collection("projects").doc({id:t}).delete(),m.find("#projects-output").is(":empty")?m.find("#projects-output").after('<div id="no-projects" class="notice notice-warning">'+pmotionParams.t106+"</div>"):m.find("#no-projects").remove()}),m.on("focusout",".project-title-input",function(){let t=e(this).val(),i=parseInt(e(this).parent().parent().attr("data-id"));x.collection("projects").doc({id:i}).update({title:t})}),m.on("click","#delete-assets-button",function e(){window.confirm(pmotionParams.t110)&&(x.collection("assets").delete(),window.setTimeout(function(){location.reload()},1e3))}),m.on("click","#clear-project",function e(){window.confirm(pmotionParams.t111)&&(x.collection("projects").doc({id:1}).delete(),window.setTimeout(function(){location.reload()},1e3))});class tu{constructor(e,t){this.text=e,this.props=t,this.id="Text"+ee}render(e){this.id=tg(this.text,this.props,e,this.id,!1,0,!1),tp(e.getItemById(this.id),A,!1,this.props,e,this.id)}seek(e,t){tp(t.getItemById(this.id),e,!1,this.props,t,this.id)}play(e){tp(e.getItemById(this.id),0,!0,this.props,e,this.id)}getObject(e){return e.getItemById(this.id)}setProps(t,i){this.props=e.extend(this.props,t),function e(t,i,a){for(var o=t._objects.length,n=0;n<o;n++)t.item(n).set({fill:i.fill,fontFamily:i.fontFamily,fontWeight:i.fontWeight}),a.requestRenderAll()}(i.getItemById(this.id),this.props,i)}setProp(t){e.extend(this.props,t)}reset(e,t,i,a){var o=R.find(e=>e.id==this.id).start;tU(a,i,!1),this.text=e,this.props=t,this.inst=tg(e,this.props,i,this.id,!0,o,a),tp(a,A,!1,this.props,i,this.id),tS(!1,A)}assignTo(e,t,i){this.id=e}}async function th(e){await tI(1e3*e)}function tv(){eY.setHeight(m.find("#canvas-area").height()),eY.setWidth(m.find("#canvas-area").width()),e8.set({left:eY.get("width")/2-e8.get("width")/2,top:eY.get("height")/2-e8.get("height")/2}),eY.requestRenderAll(),function e(){var t=parseInt(e8.get("width")),i=parseInt(e8.get("height")),a=m.find("#canvas-area").width(),o=m.find("#canvas-area").height(),n=100*eY.getZoom(),s=100,r=1,l=0;if(t<a&&i<o){eY.setZoom(1),eY.requestRenderAll();let d=eY.width/r.toFixed(2),c=eY.height/r.toFixed(2),f=e8.left+e8.width/2-d/2,p=e8.top+e8.height/2-c/2;eY.absolutePan({x:f,y:p}),eY.setZoom(1),eY.requestRenderAll(),m.find("#zoom-level .zoom-span").html("100%")}else{if(t>a&&n>(s=100*(r=a/t).toFixed(2))){eY.setZoom(1),eY.requestRenderAll();let g=eY.width/r.toFixed(2),u=eY.height/r.toFixed(2),h=e8.left+e8.width/2-g/2,v=e8.top+e8.height/2-u/2;eY.absolutePan({x:h,y:v}),eY.setZoom(r.toFixed(2)),l=r.toFixed(2),eY.requestRenderAll(),m.find("#zoom-level .zoom-span").html(s.toFixed(0)+"%")}if(i>o&&n>(s=100*(r=o/i).toFixed(2))&&(0===l||l>r.toFixed(2))){eY.setZoom(1),eY.requestRenderAll();let $=eY.width/r.toFixed(2),b=eY.height/r.toFixed(2),y=e8.left+e8.width/2-$/2,w=e8.top+e8.height/2-b/2;eY.absolutePan({x:y,y:w}),eY.setZoom(r.toFixed(2)),eY.requestRenderAll(),m.find("#zoom-level .zoom-span").html(s.toFixed(0)+"%")}}}(),tS(!1,A),eY.getItemById("center_h")&&(eY.remove(eY.getItemById("center_h")),eY.remove(eY.getItemById("center_v"))),eY.getItemById("line_h")&&(eY.remove(eY.getItemById("line_h")),eY.remove(eY.getItemById("line_v"))),eY.add(new fabric.Line([eY.get("width")/2,0,eY.get("width")/2,eY.get("height")],{opacity:0,selectable:!1,evented:!1,id:"center_h"})),eY.add(new fabric.Line([0,eY.get("height")/2,eY.get("width"),eY.get("height")/2],{opacity:0,selectable:!1,evented:!1,id:"center_v"})),d=new fabric.Line([eY.get("width")/2,e8.get("top"),eY.get("width")/2,e8.get("height")+e8.get("top"),],{stroke:"#4affff",opacity:0,selectable:!1,evented:!1,id:"line_h"}),c=new fabric.Line([e8.get("left"),eY.get("height")/2,e8.get("width")+e8.get("left"),eY.get("height")/2,],{stroke:"#4affff",opacity:0,selectable:!1,evented:!1,id:"line_v"}),eY.add(d),eY.add(c)}function tm(e){var t=e.selected;m.find(".layer-selected").removeClass("layer-selected");for(var i=0;i<t.length;i++)m.find(".layer").length>0&&m.find(".layer[data-object='"+t[i].get("id")+"']").length>0&&(m.find(".layer[data-object='"+t[i].get("id")+"']").addClass("layer-selected"),void 0!=e.e&&document.getElementsByClassName("layer-selected")[0].scrollIntoView())}function t$(e,t,i){"drag"==t.action?(tX("left",e,A,e.get("left"),!0),tX("top",e,A,e.get("top"),!0)):"scale"==t.action?(tX("scaleX",e,A,e.get("scaleX"),!0),tX("scaleY",e,A,e.get("scaleY"),!0),tX("left",e,A,e.get("left"),!0),tX("top",e,A,e.get("top"),!0),tX("width",e,A,e.get("width"),!0),tX("height",e,A,e.get("height"),!0)):"rotate"==t.action?(tX("angle",e,A,e.get("angle"),!0),i&&(tX("scaleX",e,A,e.get("scaleX"),!0),tX("scaleY",e,A,e.get("scaleY"),!0),tX("width",e,A,e.get("width"),!0),tX("left",e,A,e.get("left"),!0),tX("top",e,A,e.get("top"),!0))):("resizing"==t.action||"scaleX"==t.action||"scaleY"==t.action)&&(tX("scaleX",e,A,e.get("scaleX"),!0),tX("scaleY",e,A,e.get("scaleY"),!0),tX("left",e,A,e.get("left"),!0),tX("width",e,A,e.get("width"),!0),tX("top",e,A,e.get("top"),!0),tX("height",e,A,e.get("height"),!0))}function tb(e){if(l=!1,"activeSelection"==e.type){var t=[];for(let i of e._objects)for(let a of eY.getObjects())if(a.get("id")===i.get("id")){t.push(a);break}eY.setActiveObject(new fabric.ActiveSelection(t,{canvas:eY})),eY.requestRenderAll()}else"group"==e.get("type")?eY.setActiveObject(eY.getItemById(e.get("id"))):eY.setActiveObject(e),eY.requestRenderAll()}function ty(e){var t=[];P.find(t=>t.id==e).objects.forEach(function(e){t.push(eY.getItemById(e))});var i=new fabric.ActiveSelection(t).toGroup();i.set({id:e,objectCaching:!1}),eY.add(i),eY.requestRenderAll()}function tw(e){e&&tS(!1,I),eY.discardActiveObject(),eY.requestRenderAll(),eY.clipPath=null;var t=eY.toJSON(ey);return eY.clipPath=e8,new Promise((i,a)=>{s.loadFromJSON(t,function(){s.getItemById("center_h")&&(s.remove(s.getItemById("center_h")),s.remove(s.getItemById("center_v"))),s.getItemById("line_h")&&(s.remove(s.getItemById("line_h")),s.remove(s.getItemById("line_v"))),s.requestRenderAll(),s.setWidth(e8.width),s.setHeight(e8.height),s.width=e8.width,s.height=e8.height,s.requestRenderAll(),F.forEach(function(t){if(e&&eh.length>=1){var i=eh.find(e=>e.id==t.id);void 0!==i&&i.reset(i.text,i.props,s,s.getItemById(t.id))}tk(s.getItemById(t.id),s),tk(eY.getItemById(t.id),eY)}),s.discardActiveObject(),function e(t){if($.watermark){var i=$.watermarkLocation,a=e8.width*$.watermarkFontSize/1400,o=new fabric.Textbox(" "+$.watermarkText+" ",{objectType:"watermark",fontSize:a,fontFamily:$.watermarkFontFamily,fontWeight:$.watermarkFontWeight,fontStyle:$.watermarkFontStyle,lineHeight:1,fill:$.watermarkFontColor,textBackgroundColor:$.watermarkBackgroundColor,width:e8.width,left:0});t.add(o),"bottom-right"==i?(o.textAlign="right",o.top=e8.height-o.height):"bottom-left"==i?(o.textAlign="left",o.top=e8.height-o.height):"top-right"==i?(o.textAlign="right",o.top=0):"top-left"==i&&(o.textAlign="left",o.top=0),o.moveTo(999)}}(s),s.requestRenderAll(),window.setTimeout(function(){i(s)},1e3)})})}function t_(){B=[],L=[],n&&(q.push(n),E.push(H)),eY.clipPath=null,n=eY.toJSON(ey),eY.clipPath=e8,H={keyframes:JSON.parse(JSON.stringify(S)),p_keyframes:JSON.parse(JSON.stringify(R)),objects:JSON.parse(JSON.stringify(F)),colormode:T,speed:_,audiosrc:ep,duration:I,currenttime:A,layercount:ee,width:e8.width,height:e8.height,animatedtext:JSON.stringify(eh),groups:JSON.stringify(P)},q.length>=1?m.find("#undo").addClass("history-active"):m.find("#undo").removeClass("history-active"),B.length>=1?m.find("#redo").addClass("history-active"):m.find("#redo").removeClass("history-active"),function e(){if(k){eY.clipPath=null,F.forEach(async function(e){var t=eY.getItemById(e.id);if(t.filters){if(t.filters.length>0){e.filters=[],t.filters.forEach(function(t){"BlackWhite"==t.type||"Invert"==t.type||"Sepia"==t.type||"Kodachrome"==t.type||"Polaroid"==t.type||"Technicolor"==t.type||"Brownie"==t.type||"Grayscale"==t.type||"Vintage"==t.type?e.filters.push({type:t.type}):"Brightness"==t.type?e.filters.push({type:t.type,value:t.brightness}):"Contrast"==t.type?e.filters.push({type:t.type,value:t.contrast}):"Vibrance"==t.type?e.filters.push({type:t.type,value:t.vibrance}):"Saturation"==t.type?e.filters.push({type:t.type,value:t.saturation}):"HueRotation"==t.type?e.filters.push({type:t.type,value:t.rotation}):"Blur"==t.type?e.filters.push({type:t.type,value:t.blur}):"Noise"==t.type?e.filters.push({type:t.type,value:t.noise}):"RemoveColor"==t.type&&e.filters.push({type:t.type,distance:t.distance,color:t.color})});var i=fabric.filterBackend;i&&i.evictCachesForKey&&(i.evictCachesForKey(t.cacheKey),i.evictCachesForKey(t.cacheKey+"_filtered")),t.filters.length>0&&t.get("id").indexOf("Video")>=0&&await t.setElement(t.saveElem)}else e.filters=[]}else e.filters=[]});let t=eY.toDatalessJSON(ey);eY.clipPath=e8,x.collection("projects").doc({id:1}).update({canvas:JSON.stringify(t),keyframes:JSON.stringify(S.slice()),p_keyframes:JSON.stringify(R.slice()),objects:JSON.stringify(F.slice()),colormode:T,duration:I,currenttime:A,layercount:ee,speed:_,audiosrc:ep,animatedtext:JSON.stringify(eh),groups:JSON.stringify(P),width:e8.width,height:e8.height}),F.forEach(function(e){tk(eY.getItemById(e.id),eY)})}}()}function tk(e,t){if(null==e)return!1;if("group"!=e.get("type")&&e.type&&"image"==e.type){if(e.get("id").indexOf("Video")>=0){var i=document.createElement("video"),a=document.createElement("source");a.src=e.get("source"),i.crossOrigin="anonymous",i.appendChild(a),i.addEventListener("loadeddata",function(){async function a(){i.readyState>=3?(e.setElement(i),e.saveElem=i,await t.requestRenderAll()):window.setTimeout(function(){a()},100)}i.width=this.videoWidth,i.height=this.videoHeight,i.currentTime=0,i.muted=!1,window.setTimeout(function(){a()},100)}),i.currentTime=0}else F.find(t=>t.id==e.get("id")).filters&&(F.find(t=>t.id==e.get("id")).filters.length>0?(e.filters=[],F.find(t=>t.id==e.get("id")).filters.forEach(function(t){"Sepia"==t.type?e.filters.push(new em.Sepia):"Invert"==t.type?e.filters.push(new em.Invert):"BlackWhite"==t.type?e.filters.push(new em.BlackWhite):"Kodachrome"==t.type?e.filters.push(new em.Kodachrome):"Polaroid"==t.type?e.filters.push(new em.Polaroid):"Technicolor"==t.type?e.filters.push(new em.Technicolor):"Vintage"==t.type?e.filters.push(new em.Vintage):"Brownie"==t.type?e.filters.push(new em.Brownie):"Grayscale"==t.type?e.filters.push(new em.Grayscale):"Brightness"==t.type?e.filters.push(new em.Brightness({brightness:t.value})):"Contrast"==t.type?e.filters.push(new em.Contrast({contrast:t.value})):"Saturation"==t.type?e.filters.push(new em.Saturation({saturation:t.value})):"Vibrance"==t.type?e.filters.push(new em.Vibrance({vibrance:t.value})):"HueRotation"==t.type?e.filters.push(new em.HueRotation({rotation:t.value})):"Noise"==t.type?e.filters.push(new em.Noise({noise:t.value})):"Blur"==t.type?e.filters.push(new em.Blur({blur:t.value})):"RemoveColor"==t.type&&e.filters.push(new em.RemoveColor({distance:t.distance,color:t.color}))}),e.applyFilters()):(e.filters=[],e.applyFilters()))}}function tx(e,t,i,a){t.push(n),a.push(H),H=i.pop(),n=e.pop(),S=H.keyframes,R=H.p_keyframes,F=H.objects,T=H.colormode,I=H.duration,A=H.currenttime,eh=JSON.parse(H.animatedtext),eY.clipPath=null,eY.loadFromJSON(n,function(){eY.clipPath=e8,eY.getItemById("line_h").set({opacity:0}),eY.getItemById("line_v").set({opacity:0}),eY.requestRenderAll(),m.find(".object-props").remove(),m.find(".layer").remove(),F.forEach(function(e){if(tk(eY.getItemById(e.id),eY),tY(eY.getItemById(e.id)),X.forEach(function(t){"top"!=t&&"scaleY"!=t&&"width"!=t&&"height"!=t&&"shadow.offsetX"!=t&&"shadow.offsetY"!=t&&"shadow.blur"!=t&&tT(t,eY.getItemById(e.id))}),eh.length>=1){eh.forEach(function(e,t){var i=new tu(e.text,e.props);i.assignTo(e.id),eh[t]=i});var t=eh.find(t=>t.id==e.id);void 0!==t&&t.reset(t.text,t.props,eY,eY.getItemById(e.id))}}),S.forEach(function(e){"top"!=e.name&&"scaleY"!=e.name&&"width"!=e.name&&"height"!=e.name&&"shadow.offsetX"!=e.name&&"shadow.offsetY"!=e.name&&"shadow.blur"!=e.name&&tR(eY.getItemById(e.id),e.name,e.t)}),tS(!1,A)}),q.length>=1?m.find("#undo").addClass("history-active"):m.find("#undo").removeClass("history-active"),B.length>=1?m.find("#redo").addClass("history-active"):m.find("#redo").removeClass("history-active")}function tj(){C=!1,eY.discardActiveObject(),tS(!0,A),m.find("#play-button").html("pause")}function tC(){C=!0,m.find("#play-button").html("play_arrow")}function t0(e,t){var i=S.slice();if(i.sort(function(e,t){return e.t-t.t}),i.length=i.findIndex(t=>t===e),i.reverse(),0==i.length)return!1;for(var a=0;a<i.length;a++){if(i[a].id==e.id&&i[a].name==e.name)return i[a];if(a==i.length-1)return!1}}function tA(t,i,a){let o=a.getItemById(t);if("audio"==o.get("assetType")||"i-text"!=o.get("type")&&"textbox"!=o.get("type")&&"charSpacing"==i||"group"==o.get("type")&&("shadow.color"==i||"shadow.offsetX"==i||"shadow.offsetY"==i||"shadow.blur"==i))return!1;let n=e.grep(S,function(e){return e.id==t&&e.name==i});if(0==n.length){let s=F.find(e=>e.id==t).defaults.find(e=>e.name==i).value;!function e(t,i,a,o){if("group"!=i.get("type")&&i.group){var n=i.group;z=n._objects,n._restoreObjectsState(),eY.setActiveObject(n),o.remove(eY.getActiveObject()),eY.discardActiveObject(),o.requestRenderAll();for(var s=0;s<z.length;s++)o.add(z[s])}"left"!=t||W?"top"!=t||W?"shadow.blur"==t?i.shadow.blur=a:"shadow.color"==t?i.shadow.color=a:"shadow.offsetX"==t?i.shadow.offsetX=a:"shadow.offsetY"==t?i.shadow.offsetY=a:"shadow.blur"==t?i.shadow.blur=a:"group"!=i.get("type")?i.set(t,a):"width"!=t&&i.set(t,a):i.set(t,a+e8.get("top")):i.set(t,a+e8.get("left")),o.requestRenderAll()}(i,o,s,a)}}async function tO(t){F.forEach(async function(i){if(null==(i=eY.getItemById(i.id)))return!1;var a=eY,o=!1;if(W&&(i=s.getItemById(i.id),a=s),i.get("id").indexOf("Video")>=0&&R.find(e=>e.id==i.id).trimstart+R.find(e=>e.id==i.id).start<=t&&R.find(e=>e.id==i.id).end>=t){if(i.set("visible",!0),a.requestRenderAll(),!0==e(i.getElement())[0].paused&&(e(i.getElement())[0].currentTime=parseFloat(((t-R.find(e=>e.id==i.id).start+R.find(e=>e.id==i.id).trimstart)/1e3).toFixed(2))),W)!0==e(i.getElement())[0].paused&&(e(i.getElement())[0].play(),a.requestRenderAll());else{var n={value:0};anime({targets:n,value:[A,I],delay:0,duration:I,easing:"linear",autoplay:!0,update:async function(){if(!C&&o)"VIDEO"==e(i.getElement())[0].tagName&&e(i.getElement())[0].play(),await a.requestRenderAll();else if(C){var t;((t=e(i.getElement())[0])instanceof HTMLElement||t[0]instanceof HTMLElement)&&"VIDEO"==e(i.getElement())[0].tagName&&e(i.getElement())[0].pause(),n.value=I+1,anime.remove(n)}},changeBegin:function(){o=!0}}),C&&(e(i.getElement())[0].currentTime=parseFloat(((t-R.find(e=>e.id==i.id).start+R.find(e=>e.id==i.id).trimstart)/1e3).toFixed(2)),await a.requestRenderAll())}}else i.get("id").indexOf("Video")>=0&&(e(i.getElement())[0].pause(),i.set("visible",!1),a.requestRenderAll())})}async function tI(e){anime.speed=1,A=e;var t=s;eh.length>0&&eh.forEach(function(i){i.seek(e,t)}),S.forEach(function(i,a){if(P.find(e=>e.id==i.id)){t.getItemById(i.id)||ty(i.id);let o=t.getItemById(i.id),n=o.get("visible");A<R.find(e=>e.id==i.id).trimstart+R.find(e=>e.id==i.id).start?!1!==n&&(o.set("visible",!1),t.requestRenderAll()):A>R.find(e=>e.id==i.id).end||A>I?!1!==n&&(o.set("visible",!1),t.requestRenderAll()):!0!==n&&(o.set("visible",!0),t.requestRenderAll()),A>=R.find(e=>e.id==i.id).trimstart+R.find(e=>e.id==i.id).start&&X.forEach(function(e){tA(i.id,e,t)})}function s(e,t,i,a){if("group"!=t.get("type")&&t.group){var o=t.group;z=o._objects,o._restoreObjectsState(),a.setActiveObject(o),a.remove(a.getActiveObject()),a.discardActiveObject(),a.requestRenderAll();for(var n=0;n<z.length;n++)a.add(z[n])}"left"!=e||W?"top"!=e||W?"shadow.blur"==e?t.shadow.blur=i:"shadow.color"==e?t.shadow.color=i:"shadow.offsetX"==e?t.shadow.offsetX=i:"shadow.offsetY"==e?t.shadow.offsetY=i:"shadow.blur"==e?t.shadow.blur=i:"group"!=t.get("type")?t.set(e,i):"width"!=e&&t.set(e,i):t.set(e,i+e8.get("top")):t.set(e,i+e8.get("left")),a.requestRenderAll()}var r=t.getItemById(i.id),l=r.get("visible");if(i.t>=e&&A>=R.find(e=>e.id==i.id).trimstart+R.find(e=>e.id==i.id).start){var d,c,f=!1,p=t0(i,a);if(p?(d=p.t,c=p.value):(d=0,c=F.find(e=>e.id==i.id).defaults.find(e=>e.name==i.name).value),p&&p.t>=e&&!tj)return;var g={value:c},u=anime({targets:g,delay:0,value:i.value,duration:i.t-d,easing:i.easing,autoplay:!1,update:function(){f&&!C?A<R.find(e=>e.id==i.id).trimstart+R.find(e=>e.id==i.id).start||A>R.find(e=>e.id==i.id).end||A>I?!1!==l&&(r.set("visible",!1),t.requestRenderAll()):(s(i.name,r,g.value,t),!0!==l&&(r.set("visible",!0),t.requestRenderAll())):f&&C&&anime.remove(g)},changeBegin:function(){f=!0}});e-d<=0?u.seek(0):u.seek(e-d),parseFloat(d)<=parseFloat(e)&&parseFloat(i.t)>=parseFloat(e)&&s(i.name,r,g.value,t)}else if(i.t<e&&!function e(t,i){var a=S.slice();if(a.sort(function(e,t){return e.t-t.t}),a.splice(0,a.findIndex(e=>e===t)+1),0==a.length)return!1;for(var o=0;o<a.length;o++){if(a[o].id==t.id&&a[o].name==t.name)return a[o];if(o==a.length-1)return!1}}(i,a)){var h=i.name;"shadow.blur"==h?r.shadow.blur!=i.value&&s(i.name,r,i.value,t):"shadow.color"==h?r.shadow.color!=i.value&&s(i.name,r,i.value,t):"shadow.offsetX"==h?r.shadow.offsetX!=i.value&&s(i.name,r,i.value,t):"shadow.offsetY"==h?r.shadow.offsetY!=i.value&&s(i.name,r,i.value,t):r.get(h)!=i.value&&s(i.name,r,i.value,t)}}),F.forEach(function(e){if(-1==e.id.indexOf("Group")){let i=t.getItemById(e.id),a=i.get("visible");A<R.find(t=>t.id==e.id).trimstart+R.find(e=>e.id==i.id).start?!1!==a&&(i.set("visible",!1),t.requestRenderAll()):A>R.find(t=>t.id==e.id).end||A>I?!1!==a&&(i.set("visible",!1),t.requestRenderAll()):!0!==a&&(i.set("visible",!0),t.requestRenderAll()),A>=R.find(t=>t.id==e.id).trimstart+R.find(t=>t.id==e.id).start&&X.forEach(function(i){tA(e.id,i,t)})}}),tO(e)}async function tS(e,t){if(anime.speed=_,!J){var i,a=eY;if(S.forEach(function(i,o){if(P.find(e=>e.id==i.id)){a.getItemById(i.id)||ty(i.id);let n=a.getItemById(i.id),s=n.get("visible");A<R.find(e=>e.id==i.id).trimstart+R.find(e=>e.id==i.id).start?!1!==s&&(n.set("visible",!1),a.requestRenderAll()):A>R.find(e=>e.id==i.id).end||A>I?!1!==s&&(n.set("visible",!1),a.requestRenderAll()):!0!==s&&(n.set("visible",!0),a.requestRenderAll()),A>=R.find(e=>e.id==i.id).trimstart+R.find(e=>e.id==i.id).start&&X.forEach(function(e){tA(i.id,e,a)})}function r(t,i,a,o){if("audio"==i.get("assetType")&&e)return i.get("src")&&(i.get("src").volume=a,i.set("volume",a)),!1;if("group"!=i.get("type")&&i.group){var n=i.group;z=n._objects,n._restoreObjectsState(),o.setActiveObject(n),o.remove(o.getActiveObject()),o.discardActiveObject(),o.requestRenderAll();for(var s=0;s<z.length;s++)o.add(z[s])}"left"!=t||W?"top"!=t||W?"shadow.blur"==t?i.shadow.blur=a:"shadow.color"==t?i.shadow.color=a:"shadow.offsetX"==t?i.shadow.offsetX=a:"shadow.offsetY"==t?i.shadow.offsetY=a:"shadow.blur"==t?i.shadow.blur=a:"group"!=i.get("type")?i.set(t,a):"width"!=t&&i.set(t,a):i.set(t,a+e8.get("top")):i.set(t,a+e8.get("left")),o.requestRenderAll()}var l=a.getItemById(i.id),d=l.get("visible");if(i.t>=t&&A>=R.find(e=>e.id==i.id).trimstart+R.find(e=>e.id==i.id).start){var c,f,p=0,g=!1,u=t0(i,o);if(u?(c=u.t,f=u.value):(c=0,f=F.find(e=>e.id==i.id).defaults.find(e=>e.name==i.name).value),u&&u.t>=t&&!e)return;e&&c>A&&(p=c-t);var h={value:f},v=anime({targets:h,delay:p,value:i.value,duration:i.t-c,easing:i.easing,autoplay:!1,update:function(){g&&!C?A<R.find(e=>e.id==i.id).trimstart+R.find(e=>e.id==i.id).start||A>R.find(e=>e.id==i.id).end||A>I?!1!==d&&(l.set("visible",!1),a.requestRenderAll()):(r(i.name,l,h.value,a),!0!==d&&(l.set("visible",!0),a.requestRenderAll())):g&&C&&anime.remove(h)},changeBegin:function(){g=!0}});t-c<=0?v.seek(0):v.seek(t-c),e?v.play():parseFloat(c)<=parseFloat(t)&&parseFloat(i.t)>=parseFloat(t)&&r(i.name,l,h.value,a)}else if(i.t<t&&!function e(t,i){var a=S.slice();if(a.sort(function(e,t){return e.t-t.t}),a.splice(0,a.findIndex(e=>e===t)+1),0==a.length)return!1;for(var o=0;o<a.length;o++){if(a[o].id==t.id&&a[o].name==t.name)return a[o];if(o==a.length-1)return!1}}(i,o)){var m=i.name;"left"!=m||W?"top"!=m||W?"shadow.blur"==m?l.shadow.blur!=i.value&&r(i.name,l,i.value,a):"shadow.color"==m?l.shadow.color!=i.value&&r(i.name,l,i.value,a):"shadow.offsetX"==m?l.shadow.offsetX!=i.value&&r(i.name,l,i.value,a):"shadow.offsetY"==m?l.shadow.offsetY!=i.value&&r(i.name,l,i.value,a):l.get(m)!=i.value&&r(i.name,l,i.value,a):l.get("top")-e8.get("top")!=i.value&&r(i.name,l,i.value,a):l.get("left")-e8.get("left")!=i.value&&r(i.name,l,i.value,a)}}),F.forEach(function(e){if(-1==e.id.indexOf("Group")){let t=a.getItemById(e.id),i=t.get("visible");A<R.find(t=>t.id==e.id).trimstart+R.find(t=>t.id==e.id).start?!1!==i&&(t.set("visible",!1),a.requestRenderAll()):A>R.find(t=>t.id==e.id).end||A>I?!1!==i&&(t.set("visible",!1),a.requestRenderAll()):!0!==i&&(t.set("visible",!0),a.requestRenderAll()),A>=R.find(t=>t.id==e.id).trimstart+R.find(t=>t.id==e.id).start&&X.forEach(function(t){tA(e.id,t,a)})}}),eh.length>0&&eh.forEach(function(e){e.seek(A,eY)}),tO(t),e&&F.forEach(async function(e){var t=!1,i=eY.getItemById(e.id);if("audio"==i.get("assetType")){var a=!1,o={value:0};anime({targets:o,value:[A,I],delay:0,duration:I,easing:"linear",autoplay:!0,update:async function(){if(t&&tj&&!C){if(!a&&R.find(t=>t.id==e.id).start<=A&&R.find(t=>t.id==e.id).end>=A){if(i.get("src"))i.get("src").currentTime=(R.find(t=>t.id==e.id).trimstart-R.find(t=>t.id==e.id).start+A)/1e3,i.get("src").volume=i.get("volume"),i.get("src").play(),a=!0;else{var n=new Audio(i.get("audioSrc"));i.set("src",n),n.volume=i.get("volume"),n.crossOrigin="anonymous",n.currentTime=(R.find(t=>t.id==e.id).trimstart-R.find(t=>t.id==e.id).start+A)/1e3,n.play(),a=!0}}else(R.find(t=>t.id==e.id).start>=A||R.find(t=>t.id==e.id).end<=A)&&i.get("src")&&i.get("src").pause()}else C&&i.get("src")&&(i.get("src").pause(),anime.remove(o))},changeBegin:function(){t=!0}})}}),e&&!C){var o={value:0};anime({targets:o,value:[A,I],duration:I-A,easing:"linear",autoplay:!0,update:function(){C?(tC(),o.value=I+1,anime.remove(o)):(A=o.value,eh.length>0&&eh.forEach(function(e){e.seek(A,a)}),F.forEach(function(e){if(-1==e.id.indexOf("Group")){let t=a.getItemById(e.id),i=t.get("visible");A<R.find(t=>t.id==e.id).trimstart+R.find(t=>t.id==e.id).start?!1!==i&&(t.set("visible",!1),a.requestRenderAll()):A>R.find(t=>t.id==e.id).end||A>I?!1!==i&&(t.set("visible",!1),a.requestRenderAll()):!0!==i&&(t.set("visible",!0),a.requestRenderAll()),A>=R.find(t=>t.id==e.id).trimstart+R.find(t=>t.id==e.id).start&&X.forEach(function(t){tA(e.id,t,a)})}}),W||(tZ(),m.find("#seekbar").css({left:A/O+20})))},complete:function(){tC()}})}else C&&(A=t)}}function tR(e,t,i){let a=F.find(t=>t.id==e.id).color;"shadow.color"==t?(m.find("#"+e.get("id")).find(".shadowcolor").is(":visible")&&(i-=parseFloat(R.find(t=>t.id==e.get("id")).start)),m.find("#"+e.get("id")).find(".shadowcolor").prepend("<div class='keyframe' data-time='"+i+"' data-object='"+e.get("id")+"' data-property='"+t+"'></div>"),m.find("#"+e.get("id")).find(".shadowcolor").find("[data-time='"+i+"']").css({left:i/O,background:a})):(m.find("#"+e.get("id")).find("."+t).is(":visible")&&(i-=parseFloat(R.find(t=>t.id==e.get("id")).start)),m.find("#"+e.get("id")).find("."+t).prepend("<div class='keyframe' data-time='"+i+"' data-object='"+e.get("id")+"' data-property='"+t+"'></div>"),m.find("#"+e.get("id")).find("."+t).find("[data-time='"+i+"']").css({left:i/O,background:a}))}function tX(t,i,a,o,n){if(-1!=e.inArray(t,F.find(e=>e.id==i.get("id")).animate)){let s=e.grep(S,function(e){return e.t==parseFloat(a)&&e.id==i.get("id")&&e.name==t}),r=e.grep(S,function(e){return e.id==i.get("id")&&e.name==t});0==r.length&&("left"==t?F.find(e=>e.id==i.get("id")).defaults.find(e=>e.name==t).value=i.get(t)-e8.get("left"):"top"==t?F.find(e=>e.id==i.get("id")).defaults.find(e=>e.name==t).value=i.get(t)-e8.get("top"):F.find(e=>e.id==i.get("id")).defaults.find(e=>e.name==t).value=o),0==s.length?("left"==t?S.push({t:a,name:t,value:o-e8.get("left"),id:i.get("id"),easing:"linear"}):"top"==t?S.push({t:a,name:t,value:o-e8.get("top"),id:i.get("id"),easing:"linear"}):S.push({t:a,name:t,value:o,id:i.get("id"),easing:"linear"}),n&&"top"!=t&&"scaleY"!=t&&"width"!=t&&"height"!=t&&"stroke"!=t&&"shadow.offsetX"!=t&&"shadow.offsetY"!=t&&"shadow.blur"!=t&&tR(i,t,a),S.sort(function(e,t){return e.id.indexOf("Group")>=0&&-1==t.id.indexOf("Group")?1:t.id.indexOf("Group")>=0&&-1==e.id.indexOf("Group")?-1:0})):n&&"top"!=t&&"scaleY"!=t&&"width"!=t&&"height"!=t&&"stroke"!=t&&"shadow.offsetX"!=t&&"shadow.offsetY"!=t&&"shadow.blur"!=t&&tK(m.find("#"+i.get("id")).find(".keyframe[data-time='"+a+"'][data-property='"+t+"']"),!0)}else"left"==t?F.find(e=>e.id==i.get("id")).defaults.find(e=>e.name==t).value=i.get(t)-e8.get("left"):"top"==t?F.find(e=>e.id==i.get("id")).defaults.find(e=>e.name==t).value=i.get(t)-e8.get("top"):F.find(e=>e.id==i.get("id")).defaults.find(e=>e.name==t).value=o}function tF(t,i){F.find(e=>e.id==i.get("id")).animate=e.grep(F.find(e=>e.id==i.get("id")).animate,function(e){return e!=t}),"left"==t?(F.find(e=>e.id==i.get("id")).animate=e.grep(F.find(e=>e.id==i.get("id")).animate,function(e){return"top"!=e}),S=e.grep(S,function(e){return e.id!=i.get("id")||"top"!=e.name}),F.find(e=>e.id==i.get("id")).defaults.find(e=>"left"==e.name).value=i.get("left")-e8.get("left"),F.find(e=>e.id==i.get("id")).defaults.find(e=>"top"==e.name).value=i.get("top")-e8.get("top")):"scaleX"==t?(F.find(e=>e.id==i.get("id")).defaults.find(e=>"height"==e.name).value=i.get("height"),F.find(e=>e.id==i.get("id")).defaults.find(e=>"width"==e.name).value=i.get("width"),F.find(e=>e.id==i.get("id")).defaults.find(e=>"scaleY"==e.name).value=i.get("scaleY"),F.find(e=>e.id==i.get("id")).animate=e.grep(F.find(e=>e.id==i.get("id")).animate,function(e){return"scaleY"!=e}),S=e.grep(S,function(e){return e.id!=i.get("id")||"scaleY"!=e.name}),F.find(e=>e.id==i.get("id")).animate=e.grep(F.find(e=>e.id==i.get("id")).animate,function(e){return"width"!=e}),S=e.grep(S,function(e){return e.id!=i.get("id")||"width"!=e.name}),F.find(e=>e.id==i.get("id")).animate=e.grep(F.find(e=>e.id==i.get("id")).animate,function(e){return"height"!=e}),S=e.grep(S,function(e){return e.id!=i.get("id")||"height"!=e.name})):"strokeWidth"==t?(F.find(e=>e.id==i.get("id")).defaults.find(e=>"stroke"==e.name).value=i.get("stroke"),F.find(e=>e.id==i.get("id")).animate=e.grep(F.find(e=>e.id==i.get("id")).animate,function(e){return"stroke"!=e}),S=e.grep(S,function(e){return e.id!=i.get("id")||"stroke"!=e.name})):"shadow.color"==t?(F.find(e=>e.id==i.get("id")).defaults.find(e=>"shadow.offsetX"==e.name).value=i.shadow.offsetX,F.find(e=>e.id==i.get("id")).defaults.find(e=>"shadow.offsetY"==e.name).value=i.shadow.offsetY,F.find(e=>e.id==i.get("id")).defaults.find(e=>"shadow.blur"==e.name).value=i.shadow.blur,S=e.grep(S,function(e){return e.id!=i.get("id")}),F.find(e=>e.id==i.get("id")).animate=e.grep(F.find(e=>e.id==i.get("id")).animate,function(e){return e}),S=e.grep(S,function(e){return e.id!=i.get("id")||"shadow.offsetX"!=e.name}),F.find(e=>e.id==i.get("id")).animate=e.grep(F.find(e=>e.id==i.get("id")).animate,function(e){return"shadow.offsetX"!=e}),S=e.grep(S,function(e){return e.id!=i.get("id")||"shadow.offsetY"!=e.name}),F.find(e=>e.id==i.get("id")).animate=e.grep(F.find(e=>e.id==i.get("id")).animate,function(e){return"shadow.offsetY"!=e}),S=e.grep(S,function(e){return e.id!=i.get("id")||"shadow.blur"!=e.name}),F.find(e=>e.id==i.get("id")).animate=e.grep(F.find(e=>e.id==i.get("id")).animate,function(e){return"shadow.blur"!=e})):"charSpacing"==t&&(F.find(e=>e.id==i.get("id")).defaults.find(e=>"charSpacing"==e.name).value=i.get("charSpacing"),F.find(e=>e.id==i.get("id")).animate=e.grep(F.find(e=>e.id==i.get("id")).animate,function(e){return"charSpacing"!=e}),S=e.grep(S,function(e){return e.id!=i.get("id")||"charSpacing"!=e.name})),S=e.grep(S,function(e){return e.id!=i.get("id")||e.name!=t}),"left"!=t&&"shadow.color"!=t&&(F.find(e=>e.id==i.get("id")).defaults.find(e=>e.name==t).value=i.get(t)),m.find(".keyframe[data-object='"+i.get("id")+"'][data-property='"+t+"']").remove()}function tY(e,t=!1){m.find("#layer-inner-list").removeClass("nolayers"),m.find("#nolayers").addClass("yaylayers");let i=F.find(t=>t.id==e.get("id")).color;var a,o="",n="",s="lock_open",r="freeze";"image"==e.get("type")?a=e.get("assetType")&&"video"==e.get("assetType")?$.videoLayerColor:$.imageLayerColor:"i-text"==e.get("type")||"textbox"==e.get("type")?a=$.textLayerColor:("rect"==e.get("type")||"group"==e.get("type")||"circle"==e.get("type")||"polygon"==e.get("type")||"path"==e.get("type"))&&(a=$.shapeLayerColor,e.get("assetType")&&"animatedText"==e.get("assetType")?a=$.animatedTextLayerColor:e.get("assetType")&&"audio"==e.get("assetType")&&(a=$.audioLayerColor)),"i-text"==e.get("type")||"textbox"==e.get("type")?o="title":"rect"==e.get("type")||"group"==e.get("type")||"circle"==e.get("type")||"polygon"==e.get("type")||"path"==e.get("type")?(o="star",e.get("assetType")&&"animatedText"==e.get("assetType")&&(o="title"),e.get("assetType")&&"audio"==e.get("assetType")&&(o="volume_up")):o="image"==e.get("type")?e.get("assetType")&&"video"==e.get("assetType")?"videocam":"image":e.get("assetType")&&"audio"==e.get("assetType")?"volume_up":"star",!0==e.lockMovementX&&(n="locked",s="lock"),!1!=t&&(r="freeze frozen");let l=R.find(t=>t.id==e.get("id")).trimstart/O,d=(R.find(t=>t.id==e.get("id")).end-R.find(t=>t.id==e.get("id")).trimstart)/O;m.find("#inner-timeline").prepend("<div class='object-props' id='"+e.get("id")+"' style='width:"+(R.find(t=>t.id==e.get("id")).end-R.find(t=>t.id==e.get("id")).start)/O+"px'><div class='row main-row'><div class='row-el' style='background-color:"+i+"'><div class='trim-row' style='left:"+l+"px;width:"+d+"px'></div></div></div></div>"),e.get("assetType")&&"audio"==e.get("assetType")?(e.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1}),m.find("#layer-inner-list:not(.nolayer)").prepend('<div class="layer" data-object="'+e.get("id")+'"><div class="layer-name"><span class="material-icons droparrow" style="color:'+a+';">arrow_right</span><span class="material-icons layer-object-icon" style="color:'+a+';">'+o+'</span><input class="layer-custom-name" value="'+F.find(t=>t.id==e.get("id")).label+'" readonly></span><div class="layer-options"><span class="material-icons '+r+'" title="'+pmotionParams.t112+'">watch_later</span></div></div><div class="properties"></div></div>')):m.find("#layer-inner-list:not(.nolayer)").prepend('<div class="layer" data-object="'+e.get("id")+'"><div class="layer-name"><span class="material-icons droparrow" style="color:'+a+';">arrow_right</span><span class="material-icons layer-object-icon" style="color:'+a+';">'+o+'</span><input class="layer-custom-name" value="'+F.find(t=>t.id==e.get("id")).label+'" readonly></span><div class="layer-options"><span class="material-icons lock '+n+'" title="Lock layer">'+s+'</span><span class="material-icons '+r+'" title="'+pmotionParams.t112+'">watch_later</span></div></div><div class="properties"></div></div>'),m.find(".layer[data-object='"+e.get("id")+"']").find(".properties").toggle(),tG(O),sortable("#layer-inner-list:not(.nolayer)",{placeholderClass:"hovering",copy:!0,customDragImage:(e,t,i)=>({element:document.getElementById("nothing"),posX:i.pageX-t.left,posY:i.pageY-t.top})}),!0==e.lockMovementX&&m.find(".layer[data-object='"+e.get("id")+"']").attr("draggable",!1)}function tT(e,t){"shadow.color"==e&&(e="shadowcolor"),m.find("#"+t.get("id")).append("<div class='row "+e+" keyframe-row' data-object='"+t.get("id")+"'><div class='row-el'></div></div>"),"left"==e?m.find(".layer[data-object='"+t.get("id")+"']").find(".properties").append("<div class='property-name' data-property='position'><span class='property-keyframe'></span>Position</div>"):"scaleX"==e?m.find(".layer[data-object='"+t.get("id")+"']").find(".properties").append("<div class='property-name' data-property='scale'><span class='property-keyframe'></span>Scale</div>"):"strokeWidth"==e?m.find(".layer[data-object='"+t.get("id")+"']").find(".properties").append("<div class='property-name' data-property='stroke'><span class='property-keyframe'></span>Stroke</div>"):"shadowcolor"==e?m.find(".layer[data-object='"+t.get("id")+"']").find(".properties").append("<div class='property-name' data-property='shadow'><span class='property-keyframe'></span>Shadow</div>"):"charSpacing"==e?m.find(".layer[data-object='"+t.get("id")+"']").find(".properties").append("<div class='property-name' data-property='charSpacing'><span class='property-keyframe'></span>Text</div>"):m.find(".layer[data-object='"+t.get("id")+"']").find(".properties").append("<div class='property-name' data-property='"+e+"'><span class='property-keyframe'></span>"+e+"</div>"),m.find("#"+t.get("id")).find(".keyframe-row."+e).toggle()}function t3(e){var t;ee++,"image"==e.get("type")?t=e.get("assetType")&&"video"==e.get("assetType")?$.videoLayerColor:$.imageLayerColor:"i-text"==e.get("type")||"textbox"==e.get("type")?t=$.textLayerColor:("rect"==e.get("type")||"group"==e.get("type")||"circle"==e.get("type")||"polygon"==e.get("type")||"path"==e.get("type"))&&(t=$.shapeLayerColor,e.get("assetType")&&"animatedText"==e.get("assetType")?t=$.animatedTextLayerColor:e.get("assetType")&&"audio"==e.get("assetType")&&(t=$.audioLayerColor)),e.get("assetType")&&"video"==e.get("assetType")||e.get("assetType")&&"audio"==e.get("assetType")?(F.push({object:e,id:e.get("id"),label:e.get("id"),color:t,defaults:[],locked:[],mask:"none",start:0,end:e.get("duration")}),e.get("duration")<I?R.push({start:0,end:e.get("duration"),trimstart:0,trimend:e.get("duration"),object:e,id:e.get("id")}):R.push({start:0,end:I,trimstart:0,trimend:I,object:e,id:e.get("id")})):(F.push({object:e,id:e.get("id"),label:e.get("id"),color:t,defaults:[],locked:[],mask:"none"}),e.get("notnew")?R.push({start:e.get("starttime"),end:I-e.get("starttime"),trimstart:0,trimend:I-A,object:e,id:e.get("id")}):R.push({start:0,end:I,trimstart:0,trimend:I,object:e,id:e.get("id")})),tY(e),e.get("assetType")&&"audio"==e.get("assetType")?(tT("volume",e),F.find(t=>t.id==e.id).defaults.push({name:"volume",value:.5})):X.forEach(function(t){"charSpacing"==t?("i-text"==e.get("type")||"textbox"==e.get("type"))&&(tT(t,e),F.find(t=>t.id==e.id).defaults.push({name:t,value:e.get(t)})):"shadow.blur"==t||"shadow.offsetX"==t||"shadow.offsetY"==t||"shadow.color"==t?"group"!=e.get("type")&&("shadow.color"==t?(tT(t,e),F.find(t=>t.id==e.id).defaults.push({name:t,value:e.shadow.color})):"shadow.blur"==t?F.find(t=>t.id==e.id).defaults.push({name:t,value:e.shadow.blur}):"shadow.offsetX"==t?F.find(t=>t.id==e.id).defaults.push({name:t,value:e.shadow.offsetX}):"shadow.offsetY"==t&&F.find(t=>t.id==e.id).defaults.push({name:t,value:e.shadow.offsetY})):("top"!=t&&"scaleY"!=t&&"stroke"!=t&&"width"!=t&&"height"!=t&&tT(t,e),F.find(t=>t.id==e.id).defaults.push({name:t,value:e.get(t)}))}),m.find(".layer-selected").removeClass("layer-selected"),m.find(".layer[data-object='"+e.get("id")+"']").addClass("layer-selected"),document.getElementsByClassName("layer-selected")[0].scrollIntoView(),F.find(t=>t.id==e.id).animate=[],"image"==e.get("type")&&e.get("assetType")&&"video"==e.get("assetType")&&tX("top",e,0,e.get("top"),!0),ti()}function tq(e,t,i,a,o){fabric.loadSVGFromURL(e,function(n,s){var r=n[0];n.length>1&&(r=fabric.util.groupSVGElements(n,s)),r.set({id:"Shape"+ee,stroke:"#000",left:t,top:i,strokeWidth:0,strokeUniform:!0,originX:"center",originY:"center",strokeDashArray:!1,absolutePositioned:!0,paintFirst:"stroke",objectCaching:!0,sourcePath:e,assetType:"svg",inGroup:!1,shadow:{color:"#000",offsetX:0,offsetY:0,blur:0,opacity:0}}),r.scaleToWidth(a),r.set({scaleX:parseFloat(r.get("scaleX").toFixed(2)),scaleY:parseFloat(r.get("scaleY").toFixed(2))}),eY.add(r),t3(r),eY.setActiveObject(r),eY.bringToFront(r),eY.requestRenderAll(),o&&(r.set("left",e8.get("left")+e8.get("width")/2),r.set("top",e8.get("top")+e8.get("height")/2),eY.requestRenderAll())})}function tE(e,t,i,a){var o=document.createElement("video"),n=document.createElement("source");n.src=e,o.crossOrigin="anonymous",o.appendChild(n),o.addEventListener("loadeddata",function(){async function n(){if(o.readyState>=3){var s=new fabric.Image(o,{left:t,top:i,width:o.width,height:o.height,originX:"center",originY:"center",backgroundColor:"rgba(255,255,255,0)",cursorWidth:1,stroke:"#000",strokeUniform:!0,paintFirst:"stroke",strokeWidth:0,cursorDuration:1,cursorDelay:250,source:e,duration:1e3*o.duration,assetType:"video",id:"Video"+ee,objectCaching:!1,strokeDashArray:!1,inGroup:!1,shadow:{color:"#000",offsetX:0,offsetY:0,blur:0,opacity:0}});s.saveElem=s.getElement(),eY.add(s),s.setElement(o),s.get("width")>e8.get("width")&&s.scaleToWidth(e8.get("width")/2),a&&(s.set("left",t),s.set("top",i),eY.requestRenderAll()),eY.bringToFront(s),window.duration<s.duration+A&&(window.duration=1e3*((s.duration+A)/1e3).toFixed(2)),t3(s),eY.setActiveObject(s),m.find("#load-video").removeClass("loading-active"),await eY.requestRenderAll()}else window.setTimeout(function(){n()},100),m.find("#load-video").removeClass("loading-active")}o.width=this.videoWidth,o.height=this.videoHeight,o.currentTime=0,o.muted=!1,window.setTimeout(function(){n()},100)}),o.currentTime=0}function tB(e){var t=eY.getItemById("crop");f.setCoords(),t.setCoords();var i=t.get("left")-t.get("width")*t.get("scaleX")/2,a=t.get("top")-t.get("height")*t.get("scaleY")/2,o=t.get("height")/f.get("scaleY")*t.get("scaleY"),n=t.get("width")/f.get("scaleX")*t.get("scaleX");f.get("height"),f.get("scaleY"),f.get("width"),f.get("scaleX");var s=i-(f.get("left")-f.get("width")*f.get("scaleX")/2),r=a-(f.get("top")-f.get("height")*f.get("scaleY")/2);s<0&&r>0?(e.set({cropY:r/f.get("scaleY"),height:o}).setCoords(),eY.requestRenderAll(),e.set({top:a+e.get("height")*e.get("scaleY")/2}),eY.requestRenderAll()):r<0&&s>0?(e.set({cropX:s/f.get("scaleX"),width:n}).setCoords(),eY.requestRenderAll(),e.set({left:i+e.get("width")*e.get("scaleX")/2}),eY.requestRenderAll()):r>0&&s>0&&(e.set({cropX:s/f.get("scaleX"),cropY:r/f.get("scaleY"),height:o,width:n}).setCoords(),eY.requestRenderAll(),e.set({left:i+e.get("width")*e.get("scaleX")/2,top:a+e.get("height")*e.get("scaleY")/2}),eY.requestRenderAll()),"cropped"!=e.get("id")&&(eY.remove(t),eY.remove(eY.getItemById("overlay")),eY.remove(eY.getItemById("cropped")),Q=!1,fabric.Object.prototype.controls.ml=new fabric.Control({x:-.5,y:0,offsetX:-1,cursorStyleHandler:fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingXOrSkewingY,getActionName:fabric.controlsUtils.scaleOrSkewActionName}),fabric.Object.prototype.controls.mr=new fabric.Control({x:.5,y:0,offsetX:1,cursorStyleHandler:fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingXOrSkewingY,getActionName:fabric.controlsUtils.scaleOrSkewActionName}),fabric.Object.prototype.controls.mb=new fabric.Control({x:0,y:.5,offsetY:1,cursorStyleHandler:fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingYOrSkewingX,getActionName:fabric.controlsUtils.scaleOrSkewActionName}),fabric.Object.prototype.controls.mt=new fabric.Control({x:0,y:-.5,offsetY:-1,cursorStyleHandler:fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingYOrSkewingX,getActionName:fabric.controlsUtils.scaleOrSkewActionName}),fabric.Object.prototype.controls.tl=new fabric.Control({x:-.5,y:-.5,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually}),fabric.Object.prototype.controls.tr=new fabric.Control({x:.5,y:-.5,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually}),fabric.Object.prototype.controls.bl=new fabric.Control({x:-.5,y:.5,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually}),fabric.Object.prototype.controls.br=new fabric.Control({x:.5,y:.5,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually}),eY.uniformScaling=!0,eY.requestRenderAll(),tX("scaleX",e,A,e.get("scaleX"),!0),tX("scaleY",e,A,e.get("scaleY"),!0),tX("width",e,A,e.get("width"),!0),tX("height",e,A,e.get("width"),!0),tX("left",e,A,e.get("left"),!0),tX("top",e,A,e.get("top"),!0),m.find("#properties-overlay").hide(),t_()),eY.requestRenderAll()}m.find("#download-real").on("click",function t(){if(m.addClass("loading"),m.find("#download-real").addClass("downloading"),"image"==m.find("input[name=download-radio]:checked").val()){m.find("#download-real").html('<div class="loader-wrap"><div class="loader-sm"></div></div>'+pmotionParams.t136);let a=m.find("#image-select").find(":selected").val();tw(!1).then(e=>{e.clone(function(e){e.requestRenderAll(),e.setWidth(e8.width),e.setHeight(e8.height),e.width=e8.width,e.height=e8.height,e.setZoom(1),e.requestRenderAll();let t=e.width,i=e.height,o=e8.left+e8.width/2-t/2,n=e8.top+e8.height/2-i/2;e.absolutePan({x:o,y:n}),e.setZoom(1),e.requestRenderAll();let s=e.toDataURL({format:a,enableRetinaScaling:!1}),r=document.createElement("a");r.download=name,r.href=s,document.body.appendChild(r),r.click(),document.body.removeChild(r),m.find("#download-real").html('<span class="material-icons">download</span>'+pmotionParams.t135),m.find("#download-real").removeClass("downloading"),m.removeClass("loading")})},function(e){toastr.error(e,pmotionParams.t105)})}else tw(!0).then(t=>{if(!W){W=!0,C=!0;var a,o,n,s,r,l=new AudioContext,d=(n=(o=16.666666666666668)/1e3,(s=l.createGain()).gain.value=0,s.connect(l.destination),function e(){var t=l.createOscillator();t.onended=e,t.connect(s),t.start(0),t.stop(l.currentTime+n),th(l.currentTime),r&&(t.onended=function(){})}(),r=!1,function(){r=!0});if(t.discardActiveObject(),0==t.getObjects().filter(e=>e.top<0||e.left<0).length){var c=new fabric.ActiveSelection(t.getObjects());t.setActiveObject(c),t.requestRenderAll(),t.discardActiveObject()}var f=document.getElementById("canvasrecord").captureStream(60);"webm"==m.find("input[name=download-radio]:checked").val()&&(F.forEach(function(i){t.getItemById(i.id).get("assetType")&&"video"==t.getItemById(i.id).get("assetType")&&(w=e(t.getItemById(i.id).getElement())[0])}),!1!=ec&&(w=ec),w&&(y=b.createMediaElementSource(w),i=b.createMediaStreamDestination(),y.connect(i),f.addTrack(i.stream.getAudioTracks()[0]),!1!=ec&&(ec.currentTime=0,ec.play()))),"undefined"==typeof MediaRecorder&&(window.MediaRecorder={isTypeSupported:function(){return!1}});var p="video/webm";MediaRecorder.isTypeSupported("video/webm;codecs=vp9")&&(p="video/webm;codecs=vp9"),"webm"==m.find("input[name=download-radio]:checked").val()?(m.find("#download-progress").css("display","flex"),a=RecordRTC(f,{type:"video",mimeType:p,timeSlice:1e3,recorderType:MediaStreamRecorder,disableLogs:!1,checkForInactiveTracks:!1,audioBitsPerSecond:-5e3,videoBitsPerSecond:-5e3,ondataavailable:function(e){Y.push(e)}})):(m.find("#download-gif-progress").css("display","flex"),a=RecordRTC(f,{type:"gif",frameRate:60,quality:parseInt(m.find("#gif-fps").val()),width:parseInt(t.width),height:parseInt(t.height),onGifPreview:function(e){m.find("#download-gif-preview").attr("src",e)}})),function e(){if(!eb){eb=!0,e$=1,m.find("#progress-bar-width").css("width","5%"),m.find("#download-progress-desc").html("5%");return}var t=a.getInternalRecorder();if(t&&t.getArrayOfBlobs){var i=new Blob(t.getArrayOfBlobs(),{type:"video/webm"}),o=i.size/e$*(I/1e3),n=100*i.size/o;"NaN"!==n.toFixed(2)&&(m.find("#progress-bar-width").css("width",n.toFixed(2)+"%"),m.find("#download-progress-desc").html(n.toFixed(2)+"%")),e$+=1}setTimeout(e,1e3)}();try{a.startRecording(),window.setTimeout(function(){a.stopRecording(function(e){d(),eb=!1,W=!1,function e(t){var i="",a="";if("webm"==m.find("input[name=download-radio]:checked").val()){if(Y==[]){toastr.error(pmotionParams.t142,pmotionParams.t105);return}a=new File(Y,"video.webm",{type:"video/webm"}),i=URL.createObjectURL(a),Y=[]}else if(!(i=t)){toastr.error(pmotionParams.t142,pmotionParams.t105);return}let o=document.createElement("a");o.style.display="none",o.href=i,o.download=name,document.body.appendChild(o),o.click(),W=!1,A=0,tS(!1,0),m.find("#seekbar").offset({left:20+m.find("#inner-timeline").offset().left+A/O}),eY.requestRenderAll(),tv(),m.find("#download-progress").css("display","none"),m.find("#download-gif-progress").css("display","none"),m.find("#download-real").removeClass("downloading"),m.find("#download-gif-preview").attr("src",""),m.removeClass("loading"),tw(!1)}(e),m.find("#seekbar").offset({left:20+m.find("#inner-timeline").offset().left+A/O}),eY.requestRenderAll(),console.log("Finished rendering"),window.setTimeout(function(){!1!=ec?(ec.pause(),ec.currentTime=0,tS(!0,0)):tS(!1,0),m.find("#skip-backward").trigger("click"),eY.requestRenderAll()},1e3)})},I)}catch(g){a.stopRecording(function(){eb=!1,d(),window.setTimeout(function(){m.find("#seekbar").offset({left:20+m.find("#inner-timeline").offset().left+A/O}),W=!1,A=0,!1!=ec?(ec.pause(),ec.currentTime=0,tS(!0,0)):tS(!1,0),m.find("#skip-backward").trigger("click"),eY.requestRenderAll(),tv(),m.find("#download-progress").css("display","none"),m.find("#download-gif-progress").css("display","none"),m.find("#download-real").removeClass("downloading"),m.find("#download-gif-preview").attr("src",""),m.removeClass("loading")},1e3)}),toastr.error(g.message,pmotionParams.t105)}}},function(e){toastr.error(e,pmotionParams.t105)})}),m.find("input[type=radio][name=download-radio]").change(function(){"image"==e(this).val()?(m.find("#gif-fps-select").addClass("d-none"),m.find("#image-format-select").removeClass("d-none")):"gif"==e(this).val()?(m.find("#image-format-select").addClass("d-none"),m.find("#gif-fps-select").removeClass("d-none")):(m.find("#gif-fps-select").addClass("d-none"),m.find("#image-format-select").addClass("d-none"))}),window.addEventListener("resize",tv,!1),tv(),m.on("click","#undo",function(){q.length>=1&&tx(q,B,E,L)}),m.on("click","#redo",function(){B.length>=1&&tx(B,q,L,E)}),m.on("click",".freeze",function(t){var i=eY.getActiveObject();if(null!=i&&"activeSelection"==i.type)return;t.stopPropagation();let a=eY.getItemById(e(this).parent().parent().parent().attr("data-object"));e(this).hasClass("frozen")?(e(this).removeClass("frozen"),F.find(e=>e.id==a.get("id")).animate=[],S=e.grep(S,function(e){return e.id!=a.get("id")}),m.find(".keyframe[data-object='"+a.get("id")+"']").remove(),e(this).parent().parent().parent().find(".freeze-prop").removeClass("frozen")):(e(this).addClass("frozen"),F.find(e=>e.id==a.get("id")).animate=[],"audio"==a.get("assetType")?(F.find(e=>e.id==a.get("id")).animate.push("volume"),S=e.grep(S,function(e){return e.id!=a.get("id")}),m.find(".keyframe[data-object='"+a.get("id")+"']").remove(),e(this).parent().parent().parent().find(".freeze-prop").removeClass("frozen"),tX("volume",a,0,.5,!0)):(X.forEach(function(e){F.find(e=>e.id==a.get("id")).animate.push(e)}),S=e.grep(S,function(e){return e.id!=a.get("id")}),m.find(".keyframe[data-object='"+a.get("id")+"']").remove(),e(this).parent().parent().parent().find(".freeze-prop").removeClass("frozen"),X.forEach(function(e){"charSpacing"==e?("i-text"==a.get("type")||"textbox"==a.get("type"))&&tX(e,a,0,a.get(e),!0):"shadow.blur"==e||"shadow.offsetX"==e||"shadow.offsetY"==e||"shadow.color"==e?"group"!=a.get("type")&&("shadow.color"==e?tX(e,a,0,a.shadow.color,!0):"shadow.offsetX"==e?tX(e,a,0,a.shadow.offsetX,!0):"shadow.offsetY"==e?tX(e,a,0,a.shadow.offsetY,!0):"shadow.blur"==e&&tX(e,a,0,a.shadow.blur,!0)):tX(e,a,0,a.get(e),!0)}))),t_()}),m.on("click",".freeze-prop",function(t){t.stopPropagation();var i,a,o=e(this).parent().attr("data-property");let n=eY.getItemById(e(this).parent().parent().parent().attr("data-object"));if("position"==o?o="left":"scale"==o?o="scaleX":"stroke"==o?o="strokeWidth":"shadow"==o&&(o="shadow.color"),e(this).parent().parent().parent().find(".freeze").hasClass("frozen")){F.find(e=>e.id==n.get("id")).animate=[],e(this).parent().parent().parent().find(".freeze").removeClass("frozen");var s=[o,"scaleY","width","height","top","stroke","shadow.offsetX","shadow.offsetY","shadow.blur"];X.forEach(function(t){-1==e.inArray(t,s)&&(("i-text"==n.get("type")||"textbox"==n.get("type"))&&"charSpacing"==t?tF(t,n):"charSpacing"!=t&&tF(t,n))})}e(this).hasClass("frozen")?(e(this).removeClass("frozen"),tF(o,n)):(e(this).addClass("frozen"),i=o,a=n,F.find(e=>e.id==a.get("id")).animate.push(i),"left"==i?(F.find(e=>e.id==a.get("id")).animate.push("top"),tX("left",a,A,a.get("left"),!0),tX("top",a,A,a.get("top"),!0),F.find(e=>e.id==a.get("id")).defaults.find(e=>"left"==e.name).value=a.get("left")-e8.get("left"),F.find(e=>e.id==a.get("id")).defaults.find(e=>"top"==e.name).value=a.get("top")-e8.get("top")):"scaleX"==i?(tX("scaleY",a,A,a.get("scaleY"),!0),tX("width",a,A,a.get("width"),!0),tX("height",a,A,a.get("height"),!0),F.find(e=>e.id==a.get("id")).animate.push("scaleY"),F.find(e=>e.id==a.get("id")).animate.push("width"),F.find(e=>e.id==a.get("id")).animate.push("height"),F.find(e=>e.id==a.get("id")).defaults.find(e=>"height"==e.name).value=a.get("height"),F.find(e=>e.id==a.get("id")).defaults.find(e=>"width"==e.name).value=a.get("width"),F.find(e=>e.id==a.get("id")).defaults.find(e=>"scaleY"==e.name).value=a.get("scaleY")):"strokeWidth"==i?(tX("stroke",a,A,a.get("stroke"),!0),F.find(e=>e.id==a.get("id")).defaults.find(e=>"stroke"==e.name).value=a.get("stroke"),F.find(e=>e.id==a.get("id")).animate.push("stroke")):"shadow.color"==i?(tX("shadow.color",a,A,a.shadow.color,!0),tX("shadow.offsetX",a,A,a.shadow.offsetX,!0),tX("shadow.offsetY",a,A,a.shadow.offsetY,!0),tX("shadow.blur",a,A,a.shadow.blur,!0),F.find(e=>e.id==a.get("id")).defaults.find(e=>"shadow.color"==e.name).value=a.get("shadow.color"),F.find(e=>e.id==a.get("id")).defaults.find(e=>"shadow.offsetX"==e.name).value=a.get("shadow.offsetX"),F.find(e=>e.id==a.get("id")).defaults.find(e=>"shadow.offsetY"==e.name).value=a.get("shadow.offsetY"),F.find(e=>e.id==a.get("id")).defaults.find(e=>"shadow.blur"==e.name).value=a.get("shadow.blur"),F.find(e=>e.id==a.get("id")).animate.push("shadow.offsetX"),F.find(e=>e.id==a.get("id")).animate.push("shadow.offsetY"),F.find(e=>e.id==a.get("id")).animate.push("shadow.blur")):"charSpacing"==i&&(tX("charSpacing",a,A,a.get("charSpacing"),!0),F.find(e=>e.id==a.get("id")).defaults.find(e=>"charSpacing"==e.name).value=a.get("charSpacing"),F.find(e=>e.id==a.get("id")).animate.push("charSpacing")),"left"!=i&&"shadow.color"!=i&&(tX(i,a,A,a.get(i),!0),F.find(e=>e.id==a.get("id")).defaults.find(e=>e.name==i).value=a.get(i))),t_()}),m.on("click",".lock",function(t){t.stopPropagation();let i=eY.getItemById(e(this).parent().parent().parent().attr("data-object"));e(this).hasClass("locked")?(e(this).html("lock_open"),e(this).removeClass("locked"),i.lockMovementX=!0,i.lockMovementY=!0,i.lockRotation=!0,e(this).parent().parent().parent().attr("draggable",!0)):(e(this).html("lock"),e(this).addClass("locked"),i.lockMovementX=!0,i.lockMovementY=!0,i.lockRotation=!0,eY.getActiveObject()==i&&(eY.discardActiveObject(),eY.requestRenderAll()),e(this).parent().parent().parent().attr("draggable",!1)),t_()}),m.on("click",".object-more",function(){var t=e(this),i=parseInt(t.attr("data-offset")),a=t.attr("data-folder"),o=parseInt(t.attr("data-count"));t.html(pmotionParams.t113),t.prop("disabled",!0);for(var n=i;n<o;n++){var s='<div class="grid-item new"><img class="object-svg" draggable="false" src="'+a+n+'.svg" data-file="'+a+n+'.svg" /></div>';e(this).prev().append(s)}e(this).after('<button type="button" class="btn object-more-toggle toggle-active">'+pmotionParams.t115+'<span class="material-icons">expand_less</span></div>'),t.remove()}),m.on("click",".object-more-toggle",function(){var t=e(this).prev().find(".new");e(this).hasClass("toggle-active")?(t.hide(),e(this).html(pmotionParams.t114+'<span class="material-icons">expand_more</span>'),e(this).removeClass("toggle-active")):(t.show(),e(this).html(pmotionParams.t115+'<span class="material-icons">expand_less</span>'),e(this).addClass("toggle-active"))});var t1=new Image;t1.src=$.baseURL+"assets/tlcrop.svg";var t8=new Image;t8.src=$.baseURL+"assets/trcrop.svg";var t4=new Image;t4.src=$.baseURL+"assets/blcrop.svg";var tP=new Image;function t5(e,t,i,a,o){var n=new Image;n.onload=function(e){var s,r,l,d,c,f;s=n,r=t,l=i,d=a,c=o,f=new fabric.Image(s,{left:r,top:l,originX:"center",originY:"center",stroke:"#000",strokeUniform:!0,strokeWidth:0,paintFirst:"stroke",absolutePositioned:!0,id:"Image"+ee,inGroup:!1,strokeDashArray:!1,objectCaching:!0,shadow:{color:"black",offsetX:0,offsetY:0,blur:0,opacity:0}}),eY.add(f),f.scaleToWidth(d),f.set({scaleX:parseFloat(f.get("scaleX").toFixed(2)),scaleY:parseFloat(f.get("scaleY").toFixed(2)),ogWidth:f.get("width"),ogHeight:f.get("height")}),eY.bringToFront(f),eY.requestRenderAll(),t3(f),eY.setActiveObject(f),c&&(f.set("left",r),f.set("top",l),eY.requestRenderAll()),m.find("#load-image").removeClass("loading-active")},n.src=e}function tL(e,t,i,a){return new Promise((o,n)=>{let s=document.createElement("video");a?s.setAttribute("src",e):s.setAttribute("src",URL.createObjectURL(e)),s.setAttribute("crossorigin","anonymous"),s.load(),s.addEventListener(pmotionParams.t105,e=>{n(pmotionParams.t116,e)}),s.addEventListener("loadedmetadata",()=>{if(s.duration<i){n(pmotionParams.t117);return}setTimeout(()=>{s.currentTime=i},200),s.addEventListener("seeked",()=>{var e=document.createElement("canvas"),i=e.getContext("2d");e.width=s.videoWidth,e.height=s.videoheight,i.drawImage(s,0,0),s.videoWidth>s.videoHeight?(e.height=s.videoHeight/s.videoWidth*t,e.width=t):(e.width=s.videoWidth/s.videoHeight*t,e.height=t),i.drawImage(e,0,0,e.width,e.height),i.drawImage(s,0,0,e.width,e.height),o(e.toDataURL())})})})}function t7(e,t){return new Promise(function(i,a){var o=new FileReader;o.onload=function(e){var a=new Image;a.onload=function(){if(a.width>t){var e=document.createElement("canvas"),o=e.getContext("2d");e.width=a.width,e.height=a.height,o.drawImage(a,0,0),a.width>a.height?(e.height=a.height/a.width*t,e.width=t):(e.width=a.width/a.height*t,e.height=t),o.drawImage(e,0,0,e.width,e.height),o.drawImage(a,0,0,e.width,e.height),i(e.toDataURL())}else i(a.src)},a.src=e.target.result},o.readAsDataURL(e)})}function t2(e){for(var t=atob(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],a=new ArrayBuffer(t.length),o=new Uint8Array(a),n=0;n<t.length;n++)o[n]=t.charCodeAt(n);return new Blob([a],{type:i})}async function tH(){let e=await fetch(m.find("#upload-link-input").val()).then(e=>e.blob());"image"===e.type.split("/")[0]?(m.find("#upload-link-input").val(""),m.find(".upload-show").removeClass("upload-show"),t7(e,250).then(function(t){tr(t2(t),e,e.type.split("/")[0],"temp",!1,!1)})):"video"===e.type.split("/")[0]?(m.find(".upload-show").removeClass("upload-show"),tL(e,250,0,!1).then(function(t){tr(t2(t),e,e.type.split("/")[0],"temp",!1,!1)}),m.find("#upload-link-input").val("")):alert(pmotionParams.t118)}function tW(e=!1){var t;(t=!1==e?m.find("#filepick").get(0).files:e.originalEvent.dataTransfer.files)&&(Array.from(t).forEach(e=>{ed=!0,e.size/1024/1024<=$.maxUploadLimit?(m.find("#upload-button").html("<span class='material-icons'>file_upload</span>"+pmotionParams.t119),m.find("#upload-button").addClass("uploading"),"image/png"===e.type||"image/jpg"===e.type||"image/jpeg"===e.type||"image/svg+xml"===e.type?(m.find(".upload-show").removeClass("upload-show"),t7(e,250).then(function(t){tr(t2(t),e,e.type.split("/")[0],"temp",!1,!1)})):"video/mp4"===e.type||"video/webm"===e.type?(m.find(".upload-show").removeClass("upload-show"),tL(e,250,0,!1).then(function(t){tr(t2(t),e,e.type.split("/")[0],"temp",!1,!1)})):(toastr.error("File type not accepted.",pmotionParams.t105),m.find("#upload-button").html('<span class="material-icons">file_upload</span>'+pmotionParams.t120),m.find("#upload-button").removeClass("uploading"))):toastr.error(pmotionParams.t105,pmotionParams.t121)}),1==t.length&&("image"===t[0].type.split("/")[0]?m.find("#images-tab").trigger("click"):"video"===t[0].type.split("/")[0]?m.find("#videos-tab").trigger("click"):"audio"===t[0].type.split("/")[0]&&m.find("#audio-tool-select").trigger("click")))}function tD(e,t){var i=new Audio(e),a="Audio"+ee;i.crossOrigin="anonymous",i.addEventListener("loadeddata",()=>{var t=new fabric.Rect({id:a,width:10,height:10,audioSrc:e,duration:1e3*i.duration,opacity:0,selectable:!1,volume:.5,assetType:"audio",shadow:{color:"#000",offsetX:0,offsetY:0,blur:0,opacity:0},hasControls:!1,borderColor:"transparent"});eY.add(t),t3(t)})}function tz(e,t,i,a,o,n,s,r){var l=new fabric.IText(i,{left:a,top:o,originX:"center",originY:"center",fontFamily:"Roboto",fill:"#000",fontSize:e,fontWeight:t,textAlign:"center",cursorWidth:1,stroke:"#000",strokeWidth:0,cursorDuration:1,paintFirst:"stroke",objectCaching:!1,absolutePositioned:!0,strokeUniform:!0,inGroup:!1,cursorDelay:250,strokeDashArray:!1,editingBorderColor:"rgba(74, 255, 255, 0.4)",id:"Text"+ee,shadow:{color:"#000",offsetX:0,offsetY:0,blur:0,opacity:0}});l.setControlsVisibility({mt:!1,mb:!1}),eY.add(l),t3(l),eY.setActiveObject(l),eY.bringToFront(l),eY.requestRenderAll(),s&&(l.set("left",e8.get("left")+e8.get("width")/2),l.set("top",e8.get("top")+e8.get("height")/2),eY.requestRenderAll()),eY.getActiveObject().set("fontFamily",r),eY.requestRenderAll()}function tU(t,i,a=!0){"animatedText"==t.get("assetType")&&a&&(eh=e.grep(eh,function(e){return e.id!=t.id})),m.find(".layer[data-object='"+t.get("id")+"']").remove(),m.find("#"+t.get("id")).remove(),S=e.grep(S,function(e){return e.id!=t.get("id")}),R=e.grep(R,function(e){return e.id!=t.get("id")}),F=e.grep(F,function(e){return e.id!=t.get("id")}),i.remove(t),i.requestRenderAll(),i.discardActiveObject(),0==F.length&&(m.find("#layer-inner-list").addClass("nolayers"),m.find("#nolayers").removeClass("yaylayers"))}function t6(t){m.find("#inner-timeline").css("width",t/O+50),m.find("#inner-seekarea").css("width",t/O+50);var i=Math.floor((I=t)/1e3/60),a=(I/1e3-60*i).toFixed(2);m.find("#total-time input").val(("0"+i).slice(-2)+":"+("0"+Math.floor(a)).slice(-2)+":"+("0"+Math.floor(a%1*100)).slice(-2)),m.find(".object-props").each(function(){e(this).css("width",I/O-R.find(t=>t.id==e(this).attr("id")).start/O+"px"),R.find(t=>t.id==e(this).attr("id")).end=I,R.find(t=>t.id==e(this).attr("id")).trimend>R.find(t=>t.id==e(this).attr("id")).end&&(R.find(t=>t.id==e(this).attr("id")).trimend=I,e(this).find(".trim-row").css("width",I/O-R.find(t=>t.id==e(this).attr("id")).trimstart/O+"px"))}),tG(O)}function tG(t){m.find(".object-props").each(function(){e(this).offset({left:R.find(t=>t.id==e(this).attr("id")).start/t+m.find("#inner-timeline").offset().left+20}),e(this).css({width:e(this).width()*O/t}),e(this).find(".trim-row").css({left:R.find(t=>t.id==e(this).attr("id")).trimstart/t}),e(this).find(".trim-row").css({width:e(this).find(".trim-row").width()*O/t})}),O=t,m.find(".keyframe").each(function(){e(this).offset({left:e(this).attr("data-time")/O+m.find("#inner-timeline").offset().left+20})}),m.find("#seekbar").offset({left:m.find("#inner-timeline").offset().left+A/O+20}),m.find("#inner-timeline").css({width:I/O+50}),m.find("#inner-seekarea").css({minWidth:I/O+50}),function e(){var t=1e3/O-20,i=0,a=1;for(O>18?a=5:O>12&&(a=2),m.find("#time-numbers").html(""),m.find("#time-numbers").append("<div class='time-number' style='margin-left:20px'>"+i+"s<span></span></div>"),i++;1e3*i<=I;)m.find("#time-numbers").append("<div class='time-number' style='margin-left:"+t+"px'>"+i+"s<span></span></div>"),i%a!=0&&m.find(".time-number:last-child()").css("opacity","0"),i++}()}function tV(){S=e.grep(S,function(e){return e.t!=o.attr("data-time")||e.id!=o.attr("data-object")||e.name!=o.attr("data-property")}),"left"==o.attr("data-property")?S=e.grep(S,function(e){return e.t!=o.attr("data-time")||e.id!=o.attr("data-object")||"top"!=e.name}):"scaleX"==o.attr("data-property")?(S=e.grep(S,function(e){return e.t!=o.attr("data-time")||e.id!=o.attr("data-object")||"scaleY"!=e.name}),S=e.grep(S,function(e){return e.t!=o.attr("data-time")||e.id!=o.attr("data-object")||"width"!=e.name}),S=e.grep(S,function(e){return e.t!=o.attr("data-time")||e.id!=o.attr("data-object")||"height"!=e.name})):"strokeWidth"==o.attr("data-property")?S=e.grep(S,function(e){return e.t!=o.attr("data-time")||e.id!=o.attr("data-object")||"stroke"!=e.name}):"shadow.color"==o.attr("data-property")?(S=e.grep(S,function(e){return e.t!=o.attr("data-time")||e.id!=o.attr("data-object")||"shadow.blur"!=e.name}),S=e.grep(S,function(e){return e.t!=o.attr("data-time")||e.id!=o.attr("data-object")||"shadow.offsetX"!=e.name}),S=e.grep(S,function(e){return e.t!=o.attr("data-time")||e.id!=o.attr("data-object")||"shadow.offsetY"!=e.name})):"charSpacing"==o.attr("data-property")&&(S=e.grep(S,function(e){return e.t!=o.attr("data-time")||e.id!=o.attr("data-object")||"charSpacing"!=e.name})),o.remove(),m.find("#keyframe-properties").removeClass("show-properties")}function tN(){en.length>0?(en.forEach(function(t){o=e(t.keyframe),tV()}),en=[]):tV(),tS(!1,A),t_()}function tK(t,i,a){var o=parseFloat((t.position().left*O).toFixed(1));let n=t.attr("data-property"),s=t.attr("data-time"),r=e.grep(S,function(e){return e.t==parseFloat(s)&&e.id==t.attr("data-object")&&e.name==n}),l=eY.getItemById(r[0].id);o=parseFloat(R.find(e=>e.id==l.get("id")).start)+o,i&&(o=A);var d=r[0].value;i?d="shadow.color"==n?l.shadow.color:l.get(n):"left"==n&&(d+=e8.get("left")),S=e.grep(S,function(e){return e.t!=parseFloat(s)||e.id!=t.attr("data-object")||e.name!=n}),tX(n,l,o,d,!1);var c="",f="";"left"==n?(f=(c=e.grep(S,function(e){return e.t==parseFloat(s)&&e.id==t.attr("data-object")&&"top"==e.name}))[0].value+e8.get("top"),i&&(f=eY.getItemById(c[0].id).get("top")),S=e.grep(S,function(e){return e.t!=parseFloat(s)||e.id!=t.attr("data-object")||"top"!=e.name}),tX("top",l,o,f,!1)):"scaleX"==n?(f=(c=e.grep(S,function(e){return e.t==parseFloat(s)&&e.id==t.attr("data-object")&&"scaleY"==e.name}))[0].value,i&&(f=eY.getItemById(c[0].id).get("scaleY")),S=e.grep(S,function(e){return e.t!=parseFloat(s)||e.id!=t.attr("data-object")||"scaleY"!=e.name}),tX("scaleY",l,o,f,!1),(c=e.grep(S,function(e){return e.t==parseFloat(s)&&e.id==t.attr("data-object")&&"width"==e.name})).length>0&&(f=c[0].value,i&&(f=eY.getItemById(c[0].id).get("width")),S=e.grep(S,function(e){return e.t!=parseFloat(s)||e.id!=t.attr("data-object")||"width"!=e.name}),tX("width",l,o,f,!1)),(c=e.grep(S,function(e){return e.t==parseFloat(s)&&e.id==t.attr("data-object")&&"height"==e.name})).length>0&&(f=c[0].value,i&&(f=eY.getItemById(c[0].id).get("height")),S=e.grep(S,function(e){return e.t!=parseFloat(s)||e.id!=t.attr("data-object")||"height"!=e.name}),tX("height",l,o,f,!1))):"strokeWidth"==n&&(f=(c=e.grep(S,function(e){return e.t==parseFloat(s)&&e.id==t.attr("data-object")&&"stroke"==e.name}))[0].value,i&&(f=eY.getItemById(c[0].id).get("stroke")),S=e.grep(S,function(e){return e.t!=parseFloat(s)||e.id!=t.attr("data-object")||"stroke"!=e.name}),tX("stroke",l,o,f,!1)),a?t.attr("data-time",o):t.attr("data-time",o+R.find(e=>e.id==r[0].id).start),S.sort(function(e,t){return e.id.indexOf("Group")>=0&&-1==t.id.indexOf("Group")?1:t.id.indexOf("Group")>=0&&-1==e.id.indexOf("Group")?-1:0})}function tM(t){0==en.length&&(t.offset().left>m.find("#seekbar").offset().left-5&&t.offset().left<m.find("#seekbar").offset().left+5?(t.offset({left:m.find("#seekbar").offset().left}),m.find("#line-snap").offset({left:m.find("#seekbar").offset().left,top:t.parent().parent().offset().top}),m.find("#line-snap").css({height:t.parent().parent().height()}),m.find("#line-snap").addClass("line-active")):t.parent().parent().find(".keyframe").each(function(i){if(!t.is(e(this))&&t.offset().left>e(this).offset().left-5&&t.offset().left<e(this).offset().left+5)return t.offset({left:e(this).offset().left}),m.find("#line-snap").offset({left:e(this).offset().left,top:t.parent().parent().offset().top}),m.find("#line-snap").css({height:t.parent().parent().height()}),m.find("#line-snap").addClass("line-active"),!1;i==m.find(".keyframe").length-1&&m.find("#line-snap").removeClass("line-active")}))}function tZ(){var e=Math.floor(A/1e3/60),t=(A/1e3-60*e).toFixed(2);m.find("#current-time input").val(("0"+e).slice(-2)+":"+("0"+Math.floor(t)).slice(-2)+":"+("0"+Math.floor(t%1*100)).slice(-2))}function tJ(t){if(e(t.target).hasClass("keyframe"))return!1;C=!0,m.find("#seekarea").scrollLeft(),(A=parseFloat(((t.pageX+m.find("#seekarea").scrollLeft()-m.find("#timearea").offset().left-20)*O).toFixed(1)))<0&&(A=0),A%16.666!=0&&(A=16.666*Math.ceil(A/16.666)),tZ(),m.find("#seekbar").offset({left:20+m.find("#inner-timeline").offset().left+A/O}),tS(!1,A),ez()}function tQ(){m.find("#seek-hover").css({opacity:0})}function t9(e){m.find("#seek-hover").css({opacity:.3}),m.find("#seekarea").scrollLeft(),eu=parseFloat(((e.pageX+m.find("#seekarea").scrollLeft()-m.find("#timearea").offset().left-20)*O).toFixed(1)),e.pageX>=20+m.find("#inner-timeline").offset().left&&m.find("#seek-hover").offset({left:e.pageX})}function ie(){return kjua({text:m.find("#qrcode-text").val(),render:"svg",size:300,fill:m.find("#qrcode-fill").val(),back:m.find("#qrcode-back").val(),rounded:m.find("#qrcode-rounded").val(),mode:"label",label:m.find("#qrcode-label").val(),fontname:"sans",fontcolor:m.find("#qrcode-label-color").val(),mSize:m.find("#qrcode-label-size").val(),mPosX:m.find("#qrcode-label-position-x").val(),mPosY:m.find("#qrcode-label-position-y").val()})}tP.src=$.baseURL+"assets/brcrop.svg",m.on("click","#crop-image",function(){eY.getActiveObject()&&function e(t){if(!Q){m.find("#properties-overlay").show(),Q=!0,f=t,eY.uniformScaling=!1,f.setCoords();var i=f.get("left")-f.get("width")*f.get("scaleX")/2,a=f.get("top")-f.get("height")*f.get("scaleY")/2,o=f.get("cropX"),n=f.get("cropY");eY.add(new fabric.Rect({left:e8.left,top:e8.top,originX:"left",originY:"top",width:e8.width,height:e8.height,fill:"rgba(0,0,0,0.5)",selectable:!1,id:"overlay"}));var s=new fabric.Rect({left:t.get("left"),top:t.get("top"),width:t.get("width")*t.get("scaleX")-5,height:t.get("height")*t.get("scaleY")-5,originX:"center",originY:"center",id:"crop",fill:"rgba(0,0,0,0)",shadow:{color:"black",offsetX:0,offsetY:0,blur:0,opacity:0}});f.clone(function(e){e.set({id:"cropped",selectable:!1,originX:"center",originY:"center"}),eY.add(e),eY.bringToFront(e),eY.bringToFront(s),eY.requestRenderAll(),f=t}),f.set({cropX:0,cropY:0,width:f.get("ogWidth"),height:f.get("ogHeight")}).setCoords(),eY.requestRenderAll(),f.set({left:i+f.get("width")*f.get("scaleX")/2-o*f.get("scaleX"),top:a+f.get("height")*f.get("scaleY")/2-n*f.get("scaleY")}),s.setControlsVisibility({mt:!1,mb:!1,mr:!1,ml:!1,mtr:!1,deleteControl:!1,cloneControl:!1}),s.controls.tl=new fabric.Control({x:-.5,y:-.5,offsetX:3,offsetY:3,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually,render:function(e,t,i,a,o){e.save(),e.translate(t,i),e.rotate(fabric.util.degreesToRadians(o.angle)),e.drawImage(t1,-13.5,-13.5,27,27),e.restore()}}),s.controls.tr=new fabric.Control({x:.5,y:-.5,offsetX:-3,offsetY:3,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually,render:function(e,t,i,a,o){e.save(),e.translate(t,i),e.rotate(fabric.util.degreesToRadians(o.angle)),e.drawImage(t8,-13.5,-13.5,27,27),e.restore()}}),s.controls.bl=new fabric.Control({x:-.5,y:.5,offsetX:3,offsetY:-3,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually,render:function(e,t,i,a,o){e.save(),e.translate(t,i),e.rotate(fabric.util.degreesToRadians(o.angle)),e.drawImage(t4,-13.5,-13.5,27,27),e.restore()}}),s.controls.br=new fabric.Control({x:.5,y:.5,offsetX:-3,offsetY:-3,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually,render:function(e,t,i,a,o){e.save(),e.translate(t,i),e.rotate(fabric.util.degreesToRadians(o.angle)),e.drawImage(tP,-13.5,-13.5,27,27),e.restore()}}),eY.add(s),eY.setActiveObject(s),eY.requestRenderAll(),h=s.get("left"),u=s.get("top"),p=s.get("scaleX")-.03,g=s.get("scaleY")-.03}}(eY.getActiveObject())}),m.on("click","#upload-link-add",tH),m.on("change","#filepick",function(){tW(!1)}),m.on("change","#filepick2",function e(){let t=m.find("#filepick2").get(0).files;t&&1==t.length&&("audio"===t[0].type.split("/")[0]?t[0].size/1024/1024<=$.maxUploadLimit?(m.find("#audio-upload-button").html('<span class="material-icons">file_upload</span>'+pmotionParams.t119),m.find("#audio-upload-button").addClass("uploading"),td(t[0])):alert(pmotionParams.t121):alert(pmotionParams.t103))}),m.on("click",".format-text",function(){var t=!1;eY.getActiveObject().isEditing||(eY.getActiveObject().enterEditing(),eY.getActiveObject().selectAll(),t=!0),e(this).hasClass("format-text-active")?("format-bold"==e(this).attr("id")?eY.getActiveObject().setSelectionStyles({fontWeight:"normal"}):"format-italic"==e(this).attr("id")?eY.getActiveObject().setSelectionStyles({fontStyle:"normal"}):"format-underline"==e(this).attr("id")?eY.getActiveObject().setSelectionStyles({underline:!1}):eY.getActiveObject().setSelectionStyles({linethrough:!1}),e(this).removeClass("format-text-active")):(e(this).addClass("format-text-active"),"format-bold"==e(this).attr("id")?eY.getActiveObject().setSelectionStyles({fontWeight:"bold"}):"format-italic"==e(this).attr("id")?eY.getActiveObject().setSelectionStyles({fontStyle:"italic"}):"format-underline"==e(this).attr("id")?eY.getActiveObject().setSelectionStyles({underline:!0}):eY.getActiveObject().setSelectionStyles({linethrough:!0})),t&&eY.getActiveObject().exitEditing(),eY.requestRenderAll(),t_()}),m.on("click",".align-text",function(){var t;m.find(".align-text-active").removeClass("align-text-active"),e(this).addClass("align-text-active"),t="align-text-left"==e(this).attr("id")?"left":"align-text-center"==e(this).attr("id")?"center":"align-text-right"==e(this).attr("id")?"right":"justify",eY.getActiveObject().set({textAlign:t}),eY.requestRenderAll(),t_()}),m.on("change","#anim-weight",function(){var t=e(this).find(":selected").val(),i=eY.getActiveObject();eh.find(e=>e.id==i.id).reset(eh.find(e=>e.id==i.id).text,e.extend(eh.find(e=>e.id==i.id).props,{fontWeight:t}),eY,i),eY.requestRenderAll(),t_()}),m.on("change","#font-picker",function(){var t=e(this).val();eY.getActiveObject().get("assetType")?WebFont.load({google:{families:[t+":italic,regular,bold"]},active(){var i=eY.getActiveObject();eh.find(e=>e.id==i.id).reset(eh.find(e=>e.id==i.id).text,e.extend(eh.find(e=>e.id==i.id).props,{fontFamily:t}),eY,i),eY.requestRenderAll(),t_()}}):WebFont.load({google:{families:[t+":italic,regular,bold"]},active(){eY.getActiveObject().set("fontFamily",t),eY.requestRenderAll(),t_()}})}),m.on("click",".droparrow",function(){let t=e(this).parent().parent().attr("data-object");e(this).parent().parent().find(".properties").toggle(),e(this).parent().parent().find(".droparrow").toggleClass("layeron"),e(this).parent().parent().find(".droparrow").html("arrow_right"),e(this).parent().parent().find(".layeron").html("arrow_drop_down"),m.find(".keyframe-row[data-object='"+t+"']").toggle(),tG(O)}),m.on("click",".layer-name",function(t){if(!e(t.target).hasClass("droparrow")){let i=e(this).parent().attr("data-object");m.find(".layer-selected").removeClass("layer-selected"),e(this).parent().addClass("layer-selected"),eY.discardActiveObject(),eY.setActiveObject(eY.getItemById(i))}}),m.on("click","#delete-keyframe",tN),m.on("mousedown",".keyframe",function(t){if(3==t.which)return!1;t.stopPropagation(),t.preventDefault();var i=this,a=e(this),n=t.pageX,s=e(this).offset(),r=!1;function l(t){r=!0;var o=s.left+(t.pageX-n);0==en.length?(o>m.find("#timearea").offset().left+20?a.offset({left:o}):a.offset({left:m.find("#timearea").offset().left+20}),tM(a)):en.forEach(function(s){s.keyframe!=i?(e(s.keyframe).offset({left:s.offset+(t.pageX-n)}),tM(e(s.keyframe))):(a.offset({left:o}),tM(a))})}function d(t){if(m.off("mousemove",l).off("mouseup",d),m.find("#line-snap").removeClass("line-active"),r){if(0==en.length){var n=parseFloat((a.position().left*O).toFixed(1));n%16.666!=0&&a.offset({left:16.666*Math.ceil(n/16.666)/O+a.parent().offset().left}),tK(a,!1)}else en.forEach(function(t){var i=parseFloat((e(t.keyframe).position().left*O).toFixed(1));i%16.666!=0&&e(t.keyframe).offset({left:16.666*Math.ceil(i/16.666)/O+e(t.keyframe).parent().offset().left}),tK(e(t.keyframe),!1)})}else t.shiftDown||function t(i){{o=e(i);let a=m.find("#keyframe-properties");var n=S.filter(function(e){return e.t==o.attr("data-time")&&e.id==o.attr("data-object")&&e.name==o.attr("data-property")});m.find("#easing select").val(n[0].easing),m.find("#easing select").trigger("change"),a.css({left:e(i).offset().left-a.width()/2,top:e(i).offset().top-a.height()-20}),a.addClass("show-properties"),e(i).addClass("keyframe-selected")}}(i);r=!1,m.find(".line-active").removeClass("line-active"),t_()}t.shiftKey&&(e(this).hasClass("keyframe-selected")?(en=e.grep(en,function(e){return e.keyframe!=this}),e(this).removeClass("keyframe-selected")):(en.push({keyframe:this,offset:e(this).offset().left}),e(this).addClass("keyframe-selected"))),en.length>0&&en.forEach(function(t){t.offset=e(t.keyframe).offset().left}),m.on("mouseup",d).on("mousemove",l)}),m.on("mousedown","#seekbar",function(t){if(3==t.which)return!1;var i=e(this),a=t.pageX,o=e(this).offset();function n(e){C=!0;var t=o.left+(e.pageX-a);t>m.find("#timearea").offset().left+20&&t-m.find("#timearea").offset().left<I/O+20?i.offset({left:t}):t<m.find("#timearea").offset().left+20&&i.offset({left:20+m.find("#timearea").offset().left}),m.find("#timeline").scrollLeft(),A=parseFloat(((i.position().left+m.find("#timeline").scrollLeft()-20)*O).toFixed(1)),tS(!1,A),G=!0,tZ()}function s(e){var t,a;m.off("mousemove",n).off("mouseup",s),t=i,a=!1,m.find("#timeline").scrollLeft(),(A=parseFloat(((t.position().left+m.find("#timeline").scrollLeft()-20)*O).toFixed(1)))%16.666==0||a||(A=16.666*Math.ceil(A/16.666)),tZ(),tC(),tS(!1,A),G=!1,l&&"activeSelection"!=l.type&&tb(l),ez()}l=eY.getActiveObject(),eY.discardActiveObject(),m.on("mouseup",s).on("mousemove",n)}),m.on("mousedown",".main-row",function(t){if(3==t.which)return!1;var i=e(this).parent(),a=e(this).find(".trim-row");t.target;var o=t.pageX,n=i.offset(),s=a.offset(),r=a.width(),l=a.position().left,d=!1,c="no";if(t.metaKey){if(!t.shiftKey)return eu+R.find(e=>e.id==i.attr("id")).start<I&&(a.css({width:eu/O-R.find(e=>e.id==i.attr("id")).trimstart/O}),t_(),R.find(e=>e.id==i.attr("id")).end=eu,R.find(e=>e.id==i.attr("id")).trimend=eu),!1;if(a.position().left+t.pageX>=0){a.offset({left:eu/O-R.find(e=>e.id==i.attr("id")).trimstart/O+s.left});let f=parseFloat((a.position().left*O).toFixed(1));return R.find(e=>e.id==i.attr("id")).trimstart=f,a.css({width:(R.find(e=>e.id==i.attr("id")).trimend-R.find(e=>e.id==i.attr("id")).trimstart)/O}),!1}}function p(t){if("no"==c){var f=n.left+(t.pageX-o);f>m.find("#timearea").offset().left+20-m.find("#timeline").scrollLeft()?i.offset({left:f}):f+m.find("#timeline").scrollLeft()<m.find("#timearea").offset().left+20&&i.css({left:20}),R.find(e=>e.id==i.attr("id")).start=parseFloat(((i.position().left-20+m.find("#timeline").scrollLeft())*O).toFixed(1)),R.find(e=>e.id==i.attr("id")).end=parseFloat(((i.position().left+i.width()-20+m.find("#timeline").scrollLeft())*O).toFixed(1)),m.find(".keyframe-row[data-object='"+i.attr("id")+"']").is(":hidden")&&(d=!0,m.find(".layer[data-object='"+i.attr("id")+"']").find(".properties").toggle(),m.find(".layer[data-object='"+i.attr("id")+"']").find(".properties").toggleClass("layeron"),m.find(".keyframe-row[data-object='"+i.attr("id")+"']").toggle(),tG(O)),i.find(".keyframe").each(function(){tK(e(this),!1,!0)}),tS(!1,A)}else if("left"==c){if(a.position().left+(t.pageX-o)>=0){a.offset({left:s.left+(t.pageX-o)}),a.css({width:r-(-l+a.position().left)});let p=parseFloat((a.position().left*O).toFixed(1));R.find(e=>e.id==i.attr("id")).trimstart=p}}else if("right"==c){r+(t.pageX-o)<I/O?a.css({width:r+(t.pageX-o)}):a.css({width:I/O-i.position().left-m.find("#timeline").scrollLeft()+20});let g=parseFloat(((a.position().left+a.width())*O).toFixed(1));R.find(e=>e.id==i.attr("id")).end=g,R.find(e=>e.id==i.attr("id")).trimend=g}}function g(e){m.off("mousemove",p).off("mouseup",g),d&&(m.find(".layer[data-object='"+i.attr("id")+"']").find(".properties").toggle(),m.find(".layer[data-object='"+i.attr("id")+"']").find(".properties").toggleClass("layeron"),m.find(".keyframe-row[data-object='"+i.attr("id")+"']").toggle(),tG(O)),tS(!1,A),t_()}o-e(this).find(".trim-row").offset().left<7?c="left":o-e(this).find(".trim-row").offset().left>e(this).find(".trim-row").width()-7&&(c="right"),m.on("mouseup",g).on("mousemove",p)}),m.on("mousedown","#timeline-handle",function t(i){if(a=i.pageY,3==i.which)return!1;function o(t){var i;a=t.pageY,i=e(window).height()-a-91,m.find("#browser").css("height","calc(100% - "+(i+95)+"px)"),m.find("#timearea").css("height",i),m.find("#layer-list").css("height",i),m.find("#canvas-area").css("height","calc(100% - "+(i+97)+"px)"),m.find("#properties").css("height","calc(100% - "+(i+97)+"px)"),m.find("#timeline-handle").css("bottom",i+101),tv()}function n(e){m.off("mousemove",o).off("mouseup",n)}m.on("mouseup",n).on("mousemove",o)}),a=e(window).height()-92-m.find("#timearea").height(),m.on("change","#easing select",function(){var e=S.filter(function(e){return e.t==o.attr("data-time")&&e.id==o.attr("data-object")&&e.name==o.attr("data-property")});e[0].easing=m.find("#easing select").find(":selected").val(),"left"==o.attr("data-property")?(e=S.filter(function(e){return e.t==o.attr("data-time")&&e.id==o.attr("data-object")&&"top"==e.name}))[0].easing=m.find("#easing select").find(":selected").val():"scaleX"==o.attr("data-property")?((e=S.filter(function(e){return e.t==o.attr("data-time")&&e.id==o.attr("data-object")&&"scaleY"==e.name}))[0].easing=m.find("#easing select").find(":selected").val(),(e=S.filter(function(e){return e.t==o.attr("data-time")&&e.id==o.attr("data-object")&&"width"==e.name}))[0].easing=m.find("#easing select").find(":selected").val(),(e=S.filter(function(e){return e.t==o.attr("data-time")&&e.id==o.attr("data-object")&&"height"==e.name}))[0].easing=m.find("#easing select").find(":selected").val()):"strokeWidth"==o.attr("data-property")?(e=S.filter(function(e){return e.t==o.attr("data-time")&&e.id==o.attr("data-object")&&"stroke"==e.name}))[0].easing=m.find("#easing select").find(":selected").val():"shadow.color"==o.attr("data-property")?((e=S.filter(function(e){return e.t==o.attr("data-time")&&e.id==o.attr("data-object")&&"shadow.offsetX"==e.name}))[0].easing=m.find("#easing select").find(":selected").val(),(e=S.filter(function(e){return e.t==o.attr("data-time")&&e.id==o.attr("data-object")&&"shadow.offsetY"==e.name}))[0].easing=m.find("#easing select").find(":selected").val(),(e=S.filter(function(e){return e.t==o.attr("data-time")&&e.id==o.attr("data-object")&&"shadow.blur"==e.name}))[0].easing=m.find("#easing select").find(":selected").val()):"charSpacing"==o.attr("data-property")&&((e=S.filter(function(e){return e.t==o.attr("data-time")&&e.id==o.attr("data-object")&&"charSpacing"==e.name}))[0].easing=m.find("#easing select").find(":selected").val()),m.find("#keyframe-properties").removeClass("show-properties"),o.removeClass("keyframe-selected"),t_()}),m.on("click","#seekevents",function(e){tJ(e)}),m.on("click","#timearea",function(e){tJ(e)}),m.on("mousemove","#timearea",t9),m.on("mousemove","#seekevents",t9),m.on("mousemove","#toolbar",tQ),m.on("mousemove","#canvas-area",tQ),m.on("mousemove","#browser",tQ),m.on("mousemove","#properties",tQ),m.on("mousemove","#controls",tQ),m.on("click","#hand-tool",function(){e(this).hasClass("hand-active")?(e(this).removeClass("hand-active"),N=!1,eY.defaultCursor="default",eY.requestRenderAll()):(e(this).addClass("hand-active"),N=!0,eY.defaultCursor="grab",eY.requestRenderAll())}),t6(I),function e(){x.collection("assets").get().then(t=>{void 0===t?e():t.length>0&&t.forEach(function(e){"image"==e.type?es.push({src:e.src,thumb:e.thumb,key:e.key,type:"image",hidden:e.hidden}):"video"==e.type?er.push({src:e.src,thumb:e.thumb,key:e.key,type:"video",hidden:e.hidden}):"audio"==e.type&&el.push({src:e.src,thumb:null,key:e.key,type:"audio",hidden:e.hidden})})})}(),x.collection("projects").get().then(e=>{if(0==e.length){eY.clipPath=null;let t=eY.toDatalessJSON(ey);eY.clipPath=e8,x.collection("projects").add({id:1,title:"Autosave",canvas:JSON.stringify(t),keyframes:JSON.stringify(S.slice()),p_keyframes:JSON.stringify(R.slice()),objects:JSON.stringify(F.slice()),colormode:T,speed:_,audiosrc:!1,duration:I,currenttime:A,layercount:ee,width:e8.width,height:e8.height,animatedtext:JSON.stringify(eh),groups:JSON.stringify(P)}),k=!0}else x.collection("projects").doc({id:1}).get().then(e=>{if(e)tn(1);else{eY.clipPath=null;let t=eY.toDatalessJSON(ey);eY.clipPath=e8,x.collection("projects").add({id:1,title:"Autosave",canvas:JSON.stringify(t),keyframes:JSON.stringify(S.slice()),p_keyframes:JSON.stringify(R.slice()),objects:JSON.stringify(F.slice()),colormode:T,speed:_,audiosrc:!1,duration:I,currenttime:A,layercount:ee,width:e8.width,height:e8.height,animatedtext:JSON.stringify(eh),groups:JSON.stringify(P)}),k=!0,el.slice().reverse().forEach(function(e){m.find("#audio-list").prepend('<div class="audio-item" data-file="'+e.src+'"><div class="audio-preview"> <span class="material-icons">play_arrow</span> </div><div class="audio-info nomargin"> <div class="audio-info-title">'+pmotionParams.t137+" "+e.key+'</div><button type="button" class="audio-asset-delete btn danger" data-id="'+e.key+'"><span class="material-icons">remove</span></button></div> </div>')})}})}),eY.on("object:added",function(e){var t,i,a=e.target;(t=a).controls.deleteControl=new fabric.Control({x:0,y:.5,offsetY:22,offsetX:14,cursorStyle:"pointer",mouseUpHandler:e3,render:eq,cornerSize:24}),(i=a).controls.cloneControl=new fabric.Control({x:0,y:.5,offsetY:22,offsetX:-14,cursorStyle:"pointer",mouseUpHandler:eB,render:e1,cornerSize:24}),"audio"==a.get("assetType")&&a.set("borderColor","transparent")}),eY.on("object:removed",function(e){var t=e.target;t.get("assetType")&&"audio"==t.get("assetType")&&(m.find(".audio-item-active").removeClass("audio-item-active"),eY.discardActiveObject(),ec=!1,ep=!1)}),eY.on("object:moving",function(e){e.target.hasControls=!1,eL(e),Q?(eY.getItemById("crop").isContainedWithinObject(f)&&(h=eY.getItemById("crop").get("left"),u=eY.getItemById("crop").get("top"),p=eY.getItemById("crop").get("scaleX"),g=eY.getItemById("crop").get("scaleY")),tB(eY.getItemById("cropped"))):et&&e.e.shiftKey&&eY.getActiveObject()?K<ei+30&&K>ei-30?(eY.getActiveObject().set({left:ei}),eY.getActiveObject().lockMovementX=!0,eY.getActiveObject().lockMovementY=!1):(eY.getActiveObject().set({top:ea}),eY.getActiveObject().lockMovementX=!1,eY.getActiveObject().lockMovementY=!0):eY.getActiveObject()&&!e.e.shiftKey&&(et=!1,eY.getActiveObject().lockMovementX=!1,eY.getActiveObject().lockMovementY=!1)}),eY.on("object:scaling",function(e){if(e.target.hasControls=!1,eL(e),Q){var t=eY.getItemById("crop");t.isContainedWithinObject(f)&&(h=t.get("left"),u=t.get("top"),p=t.get("scaleX"),g=t.get("scaleY")),tB(eY.getItemById("cropped"))}}),eY.on("object:rotating",function(e){e.e.shiftKey?eY.getActiveObject().snapAngle=15:eY.getActiveObject().snapAngle=0,e.target.hasControls=!1}),eY.on("object:modified",function(e){if(e.target.hasControls=!0,!Q){if(eY.getActiveObject().lockMovementX=!1,eY.getActiveObject().lockMovementY=!1,eY.requestRenderAll(),"activeSelection"==e.target.type){let t=eY.getActiveObject();eY.discardActiveObject(),e.target._objects.forEach(function(t){t$(t,e,!0)}),tb(t)}else t$(e.target,e,!1);ez(),t_()}if(Q){var i;(i=e.target).isContainedWithinObject(f)?(u=i.get("top"),h=i.get("left"),p=i.get("scaleX"),g=i.get("scaleY")):(i.top=u,i.left=h,i.scaleX=p,i.scaleY=g,i.setCoords(),i.saveState()),i.set({borderColor:"#4affff"}),eY.requestRenderAll(),tB(eY.getItemById("cropped"))}}),eY.on("selection:updated",function(e){eW(!0),ez(),tm(e)}),eY.on("selection:created",function(e){if(e.selected.length>1&&0!==A){eY.discardActiveObject();return}ei=eY.getActiveObject().get("left"),ea=eY.getActiveObject().get("top"),eW(!0),tm(e),eY.requestRenderAll()}),eY.on("selection:cleared",function(e){V||eW(!1),m.find(".layer-selected").removeClass("layer-selected"),Q&&tB(f)}),eY.on("mouse:wheel",function(e){var t,i=e.e.deltaY,a=eY.getZoom();a*=.999**i,m.find("#zoom-level .zoom-span").html((Math.abs(t=(100*a).toFixed(0))>999?Math.sign(t)*(Math.abs(t)/1e3).toFixed(1)+"k":Math.sign(t)*Math.abs(t))+"%"),a>20&&(a=20),a<.01&&(a=.01),eY.zoomToPoint({x:e.e.offsetX,y:e.e.offsetY},a),e.e.preventDefault(),e.e.stopPropagation()}),eY.on("mouse:down",function(e){var t=e.e;N&&(this.isDragging=!0,this.selection=!1,this.lastPosX=t.clientX,this.lastPosY=t.clientY),e.target&&(e.target.hasControls=!0,j=!1)}),eY.on("mouse:move",function(e){var t=eY.getPointer(e.e);if(K=t.x,M=t.y,this.isDragging){var i=e.e,a=this.viewportTransform;a[4]+=i.clientX-this.lastPosX,a[5]+=i.clientY-this.lastPosY,this.requestRenderAll(),this.lastPosX=i.clientX,this.lastPosY=i.clientY}}),eY.on("mouse:up",function(e){this.setViewportTransform(this.viewportTransform),this.isDragging=!1,this.selection=!0,d.opacity=0,c.opacity=0}),eY.on("mouse:move",function(e){Z=!0}),eY.on("mouse:out",function(e){Z=!1,j&&(e.target.hasControls=!0,eY.discardActiveObject(),j=!1,eY.requestRenderAll())}),e(document).keyup(function(e){46!=e.keyCode&&"Delete"!=e.key&&"Delete"!=e.code&&"Backspace"!=e.key||D||eo||(m.find(".show-properties").length>0||en.length>0?tN():function e(){if(eY.getActiveObject()&&!eY.getActiveObject().isEditing){let t=eY.getActiveObject();"activeSelection"==t.type?(eY.discardActiveObject(),t._objects.forEach(function(e){tU(e,eY)})):tU(eY.getActiveObject(),eY)}}())}).keydown(function(e){var t=!1,i=2;eY.getActiveObject()&&(t=eY.getActiveObject()),37===e.keyCode&&t&&(e.shiftKey&&(i=7),t.left=t.left-i,eY.requestRenderAll(),"activeSelection"==t.type?(eY.discardActiveObject(),t._objects.forEach(function(e){t$(e,{action:"drag"},!0)}),tb(t)):t$(t,{action:"drag"},!1)),38===e.keyCode&&t&&(e.shiftKey&&(i=7),t.top=t.top-i,eY.requestRenderAll(),"activeSelection"==t.type?(eY.discardActiveObject(),t._objects.forEach(function(e){t$(e,{action:"drag"},!0)}),tb(t)):t$(t,{action:"drag"},!1)),39===e.keyCode&&t&&(e.shiftKey&&(i=7),t.left=t.left+i,eY.requestRenderAll(),"activeSelection"==t.type?(eY.discardActiveObject(),t._objects.forEach(function(e){t$(e,{action:"drag"},!0)}),tb(t)):t$(t,{action:"drag"},!1)),40===e.keyCode&&t&&(e.shiftKey&&(i=7),t.top=t.top+i,eY.requestRenderAll(),"activeSelection"==t.type?(eY.discardActiveObject(),t._objects.forEach(function(e){t$(e,{action:"drag"},!0)}),tb(t)):t$(t,{action:"drag"},!1))}),m.on("click","#crop-selection",function(){Q&&eY.discardActiveObject()}),m.on("click","#play-button",function(){C?tj():tC()}),m.on("mousedown",function(e){m.find("#keyframe-properties").is(e.target)||0!==m.find("#keyframe-properties").has(e.target).length||m.find(".keyframe").is(e.target)||0!==m.find(".keyframe").has(e.target).length||(m.find("#keyframe-properties").removeClass("show-properties"),m.find(".keyframe-selected").removeClass("keyframe-selected"),en=[]),m.find(".object-color").is(e.target)||0!==m.find(".object-color").has(e.target).length||m.find(".pcr-app").is(e.target)||0!==m.find(".prc-app").has(e.target).length||m.find(".pcr-selection").is(e.target)||0!==m.find(".pcr-selection").has(e.target).length||m.find(".pcr-swatches").is(e.target)||0!==m.find(".pcr-swatches").has(e.target).length||m.find(".pcr-interaction").is(e.target)||0!==m.find(".pcr-interaction").has(e.target).length||e4.hide(),m.find("#speed").is(e.target)||0!==m.find("#speed").has(e.target).length||(m.find("#speed-settings").removeClass("show-speed"),m.find("#speed-arrow").removeClass("arrow-on"))}),e(document).on("focus",".form-field",function(){D=!0}).on("focusout",function(){D=!1}),m.on("click","#skip-backward",function(){tS(!1,0),m.find("#seekbar").offset({left:20+m.find("#inner-timeline").offset().left+A/O}),m.find("#current-time input").val("00:00:00")}),m.on("click","#skip-forward",function(){tS(!1,I),m.find("#seekbar").offset({left:20+m.find("#inner-timeline").offset().left+A/O}),m.find("#current-time input").val("00:00:00"),m.find("#total-time input").val("00:0"+O+":00")}),m.on("dblclick",".layer-custom-name",function(){e(this).prop("readonly",!1),e(this).addClass("name-active"),e(this).focus(),document.execCommand("selectAll",!1,null),eo=!0}),m.on("click","#upload-button",function(){m.find("#upload-popup").addClass("upload-show")}),m.on("click","#upload-overlay",function(){m.find(".upload-show").removeClass("upload-show")}),m.on("click","#upload-popup-close",function(){m.find(".upload-show").removeClass("upload-show")}),m.on("click","#upload-drop-area",function(){m.find("#filepick").click()}),m.on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),m.on("dragover","#upload-drop-area",function(e){e.preventDefault(),e.stopPropagation(),m.find("#upload-drop-area").addClass("dropping")}),m.on("dragenter","#upload-drop-area",function(e){e.preventDefault(),e.stopPropagation(),m.find("#upload-drop-area").addClass("dropping")}),m.on("drop",function(e){e.preventDefault(),e.stopPropagation(),m.find("#upload-drop-area").removeClass("dropping"),tW(e)}),m.on("dragleave",function(){m.find("#upload-drop-area").removeClass("dropping")}),m.on("dragend",function(){m.find("#upload-drop-area").removeClass("dropping")}),m.on("click","#audio-upload-button",function(){m.find("#filepick2").click()}),function t(i,a){var o=e(i),n=e(a),s=!1;function r(e,t){var i,a,o;if(s)return s=!1;i=t,a=e.scrollTop()/(e[0].scrollHeight-e.outerHeight())*100,o=a/100*(i[0].scrollHeight-i.outerHeight()),s=!0,i.scrollTop(o)}o.scroll(function(){r(o,n)}),n.scroll(function(){r(n,o)})}(m.find("#layer-inner-list:not(.nolayer)"),m.find("#timeline")),function t(i,a){var o=e(i),n=e(a),s=!1;function r(e,t){var i,a,o;if(s)return s=!1;i=t,a=e.scrollLeft()/e.outerWidth()*100,o=a/100*i.outerWidth(),s=!0,i.scrollLeft(o)}o.scroll(function(){r(o,n)}),n.scroll(function(){r(n,o)})}(m.find("#timeline"),m.find("#seekarea")),sortable("#layer-inner-list:not(.nolayer)",{customDragImage:(e,t,i)=>({element:document.getElementById("nothing"),posX:i.pageX-t.left,posY:i.pageY-t.top})})[0].addEventListener("sortstop",function(t){let i=e(t.detail.item).attr("data-object"),a=e(t.detail.item).prev().attr("data-object");1==m.find(".sortable-dragging").length&&(m.find(".sortable-dragging").remove(),void 0==a?m.find("#inner-timeline").prepend(e("#"+i)):e("#"+i).insertAfter(e("#"+a)),m.find(".layer").each(function(t){let i=eY.getItemById(e(this).attr("data-object"));eY.sendToBack(i),eY.requestRenderAll(),F.splice(m.find(".layer").length-t-1,0,F.splice(F.findIndex(e=>e.id==i.get("id")),1)[0])}),t_())}),eW(!1),m.find("#text-tool-select").one("click",function(){WebFont.load({google:{families:["Montserrat","Poppins","Playfair Display","Merriweather","IBM Plex Serif","Roboto Mono","Inconsolata","Source Code Pro","Dancing Script","Pacifico","Indie Flower","Lobster","Bebas Neue","Titan One",]}})}),e.each(["#qrcode-fill","#qrcode-back","#qrcode-label-color"],function(t,i){Pickr.create({el:i,theme:"nano",inline:!1,autoReposition:!1,defaultRepresentation:"RGBA",default:e(i).val(),useAsButton:!0,swatches:$.colorpickerSwatches,components:{preview:!0,opacity:!0,hue:!0,interaction:{hex:!0,rgba:!0,hsla:!1,hsva:!1,cmyk:!1,input:!0,clear:!1,save:!1}}}).on("init",t=>{var a=e(i).val();e(i).parent().find(".colorpicker-box").css("background",a)}).on("change",(t,a,o)=>{e(i).val(t.toHEXA().toString()),e(i).parent().find(".colorpicker-box").css("background",t.toHEXA().toString()),e(i).trigger("change")}).on("show",(e,t)=>{var i=m.find(".app-colorpicker:focus")[0].getBoundingClientRect(),a=i.top+i.height+5;let o=t.getRoot().app.style;o.left=i.left+"px",o.top=a+"px"})}),m.find("#generate-qr-code").on("click",function(){var e,t,i,a,o=kjua({text:m.find("#qrcode-text").val(),render:"svg",size:300,fill:m.find("#qrcode-fill").val(),back:m.find("#qrcode-back").val(),rounded:m.find("#qrcode-rounded").val(),mode:"label",label:m.find("#qrcode-label").val(),fontname:"sans",fontcolor:m.find("#qrcode-label-color").val(),mSize:m.find("#qrcode-label-size").val(),mPosX:m.find("#qrcode-label-position-x").val(),mPosY:m.find("#qrcode-label-position-y").val()}),n=new XMLSerializer().serializeToString(o),s=e8.get("left")+e8.get("width")/2,r=e8.get("top")+e8.get("height")/2;e=n,t=s,i=r,a=!0,fabric.loadSVGFromString(e,function(o,n){var s=fabric.util.groupSVGElements(o,n);let r=window.btoa(e),l=`data:image/svg+xml;base64,${r}`;s.set({id:"Shape"+ee,stroke:"#000",left:t,top:i,strokeWidth:0,strokeUniform:!0,originX:"center",originY:"center",strokeDashArray:!1,absolutePositioned:!0,paintFirst:"stroke",objectCaching:!0,sourcePath:l,assetType:"svg",inGroup:!1,shadow:{color:"#000",offsetX:0,offsetY:0,blur:0,opacity:0}}),s.scaleToWidth(300),s.set({scaleX:parseFloat(s.get("scaleX").toFixed(2)),scaleY:parseFloat(s.get("scaleY").toFixed(2))}),eY.add(s),t3(s),eY.setActiveObject(s),eY.bringToFront(s),eY.requestRenderAll(),a&&(s.set("left",e8.get("left")+e8.get("width")/2),s.set("top",e8.get("top")+e8.get("height")/2),eY.requestRenderAll())})}),m.find("#qrcode-tool-select").one("click",function(){m.find("#qrcode-preview").html(ie())}),m.find('#qrcode-settings input[type="text"]').on("input",function(){var e=ie();m.find("#qrcode-preview").html(e)}),m.find("#qrcode-settings .app-colorpicker").bind("change",function(){var e=ie();m.find("#qrcode-preview").html(e)}),m.find("#qrcode-settings input[type=range]").bind("input click",function(){var e=ie();m.find("#qrcode-preview").html(e)}),new FontFaceObserver("Material Icons").load(null,1e4).then(function(){m.find("#main-loader").fadeOut(200),m.removeClass("loading")}).catch(function(e){console.log(e),m.find("#main-loader").fadeOut(200),m.removeClass("loading")}),$.customFunctions.call(this,m,eY,s,e2)}}(jQuery);